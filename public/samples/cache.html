<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<script src="../jquery/jquery-1.11.1.min.js"></script>
	<script src="../jquery/require.min.js"></script>
	<script src="../cartoon/excanvas.js"></script>
	<link rel="stylesheet" href="../jquery/bootstrap.min.css">
	<style>
	
		html {height:100%;}
		body {height:100%;background:#fff;color:#000;}
		#fps {position:absolute;z-index:200;left:0;top:0;color:#FF0;}
		.display { overflow: hidden; width: 100%; }
		.div-container, .cvs-container { float: left; border:#0E97E6 solid 1px; margin: 5px; position:relative; }
		.control {clear: both;}
		.control label { margin:5px 5px 0 8px; }
		.fps { color: red; text-shadow:0 0 1px 1px yellow;}
	</style>
</head>
<body>
	<div class="display">
		<div class="div-container"></div>
		<canvas class="cvs-container"></canvas>
		
	</div>
	
	<div class="control">
		<div class="fps">FPS:<span>0</span></div>
		<br >
		<input type="button" value="runDOM" id="runDOM">
		<input type="button" value="runCanvas" id="runCanvas">
		<input type="button" value="useCache" id="useCache">
		<input type="button" value="noCache" id="noCache">
	</div>
<script>

	require.config({
		baseUrl: '../cartoon/',
		paths: {
			cartoon: 'cartoon'
		}
	});
	require(['cartoon'], function(ct){
		var fps = $('.fps span');
		
		var divContainer = $('.div-container').cartoon({
			size: { width: 600, height: 300 }
		});
		divContainer.$.css('overflow', 'hidden');
		
		var cvsContainer = $('.cvs-container').cartoon({
			type: 'Canvas',
			size: { width: 600, height: 300 }
		});
		
		var divBalls = [],
			cvsBalls = [],
			pos, ball;
		for (var i=0;i<200;i++) {
			pos = { x: Math.floor(Math.random()*600), y: Math.floor(Math.random()*300) };			
			ball = $.cartoon({ pos: pos, size:{ width: 30, height: 30 } });
			ball.addChild($.cartoon({
				type: 'Shape',
				pos: { x: 3, y: 3 },
				graphics: { type: 'rect', width: 24, height: 24, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.addChild($.cartoon({
				type: 'Shape',
				pos: { x: 5, y: 5 },
				graphics: { type: 'rect', width: 20, height: 20, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.addChild($.cartoon({
				type: 'Shape',
				pos: { x: 7, y: 7 },
				graphics: { type: 'rect', width: 16, height: 16, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.addChild($.cartoon({
				type: 'Shape',
				pos: { x: 9, y: 9 },
				graphics: { type: 'rect', width: 12, height: 12, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.spdR = ball.spdX = ball.spdY = i%2?1:-1;
			divBalls.push(ball);
			divContainer.addChild(ball);
			
			ball = $.cartoon({ pos: pos, size:{ width: 30, height: 30 }, renderMode: true });
			ball.addChild($.cartoon({
				type: 'Shape', renderMode: true,
				pos: { x: 3, y: 3 },
				graphics: { type: 'rect', width: 24, height: 24, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.addChild($.cartoon({
				type: 'Shape', renderMode: true,
				pos: { x: 5, y: 5 },
				graphics: { type: 'rect', width: 20, height: 20, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.addChild($.cartoon({
				type: 'Shape', renderMode: true,
				pos: { x: 7, y: 7 },
				graphics: { type: 'rect', width: 16, height: 16, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.addChild($.cartoon({
				type: 'Shape', renderMode: true,
				pos: { x: 9, y: 9 },
				graphics: { type: 'rect', width: 12, height: 12, fill: 'rgb('+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+','+Math.floor(Math.random()*256)+')' }
			}));
			ball.spdR = ball.spdX = ball.spdY = i%2?1:-1;
			cvsBalls.push(ball);
			cvsContainer.addChild(ball);
		}
		var runType = 0;
		var run = function(balls) {
			var ball;
			for (var i=0;i<balls.length;i++) {
				ball = balls[i];
				ball.style('pos', { x: ball.x+ball.spdX*2, y: ball.y+ball.spdY*2});
				ball.style('transform', {
					rotate: ball.rotation+ball.spdR*2
				});
				if (ball.x<0) {
					ball.spdX = 1;
				} else if(ball.x>600) {
					ball.spdX = -1;
				}
				if (ball.y<0) {
					ball.spdY = 1;
				} else if(ball.y>300) {
					ball.spdY = -1;
				}
			}
		}
		
		var ticker = new ct.Ticker(60, 'auto', false);
		ticker.add(function(){
			if (runType == 0) {
				run(divBalls);
			} else {
				run(cvsBalls);
				cvsContainer.update();
			}
			
			fps.html(ticker.fps);
		});
		ticker.start();
		
		$('.control').bind('click', function(e) {
			var id = e.target.id,
				val = parseFloat(e.target.value);
			
			switch(id) {
				case 'runDOM':
					runType = 0;
					break;
				case 'runCanvas':
					runType = 1;
					break;
				case 'useCache':
					cvsBalls.forEach(function(a, i){
						a.cache();
					});
					break;
				case 'noCache':
					cvsBalls.forEach(function(a, i){
						a.uncache();
					});
					break;
			}
		});
	});
</script>
</body>
</html>