<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<script src="../jquery/jquery-1.11.1.min.js"></script>
	<script src="../jquery/require.min.js"></script>
	<script src="../cartoon/excanvas.js"></script>
	<link rel="stylesheet" href="../jquery/bootstrap.min.css">
	<style>
	
		html {height:100%;}
		body {height:100%;background:#fff;color:#000;}
		.display { overflow: hidden; width: 100%; }
		.div-container, .cvs-container { float: left; border:#0E97E6 solid 1px; margin: 5px; position:relative; }
		.control {clear: both;}
		.control label { margin:5px 5px 0 8px; }
		.div-border div { box-shadow: inset 0 0 1px 1px red; }
	</style>
</head>
<body>
	<div class="display">
		<div class="div-container"></div>
		<canvas class="cvs-container"></canvas>
	</div>
	
	<div class="control">
		<input type="button" value="idle" id="idle">
		<input type="button" value="walk" id="walk">
		<input type="button" value="jump" id="jump">
		<div id="fps">0</div>
	</div>
<script>

	require.config({
		baseUrl: '../cartoon/',
		paths: {
			cartoon: 'cartoon'
		}
	});
	require(['cartoon'], function(ct){
		
		ct.DisplayObject.prototype._drawCanvas = function(ctx) {
			this._updateCanvasContext(ctx);
			this.draw(ctx);
			
			ctx.fillStyle = '#FF0';
			ctx.fillRect(this._getAnchorX()-2, this._getAnchorY()-2, 4, 4);
		};
		
		var divContainer = $('.div-container').cartoon({
			size: { width: 600, height: 300 }
		});
		divContainer.$.css('overflow', 'hidden');
		
		var cvsContainer = $('.cvs-container').cartoon({
			type: 'Canvas',
			size: { width: 600, height: 300 }
		});

		var divBg = $.cartoon({
			type: 'Shape',
			graphics: {
				type: 'Rect', fill: 'top,#2D2,#4B4', width: 600, height: 300
			}
		});
		
		var cvsBg = $.cartoon({
			type: 'Shape',
			renderInCanvas: true,
			graphics: {
				type: 'Rect', fill: 'top,#2D2,#4B4', width: 600, height: 300
			}
		});
		
		var bones = [
				{ tag: 'right_hand',imageUrl: 'images/right_hand.png', width: 53, height: 64 },
				
				{ tag: 'right_foot', width: 33, height: 55 },
				{ tag: 'left_foot', width: 29, height: 71 },
				{ tag: 'body', width: 70, height: 87 },
				
				{ tag: 'left_foot_0',imageUrl: 'images/left_foot_0.png', width: 29, height: 71, parent: 'left_foot' },
				{ tag: 'left_foot_1',imageUrl: 'images/left_foot_1.png', width: 59, height: 62, parent: 'left_foot' },
				
				{ tag: 'right_foot_0', width: 33, height: 55, imageUrl: 'images/right_foot_0.png', parent: 'right_foot' },
				{ tag: 'right_foot_1', width: 47, height: 61, imageUrl: 'images/right_foot_1.png', parent: 'right_foot' },
				
				
				{ tag: 'body_body',imageUrl: 'images/body.png', width: 70, height: 87, parent: 'body'  },
				{ tag: 'left_hand', width: 35, height: 41, parent: 'body' },
				{ tag: 'head', imageUrl: 'images/head.png', width: 101, height: 100, parent: 'body' },
				
				{ tag: 'left_hand_0',imageUrl: 'images/left_hand_0.png', width: 35, height: 41, parent: 'left_hand' },
				{ tag: 'left_hand_1',imageUrl: 'images/left_hand_1.png', width: 59, height: 65, parent: 'left_hand' }
			
			];
		var animations = {
				idle: [
					{ tag: 'body', frames: [
						{ index: 0, pos: { x: 0, y: 0 }, transform: { rotate: 0 } },
						{ index: 40, pos: { y: 3 } },
						{ index: 80, pos: { y: 0 } }
					]},
					{ tag: 'head', frames: [
						{ index: 0, pos: { x: -27, y: -55 }, transform: { rotate: 0, originX: 0.4, originY: 0.7 } }
					]},
					{ tag: 'left_hand', frames: [
						{ index: 0, pos: { x: 10, y: 20 }, transform: { rotate: -40 } },
						{ index: 40, transform: { rotate: -30 } },
						{ index: 80, transform: { rotate: -40 } }
					]},
					{ tag: 'left_hand_1', frames: [
						{ index: 0, pos: { x: -39, y: 24 }, transform: { rotate: 0, originX: 0.9, originY: 0.0 } }
					]},
					{ tag: 'right_hand', frames: [ 
						{ index: 0, pos: { x: -35, y: 35 }, transform: { rotate: -40, originX: 1, originY: 0 } },
						{ index: 40, pos: { y: 38 }, transform: { rotate: -20 } },
						{ index: 80, pos: { y: 35 }, transform: { rotate: -40 } }
					]},
					{ tag: 'right_foot', frames: [
						{ index: 0, pos: { x: 17, y: 54 }, transform: { rotate: 0, originX: 0.45, originY: 0.2 } },
						{ index: 40, pos: { x: 15, y: 55 }, transform: { rotate: -5 } },
						{ index: 80, pos: { x: 17, y: 54 }, transform: { rotate: 0 } }
					]},
					{ tag: 'right_foot_1', frames: [ 
						{ index: 0, pos: { x: -14, y: 38 }, transform: { rotate: 0, originX: 0.75, originY: 0.2 } },
						{ index: 40, transform: { rotate: 5 } },
						{ index: 80, transform: { rotate: 0 } }
					]},
					{ tag: 'left_foot', frames: [
						{ index: 0, pos: { x: 40, y: 45 }, transform: { rotate: 0, originX: 0.5, originY: 0.2 } },
						{ index: 40, pos: { x: 43 }, transform: { rotate: 5 } },
						{ index: 80, pos: { x: 40 }, transform: { rotate: 0 } }
					]},
					{ tag: 'left_foot_1', frames: [
						{ index: 0,  pos: { x: -17, y: 58 }, transform: { rotate: 0, originX: 0.55, originY: 0.1 } },
						{ index: 40, transform: { rotate: -5 } },
						{ index: 80, transform: { rotate: 0 } }
					]}
				],
				jump: [
					{ tag: 'body', frames: [
						{ index: 0, pos: { x: 0, y: 0 }, transform: { rotate: 0 } },
						{ index: 30, pos: { x: 0, y: 0 }, transform: { rotate: -10 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: 10 } },
						{ index: 120, transform: { rotate: 0 } } 
					]}
				],
				walk: [
					{ tag: 'body', frames: [
						{ index: 0, pos: { x: 0, y: 0 }, transform: { rotate: 0 } },
						{ index: 30, transform: { rotate: -10 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: 10 } },
						{ index: 120, transform: { rotate: 0 } } 
					]},
					
					{ tag: 'head', frames: [
						{ index: 0, pos: { x: -27, y: -55 }, transform: { rotate: 0, originX: 0.4, originY: 0.7 } },
						{ index: 30, transform: { rotate: -10 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: 10 } },
						{ index: 120, transform: { rotate: 0 } }
					]},
					{ tag: 'left_hand', frames: [
						{ index: 0, pos: { x: 10, y: 20 }, transform: { rotate: 0 } },
						{ index: 30, transform: { rotate: 20 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: -20 } },
						{ index: 120, transform: { rotate: 0 } } 
					]},
					{ tag: 'left_hand_1', frames: [
						{ index: 0, pos: { x: -39, y: 24 }, transform: { rotate: 0, originX: 0.9, originY: 0.0 } },
						{ index: 30, transform: { rotate: 10 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: -10 } },
						{ index: 120, transform: { rotate: 0 } } 
					]},
					{ tag: 'right_hand', frames: [ 
						{ index: 0, pos: { x: -35, y: 35 }, transform: { rotate: 0, originX: 1, originY: 0 } },
						{ index: 30, transform: { rotate: -20 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: 20 } },
						{ index: 120, transform: { rotate: 0 } } 
					]},
					{ tag: 'right_foot', frames: [
						{ index: 0, pos: { x: 17, y: 54 }, transform: { rotate: 0, originX: 0.45, originY: 0.2 } },
						{ index: 30, transform: { rotate: 20 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 75, transform: { rotate: -20 } },
						{ index: 90, transform: { rotate: -20 } },
						{ index: 120, transform: { rotate: 0 } }
					]},
					{ tag: 'right_foot_1', frames: [ 
						{ index: 0, pos: { x: -14, y: 38 }, transform: { rotate: 0, originX: 0.75, originY: 0.2 } },
						{ index: 30, transform: { rotate: -30 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 75, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: -20 } },
						{ index: 120, transform: { rotate: 0 } }
					]},
					{ tag: 'left_foot', frames: [
						{ index: 0, pos: { x: 40, y: 45 }, transform: { rotate: 0, originX: 0.5, originY: 0.2 } },
						{ index: 30, transform: { rotate: -30 } },
						{ index: 60,  transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: 30 } },
						{ index: 120, transform: { rotate: 0 } }
					]},
					{ tag: 'left_foot_1', frames: [
						{ index: 0,  pos: { x: -17, y: 58 }, transform: { rotate: 0, originX: 0.55, originY: 0.1 } },
						{ index: 30, transform: { rotate: 30 } },
						{ index: 60, transform: { rotate: 0 } },
						{ index: 90, transform: { rotate: -30 } },
						{ index: 120, transform: { rotate: 0 } }
					]}
				]
			};
			
		var divBones = $.cartoon({
			type: 'BoneAnimation',
			pos: { x: 200, y: 100 },
			bones: bones, 
			animations: animations
		});
		divBones.play('walk');
		divBones.$.addClass('div-border');
		
		var cvsBones = $.cartoon({
			type: 'BoneAnimation',
			renderInCanvas: true,
			pos: { x: 200, y: 100 },
			bones: bones, 
			animations: animations
		});
		cvsBones.play('walk');
		
		divContainer.addChild(divBg);
		divContainer.addChild(divBones);
		
		cvsContainer.addChild(cvsBg);
		cvsContainer.addChild(cvsBones);
		
		var ticker = new ct.Ticker(60, 'auto', false);
		ticker.add(divBones);
		ticker.add(cvsBones);
		ticker.add(cvsContainer);
		ticker.add(function(){
			$('#fps').html(ticker.fps);
		});
		ticker.start();		
		
		$('.control').bind('click', function(e) {
			var id = e.target.id;
			switch(id) {
				case 'idle':
					divBones.play('idle');
					cvsBones.play('idle');
					break;
				case 'walk':
					divBones.play('walk');
					cvsBones.play('walk');
					break;
				case 'jump':
					divBones.play('jump');
					cvsBones.play('jump');
					break;
			}
		});
	});
</script>
</body>
</html>