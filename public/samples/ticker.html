<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<script src="../jquery/jquery-1.11.1.min.js"></script>
	<script src="../jquery/require.min.js"></script>
	<script src="../cartoon/excanvas.js"></script>
	<link rel="stylesheet" href="../jquery/bootstrap.min.css">
	<style>
	
		html {height:100%;}
		body {height:100%;background:#fff;color:#000;}
		.color-block {
			background: red;
			width: 100px;
			height: 100px;
		}
	</style>
</head>
<body>
	<table class="table table-striped">
		<tbody>
			<tr>
				<td>Index</td><td>Fps</td><td>useAf</td><td>Compensation</td><td>ReFps</td><td>Tick/S</td><td>Open</td>
			</tr>
			<tr id="t_0">
				<td>0</td><td>60</td><td>auto</td><td>false</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>

			<tr id="t_1">
				<td>1</td><td>60</td><td>false</td><td>false</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
			<tr id="t_2">
				<td>2</td><td>60</td><td>auto</td><td>true</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
			<tr id="t_3">
				<td>3</td><td>60</td><td>false</td><td>true</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
			<tr id="t_4">
				<td>4</td><td>100</td><td>auto</td><td>false</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
			<tr id="t_5">
				<td>5</td><td>100</td><td>false</td><td>false</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
			<tr id="t_6">
				<td>6</td><td>30</td><td>auto</td><td>false</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
			<tr id="t_7">
				<td>7</td><td>30</td><td>false</td><td>false</td><td class="fps">0</td><td class="tick">0</td><td><input type="button" value="open" class="open"></td>
			</tr>
		</tbody>
	</table>
	<div>PS: useAf（是否使用 H5 requestAnimationFrame API）  compensation（是否使用帧频补偿 ，用来补偿丢帧时造成的 计算误差）</div>
	<div class="color-block"></div>
<script>

	require.config({
		baseUrl: '../cartoon/',
		paths: {
			cartoon: 'cartoon'
		}
	});
	require(['cartoon'], function(ct){
		var tickers = [];
		
		var $block = $('.color-block');
		
		tickers[0] = new ct.Ticker(60, 'auto', false);
		tickers[1] = new ct.Ticker(60, false, false);
		tickers[2] = new ct.Ticker(60, 'auto', true);
		tickers[3] = new ct.Ticker(60, false, true);
		tickers[4] = new ct.Ticker(100, 'auto', false);
		tickers[5] = new ct.Ticker(100, false, false);
		tickers[6] = new ct.Ticker(30, 'auto', false);
		tickers[7] = new ct.Ticker(30, false, false);
		
		var temp = 0;
		
		var updateFps = function(a, i) {
			a.nt = new Date().getTime();
			a.co ++;
			temp ++;
			var q = '#t_'+i;
			$(q+' .fps').html(a.fps);
			if ((a.nt - a.lt) > 1000) {
				$(q+' .tick').html(Math.floor(a.co*1000/(a.nt - a.lt)));
				a.co = 0;
				a.lt = a.nt;
			}
			$block.css('margin-left', Math.sin(temp/4/Math.PI)*500+500);
		};
		
		var addFunc = function(a, i){
			a.lt = a.nt = 0;
			a.add(function(){
				updateFps(a, i);
			});
		};
		
		for(var i=0,l=tickers.length; i<l; i++) {
			addFunc(tickers[i], i);
		}
		
		$('.open').each(function(i, a){
			$(a).click(function(){
				var idx = a.parentNode.parentNode.id.split('_')[1];
				for(var i=0,l=tickers.length; i<l; i++) {
					if (idx == i) {
						tickers[i].start();
					} else {
						tickers[i].stop();
					}
				}
			});
		});
	});
</script>
</body>
</html>