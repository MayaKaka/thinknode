define("Class",[],function(){var e=function(){},t=!1,n=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return e.extend=function(r){var i=this,s=this.prototype,o=function(){!t&&this.init&&this.init.apply(this,arguments)};i!==e&&(t=!0,o.prototype=new i),t=!1;var u=o.prototype;for(var a in r)u[a]=typeof s[a]=="function"&&typeof r[a]=="function"&&n.test(r[a])?function(e,t){return function(){var n=this._super;this._super=s[e];var r=t.apply(this,arguments);return this._super=n,r}}(a,r[a]):r[a];return o.extend=arguments.callee,o},e}),define("Ticker",["require","exports","module","Class"],function(e,t,n){var r=e("Class"),i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout,s=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout,o=r.extend({fps:-1,interval:-1,_paused:!0,_timer:null,_targets:null,init:function(e){e?(this.interval=e,this.fps=(1e3/e).toFixed(2)):(this.interval=16.67,this.fps=60),this._targets=[],o._tickers.push(this)},isActive:function(){return!this._paused},start:function(){this._clearTimer(),this._paused=!1,this._setTimer()},stop:function(){this._paused=!0,this._clearTimer()},has:function(e){var t=this._targets;for(var n=t.length-1;n>=0;n--)if(t[n]===e)return!0;return!1},add:function(e){e.update instanceof Function&&(e._ticker&&e._ticker.remove(e),e._ticker=this),this._targets.push(e)},remove:function(e){var t=this._targets;for(var n=t.length-1;n>=0;n--)if(t[n]===e){t.splice(n,1),e._ticker&&(e._ticker=null);break}},removeAll:function(){var e=this._targets,t;while(e.length)t=e.pop(),t._ticker&&(t._ticker=null)},_clearTimer:function(){this._timer&&(s(this._timer),this._timer=null)},_setTimer:function(){var e=this,t=e.interval,n=i===window.setTimeout,r=0,s=0,o=0,u=0,a=(t-1)*.97,f=[],l,c,h=function(){return n?!0:s===0?(s=(new Date).getTime(),!0):(o=(new Date).getTime(),o-s>a?(s=o,!0):!1)},p=function(){if(r===0)r=(new Date).getTime();else{o=(new Date).getTime(),u=o-r,u>t*3&&(u=t),r=o,f.push(u);if(f.length>=10){f.splice(0,5),l=0,c=f.length;for(var n=0;n<c;n++)l+=f[n];e.fps=Math.floor(1e3*c/l)}}e._exec(u)},d=function(){h()&&p(),e._clearTimer(),e._paused||(e._timer=i(d,t))};d()},_exec:function(e){var t=this._targets,n;for(var r=0,i=t.length;r<i;r++){if(this._paused)break;n=t[r],n&&(n.update instanceof Function?n.update(e):n instanceof Function&&n(e))}}});return o._tickers=[],o.destroyAll=function(){var e=this._tickers,t;for(var n=0,r=e.length;n<r;n++)t=e[n],t.isActive()&&t.stop()},o}),define("EventDispatcher",["require","exports","module","Class"],function(e,t,n){var r=e("Class"),i=r.extend({_listeners:null,on:function(e,t){this.addEventListener(e,t)},off:function(e,t){this.removeEventListener(e,t)},trigger:function(e){this.dispatchEvent(e)},addEventListener:function(e,t){this._listeners||(this._listeners={});var n=this._listeners,r=n[e];r||(r=n[e]=[],r.indexOf||(r.indexOf=function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1})),r.indexOf(t)===-1&&r.push(t)},hasEventListener:function(e,t){if(!this._listeners)return!1;var n=this._listeners,r=n[e];return r&&r.indexOf(t)!==-1?!0:!1},removeEventListener:function(e,t){if(!this._listeners)return;var n=this._listeners,r=n[e];if(r){var i=r.indexOf(t);i!==-1&&r.splice(i,1)}},dispatchEvent:function(e){if(!this._listeners)return;var t=this._listeners,n=t[e.type];if(n){e.target=this;for(var r=0,i=n.length;r<i;r++)n[r].call(this,e)}}});return i}),define("Loader",["require","exports","module","EventDispatcher"],function(e,t,n){var r=e("EventDispatcher"),i=r.extend({regexpImage:/\.jpg$|\.png$|\.gif$/,regexpJson:/\.json$/,_resources:null,_loadQueue:null,_loadQueueLength:-1,init:function(){this._resources={},this._loadQueue=[]},load:function(e){var t=this._loadQueueLength=e.length,n,r;for(var i=0;i<t;i++)n=e[i],this.regexpImage.test(n)?r="image":this.regexpJson.test(n)?r="json":r="text",this._loadQueue.push({type:r,url:n});t&&this._loadNext()},loadFile:function(e){e.type==="image"?this._loadImage(e):this._loadJson(e)},hasItem:function(e){return e in this._resources},getItem:function(e){return this._resources[e]},setItem:function(e,t){this._resources[e]=t},_loadComplete:function(e){var t=1;this._loadQueueLength&&(t=1-this._loadQueue.length/this._loadQueueLength,this.trigger({type:"progress",progress:t,file:e})),t<1?this._loadNext():(this._loadQueueLength=0,this.trigger({type:"complete",file:e}))},_loadNext:function(){this.loadFile(this._loadQueue.shift())},_loadImage:function(e){var t=this,n=new Image;n.src=e.url,n.onload=function(){t._loadComplete(n)},this.setItem(e.url,n)},_loadJson:function(e){var t=this,n,r,i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===i.DONE&&(i.status===200||i.status===0)&&(r=i.responseText,r&&(n=e.type==="json"?JSON.parse(r):r,t.setItem(e.url,n),t._loadComplete(n)))},i.open("GET",e.url,!0),i.send(null)}});return i}),define("Preload",["require","exports","module","Loader"],function(e,t,n){var r=e("Loader");return new r}),define("StyleSheet",["require","exports","module","Preload"],function(e,t,n){var r=e("Preload"),i=document.createElement("div").style,s=i.webkitTransform===""?"webkit":i.WebkitTransform===""?"Webkit":i.msTransform===""?"ms":i.MozTransform===""?"Moz":"ct",o=navigator.userAgent.indexOf("MSIE 9.0")>0,u=s==="ct"&&i.filter==="",a=/^\#|^rgb|^rgba|black|red|green|blue|yellow|orange|pink|purple|gray/,f=/^top|^right|^bottom|^left|^center/,l=/\.jpg$|\.png$|\.gif$/,c=function(){};return c.has=function(e){return!!c.styles[e]},c.init=function(e,t){var n=c.styles[t];if(n&&n.init)return n.init.call(e,t)},c.get=function(e,t){var n=c.styles[t];if(n)return n.get.call(e,t)},c.set=function(e,t,n){var r=c.styles[t];r&&r.set.call(e,t,n)},c.step=function(e,t,n){var r=c.styles[t];r&&r.step&&r.step.call(e,t,n)},c.css3=function(e,t,n){var r=t.charAt(0).toUpperCase()+t.substring(1,t.length);e[s+r]=n},c.commonGet=function(e){return this[e]},c.commonSet=function(e,t){this[e]=t},c.commonStep=function(e,t){var n=t.start,r=t.end,i=t.pos,s=(r-n)*i+n;this.style(e,s)},c.commonSteps=function(e,t){var n=t.pos,r=t.start,i=t.end,s={};for(var o in i)s[o]=(i[o]-r[o])*n+r[o];this.style(e,s)},c.toRGBA=function(e){var t={r:0,g:0,b:0,a:1};return e.indexOf("rgb")>-1?(e=e.replace(/rgb\(|rgba\(|\)/g,""),e=e.split(","),t.r=parseInt(e[0]),t.g=parseInt(e[1]),t.b=parseInt(e[2]),e.length===4&&(t.a=e[3])):e.indexOf("#")>-1&&(e.length===4?(t.r=e.substring(1,2),t.g=e.substring(2,3),t.b=e.substring(3,4),t.r=parseInt(t.r+t.r,16),t.g=parseInt(t.g+t.g,16),t.b=parseInt(t.b+t.b,16)):(t.r=parseInt(e.substring(1,3),16),t.g=parseInt(e.substring(3,5),16),t.b=parseInt(e.substring(5,7),16))),t},c.toColor=function(e){var t=e.r.toString(16),n=e.g.toString(16),r=e.b.toString(16);return t.length===1&&(t="0"+t),n.length===1&&(n="0"+n),r.length===1&&(r="0"+r),"#"+t+n+r},c.toGradient=function(e){if(typeof e=="string"){e=e.split(/\,#|\,rgb/);for(var t=1,n=e.length;t<n;t++)e[t]=(e[t].indexOf("(")>-1?"rgb":"#")+e[t]}return e},c.stepColor=function(e,t,n){t=c.toRGBA(t),n=c.toRGBA(n);var r={};for(var i in n)r[i]=Math.floor((n[i]-t[i])*e+t[i]);return c.toColor(r)},c.styles={x:{get:c.commonGet,set:function(e,t){this[e]=t;if(this.renderMode===0){var n=this.elemStyle;n.position="absolute",n.left=t+"px"}},step:c.commonStep},y:{get:c.commonGet,set:function(e,t){this[e]=t;if(this.renderMode===0){var n=this.elemStyle;n.position="absolute",n.top=t+"px"}},step:c.commonStep},z:{get:c.commonGet,set:function(e,t){this[e]=t,this.style("transform3d",{perspective:t})},step:c.commonStep},pos:{get:function(e){return{x:this.x,y:this.y}},set:function(e,t){t.x!==undefined&&(this.x=t.x),t.y!==undefined&&(this.y=t.y);if(this.renderMode===0){var n=this.elemStyle;n.position="absolute",n.left=this.x+"px",n.top=this.y+"px"}},step:c.commonSteps},width:{get:c.commonGet,set:function(e,t){this[e]=t,this.renderMode===0&&(this.useElemSize?this.elem.width=t:this.elemStyle.width=t+"px")},step:c.commonStep},height:{get:c.commonGet,set:function(e,t){this[e]=t,this.renderMode===0&&(this.useElemSize?this.elem.height=t:this.elemStyle.height=t+"px")},step:c.commonStep},size:{get:function(e){return{width:this.width,height:this.height}},set:function(e,t){t.width!==undefined&&(this.width=t.width),t.height!==undefined&&(this.height=t.height);if(this.renderMode===0)if(this.useElemSize){var n=this.elem;n.width=this.width,n.height=this.height}else{var r=this.elemStyle;r.width=this.width+"px",r.height=this.height+"px"}},step:c.commonSteps},transform:{init:function(e){return this.transform={translateX:0,translateY:0,rotate:0,scale:1,scaleX:1,scaleY:1,skewX:0,skewY:0,originX:.5,originY:.5},this.transform},get:function(e){return this.transform||c.init(this,e)},set:function(e,t){var n=c.get(this,e);for(var r in t)this._updateTransform(r,t[r]);if(this.renderMode===0){var i=this.elemStyle;if(u){var s=this.elem,o=i.filter,a=/Matrix([^)]*)/,f=this._updateMatrix2D(!0),l=["Matrix(M11="+f.a,"M12="+f.b,"M21="+f.c,"M22="+f.d,"SizingMethod='auto expand'"].join(",");i.filter=a.test(o)?o.replace(a,l):"progid:DXImageTransform.Microsoft."+l+") "+o,i.marginLeft=n.translateX+(s.clientWidth-s.offsetWidth)*n.originX+"px",i.marginTop=n.translateY+(s.clientHeight-s.offsetHeight)*n.originY+"px"}else c.css3(i,"transform",this._mergeTransformText()),("originX"in t||"originY"in t)&&c.css3(i,"transformOrigin",n.originX*100+"% "+n.originY*100+"%")}},step:c.commonSteps},transform3d:{init:function(e){this.transform3d={perspective:0,translateX:0,translateY:0,translateZ:0,rotateX:0,rotateY:0,rotateZ:0,scaleX:1,scaleY:1,scaleZ:1,originX:.5,originY:.5,originZ:.5};if(this.renderMode===0){var t=this.elemStyle;c.css3(t,"transformStyle","preserve-3d"),c.css3(t,"backfaceVisibility","visible")}return this.transform3d},get:function(e){return this.transform3d||c.init(this,e)},set:function(e,t){var n=c.get(this,e);for(var r in t)this._updateTransform3D(r,t[r]);if(this.renderMode===0){var i=this.elemStyle;c.css3(i,"transform",this._mergeTransform3DText()),("originX"in t||"originY"in t||"originZ"in t)&&c.css3(i,"transformOrigin",n.originX*100+"% "+n.originY*100+"%")}},step:c.commonSteps},visible:{get:c.commonGet,set:function(e,t){this[e]=t,this.renderMode===0&&(this.elemStyle.display=t?"block":"none")}},overflow:{get:c.commonGet,set:function(e,t){this[e]=t,this.renderMode===0&&(this.elemStyle.overflow=t)}},alpha:{get:c.commonGet,set:function(e,t){t=t>=0?t:0,this[e]=t;if(this.renderMode===0){var n=this.elemStyle;if(u){var r=n.filter,i=/alpha\(opacity=([^)]*)/,s="alpha(opacity="+t*100;n.filter=i.test(r)?r.replace(i,s):r+" "+s+")"}else n.opacity=t}},step:c.commonStep},shadow:{get:c.commonGet,set:function(e,t){typeof t=="string"&&(t=t.split("px "),t={offsetX:parseFloat(t[0]),offsetY:parseFloat(t[1]),blur:parseFloat(t[2]),color:t[3]}),this[e]=t,this.renderMode===0&&(this.elemStyle.boxShadow=t.offsetX+"px "+t.offsetY+"px "+t.blur+"px "+t.color)},step:c.commonSteps},fill:{get:function(e){return this.fillColor||this.fillGradient||this.fillImage},set:function(e,t){a.test(t)?this.style("fillColor",t):f.test(t)?this.style("fillGradient",t):l.test(t)&&this.style("fillImage",t)},step:function(e,t){var n=t.end;a.test(n)?this._stepStyle("fillColor",t):f.test(n)&&this._stepStyle("fillGradient",t)}},fillColor:{get:c.commonGet,set:function(e,t){this.fillGradient=this.fillImage=null,this[e]=t,this.renderMode===0&&(this.elemStyle.backgroundColor=t,this.elemStyle.backgroundImage="")},step:function(e,t){this.style(e,c.stepColor(t.pos,t.start,t.end))}},fillGradient:{get:c.commonGet,set:function(e,t){this.fillColor=this.fillImage=null,this[e]=t=c.toGradient(t);if(this.renderMode===0){var n=this.elemStyle,r;if(u||o){var i=n.filter,s=/gradient([^)]*)/;r="gradient(GradientType=0,startColorstr='"+t[1]+"', endColorstr='"+t[2]+"'",n.filter=s.test(i)?i.replace(s,r):i+" progid:DXImageTransform.Microsoft."+r+")"}else t[0]==="center"?r="radial-gradient(circle,"+t[1]+","+t[2]+")":r="linear-gradient("+t[0]+","+t[1]+","+t[2]+")",n.backgroundImage="-webkit-"+r,n.backgroundImage="-ms-"+r,n.backgroundImage="-moz-"+r}},step:function(e,t){var n=t.start,r=t.end,r=c.toGradient(r),i=t.pos,s=[r[0]];s.push(c.stepColor(i,n[1],r[1])),s.push(c.stepColor(i,n[2],r[2])),this.style(e,s)}},fillImage:{get:c.commonGet,set:function(e,t){this.fillColor=this.fillGradient=null,this.renderMode===0?this.elemStyle.backgroundImage="url("+t+")":(r.hasItem(t)||r.loadFile({type:"image",url:t}),t=r.getItem(t)),this[e]=t}},stroke:{get:function(e){return this.strokeColor},set:function(e,t){this.style("strokeColor",t)},step:function(e,t){this._stepStyle("strokeColor",t)}},strokeColor:{get:c.commonGet,set:function(e,t){this[e]=t;if(this.renderMode===0){var n=this.elemStyle;n.borderColor=t,n.borderStyle="solid"}},step:function(e,t){this.style(e,c.stepColor(t.pos,t.start,t.end))}},lineWidth:{get:c.commonGet,set:function(e,t){this[e]=t,this.renderMode===0&&(this.elemStyle.borderWidth=t+"px")},step:c.commonStep},radius:{get:c.commonGet,set:function(e,t){this[e]=t,this.width=this.height=t*2;if(this.renderMode===0){var n=this.elemStyle;n.borderRadius="50%",n.width=n.height=this.width+"px"}},step:c.commonStep},angle:{get:c.commonGet,set:c.commonSet,step:c.commonStep},radiusXY:{get:function(e){return{radiusX:this.radiusX,radiusY:this.radiusY}},set:function(e,t){t.radiusX!==undefined&&(this.radiusX=t.radiusX,this.width=this.radiusX*2),t.radiusY!==undefined&&(this.radiusY=t.radiusY,this.height=this.radiusY*2);if(this.renderMode===0){var n=this.elemStyle;n.borderRadius="50%",n.width=this.width+"px",n.height=this.height+"px"}},step:c.commonSteps},font:{get:c.commonGet,set:c.commonSet,step:c.commonStep},textColor:{get:c.commonGet,set:c.commonSet,step:c.commonStep}},c}),define("PrivateData",["require","exports","module","Class"],function(e,t,n){var r=e("Class"),i=r.extend({_data:null,init:function(){this._data={}},get:function(e){return this._data[e]},set:function(e,t){return this._data[e]=t,t}});return i}),define("Matrix2D",["require","exports","module","Class"],function(e,t,n){var r=e("Class"),i=Math.PI/180,s=r.extend({a:1,b:0,c:0,d:1,tx:0,ty:0,prepend:function(e,t,n,r,i,s){var o=this.tx;if(e!=1||t!=0||n!=0||r!=1){var u=this.a,a=this.c;this.a=u*e+this.b*n,this.b=u*t+this.b*r,this.c=a*e+this.d*n,this.d=a*t+this.d*r}return this.tx=o*e+this.ty*n+i,this.ty=o*t+this.ty*r+s,this},append:function(e,t,n,r,i,s){var o=this.a,u=this.b,a=this.c,f=this.d;return this.a=e*o+t*a,this.b=e*u+t*f,this.c=n*o+r*a,this.d=n*u+r*f,this.tx=i*o+s*a+this.tx,this.ty=i*u+s*f+this.ty,this},prependMatrix:function(e){return this.prepend(e.a,e.b,e.c,e.d,e.tx,e.ty),this},appendMatrix:function(e){return this.append(e.a,e.b,e.c,e.d,e.tx,e.ty),this},prependTransform:function(e,t,n,r,s,o,u){if(s%360)var a=s*i,f=Math.cos(a),l=Math.sin(a);else f=1,l=0;return o||u?(o*=i,u*=i,this.prepend(f*n,l*n,-l*r,f*r,0,0),this.prepend(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),e,t)):this.prepend(f*n,l*n,-l*r,f*r,e,t),this},appendTransform:function(e,t,n,r,s,o,u){if(s%360)var a=s*i,f=Math.cos(a),l=Math.sin(a);else f=1,l=0;return o||u?(o*=i,u*=i,this.append(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),e,t),this.append(f*n,l*n,-l*r,f*r,0,0)):this.append(f*n,l*n,-l*r,f*r,e,t),this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this},skew:function(e,t){return e*=i,t*=i,this.append(Math.cos(t),Math.sin(t),-Math.sin(e),Math.cos(e),0,0),this},scale:function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},translate:function(e,t){return this.tx+=e,this.ty+=t,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},invert:function(){var e=this.a,t=this.b,n=this.c,r=this.d,i=this.tx,s=e*r-t*n;return this.a=r/s,this.b=-t/s,this.c=-n/s,this.d=e/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(e*this.ty-t*i)/s,this},isIdentity:function(){return this.tx==0&&this.ty==0&&this.a==1&&this.b==0&&this.c==0&&this.d==1},transformPoint:function(e,t,n){return n=n||{},n.x=e*this.a+t*this.c+this.tx,n.y=e*this.b+t*this.d+this.ty,n}});return s}),define("Ease",["require","exports","module"],function(e,t,n){var r=function(){};r.get=function(e){return i[e]||i.linear};var i={none:function(e){return e>=1?1:0},linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,s){return r-i.easeOutBounce(e,s-t,0,r,s)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,s){return t<s/2?i.easeInBounce(e,t*2,0,r,s)*.5+n:i.easeOutBounce(e,t*2-s,0,r,s)*.5+r*.5+n},easeIn:function(e,t,n,r,s){return i.easeInQuad(e,t,n,r,s)},easeOut:function(e,t,n,r,s){return i.easeOutQuad(e,t,n,r,s)},easeInOut:function(e,t,n,r,s){return i.easeInOutQuad(e,t,n,r,s)},expoIn:function(e,t,n,r,s){return i.easeInExpo(e,t,n,r,s)},expoOut:function(e,t,n,r,s){return i.easeOutExpo(e,t,n,r,s)},expoInOut:function(e,t,n,r,s){return i.easeInOutExpo(e,t,n,r,s)},bounceIn:function(e,t,n,r,s){return i.easeInBounce(e,t,n,r,s)},bounceOut:function(e,t,n,r,s){return i.easeOutBounce(e,t,n,r,s)},bounceInOut:function(e,t,n,r,s){return i.easeInOutBounce(e,t,n,r,s)},elasIn:function(e,t,n,r,s){return i.easeInElastic(e,t,n,r,s)},elasOut:function(e,t,n,r,s){return i.easeOutElastic(e,t,n,r,s)},elasInOut:function(e,t,n,r,s){return i.easeInOutElastic(e,t,n,r,s)},backIn:function(e,t,n,r,s){return i.easeInBack(e,t,n,r,s)},backOut:function(e,t,n,r,s){return i.easeOutBack(e,t,n,r,s)},backInOut:function(e,t,n,r,s){return i.easeInOutBack(e,t,n,r,s)}};return r.easing=i,jQuery&&jQuery.extend(jQuery.easing,i),r}),define("Tween",["require","exports","module","Class","Ease"],function(e,t,n){var r=e("Class"),i=e("Ease"),s=r.extend({_done:!1,_target:null,_deltaTime:-1,_start:null,_end:null,_duration:null,_easing:null,_callback:null,_frameDone:null,init:function(e,t){this._target=e,this._deltaTime=0;var n=t.start,r=t.end;if(n)e.style(n);else{n={};for(var s in r)n[s]=this._clone(e.style(s))}this._start=n,this._end=r,this._duration=t.duration,this._easing=i.get(t.easing),this._callback=t.callback,this._frameDone=t.frameDone},update:function(e){if(this._done)return;var t=this._target,n=this._start,r=this._end,i=this._duration,s=this._easing,o=this._deltaTime,u=o/i,a=s(u,u,0,1,1);for(var f in r)t._stepStyle(f,{pos:a,start:n[f],end:r[f]});this._frameDone&&this._frameDone(u,a);if(o===i)this._done=!0,this._callback&&this._callback();else{var l=o+e;this._deltaTime=l>i?i:l}},_clone:function(e){var t;if(typeof e=="object"){t={};for(var n in e)t[n]=this._clone(e[n])}else t=e;return t}});return s._tweens=[],s._currentTarget=null,s.update=function(e){var t=this._tweens;for(var n=t.length-1;n>=0;n--)t[n]._done&&t.splice(n,1);for(var n=0,r=t.length;n<r;n++)t[n].update(e)},s.get=function(e){return this._currentTarget=e,this},s.addTween=function(e,t,n,r,i){var o=this._currentTarget,u=o.data("fx_queue");typeof e=="number"&&(r=t,t=e,e={},n="none");var a=function(){r&&r(),u=o.data("fx_queue"),u&&u.length>0?u.shift()():o.data("fx_queue",null)},f=function(){var r=new s(o,{start:null,end:e,duration:t||300,easing:n||"linear",callback:a,frameDone:i});s._tweens.push(r)};u?u.push(f):(f(),o.data("fx_queue",[]))},s}),define("DisplayObject",["require","exports","module","EventDispatcher","PrivateData","StyleSheet","Matrix2D","Tween"],function(e,t,n){var r=e("EventDispatcher"),i=e("PrivateData"),s=e("StyleSheet"),o=e("Matrix2D"),u=e("Tween"),a=document.createElement("div"),f=!!document.createElement("canvas").getContext,l=r.extend({x:0,y:0,width:0,height:0,visible:!0,overflow:"visible",alpha:1,shadow:null,transform:null,transform3d:null,parent:null,elem:null,elemStyle:null,renderMode:0,blendMode:"source-over",mouseEnabled:!0,_tagName:"div",_children:null,_matrix2d:null,_privateData:null,init:function(e){e||(e={}),e.renderMode&&(this.renderMode=e.renderMode);if(this.renderMode===0){var t=e.elem;typeof t=="string"&&(/^<.+>$/.test(t)?(a.innerHTML=t,t=a.removeChild(a.children[0])):t=document.querySelector?document.querySelector(t):null),this.elem=t||document.createElement(this._tagName),this.elem.displayObj=this,this.elemStyle=this.elem.style,window.jQuery&&(this.$=jQuery(this.elem))}else e.blendMode&&(this.blendMode=e.blendMode);this._children=[],this._matrix2d=new o,this._privateData=new i;for(var n in e)s.has(n)&&this.style(n,e[n]);this.transform||s.init(this,"transform")},addChild:function(e){e.parent&&e.parent.removeChild(e),e.parent=this,e.renderMode===0?this.elem&&this.elem.appendChild(e.elem):this._children.push(e)},removeChild:function(e){if(e.parent===this){e.parent=null;if(e.renderMode===0)this.elem&&this.elem.removeChild(e.elem);else{var t=this._children;for(var n=t.length-1;n>=0;n--)if(t[n]===e){t.splice(n,1);break}}}},removeAllChildren:function(){var e,t;if(this.renderMode===0){var n=this.elem;e=n.children;while(e.length)t=e[e.length-1],t.displayObj&&(t.displayObj.parent=null),n.removeChild(t)}else{var r=-1;e=this._children;while(e.length)r=e.length-1,t=e[r],t.parent=null,e.splice(r,1)}},eachChildren:function(e){var t=this.renderMode===0?this.elem.children:this._children,n;for(var r=0,i=t.length;r<i;r++)n=this.renderMode===0?t[r].displayObj:t[r],n&&e(n,r)},enableEvents:function(e){this.mouseEnabled=e?!0:!1,this.renderMode===0&&(this.elemStyle.pointerEvents=e?"auto":"none")},style:function(e,t){if(t===undefined){if(typeof e!="object")return s.get(this,e);for(var n in e)s.set(this,n,e[n])}else s.set(this,e,t)},data:function(e,t){if(t===undefined){if(typeof e!="object")return this._privateData.get(e);for(var n in e)this._privateData.set(n,e[n])}else this._privateData.set(e,t)},to:function(e,t,n,r,i){return u.get(this).addTween(e,t,n,r,i),this},draw:function(e){if(!this._children.length)return;this.overflow==="hidden";var t=this._children,n;for(var r=0,i=t.length;r<i;r++)n=t[r],n.visible&&(e.save(),n._drawCanvas(e),e.restore())},cache:function(){if(f){var e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.draw(e.getContext("2d")),this._cacheCanvas=e}},uncache:function(){this._cacheCanvas=null},_stepStyle:function(e,t){s.step(this,e,t)},_updateTransform:function(e,t){e==="scale"?this.transform.scale=this.transform.scaleX=this.transform.scaleY=t:e in this.transform&&(this.transform[e]=t)},_updateTransform3D:function(e,t){e in this.transform3d&&(this.transform3d[e]=t)},_mergeTransformText:function(){var e=this.transform,t="";if(e.translateX!==0||e.translateY!==0)t+="translate("+e.translateX+"px,"+e.translateY+"px"+")";e.rotate!==0&&(t+=" rotate("+e.rotate+"deg)");if(e.scaleX!==1||e.scaleY!==1)t+=" scale("+e.scaleX+","+e.scaleY+")";if(e.skewX!==0||e.skewY!==0)t+=" skew("+e.skewX+"deg,"+e.skewY+"deg)";return t},_mergeTransform3DText:function(){var e=this.transform3d,t="";e.perspective!==0&&(t+="perspective("+e.perspective+"px)");if(e.translateX!==0||e.translateY!==0||e.translateZ!==0)t+=" translate3d("+e.translateX+"px,"+e.translateY+"px,"+e.translateZ+"px)";e.rotateX!==0&&(t+=" rotateX("+e.rotateX+"deg)"),e.rotateY!==0&&(t+=" rotateY("+e.rotateY+"deg)"),e.rotateZ!==0&&(t+=" rotateZ("+e.rotateZ+"deg)");if(e.scaleX!==1||e.scaleY!==1||e.scaleZ!==1)t+=" scale3d("+e.scaleX+","+e.scaleY+","+e.scaleZ+")";return t},_drawCanvas:function(e){this._updateCanvasContext(e),this._cacheCanvas?e.drawImage(this._cacheCanvas,0,0):this.draw(e)},_updateCanvasContext:function(e){var t=this._updateMatrix2D(),n=this._getAnchorX(),r=this._getAnchorY(),i=this.shadow;n===0&&r===0?e.transform(t.a,t.b,t.c,t.d,t.tx,t.ty):(e.transform(t.a,t.b,t.c,t.d,t.tx+n,t.ty+r),e.transform(1,0,0,1,-n,-r)),e.globalAlpha*=this.alpha,e.globalCompositeOperation=this.blendMode,i&&(e.shadowOffsetX=i.offsetX,e.shadowOffsetY=i.offsetY,e.shadowBlur=i.blur,e.shadowColor=i.color)},_getAnchorX:function(){return this.width*this.transform.originX},_getAnchorY:function(){return this.height*this.transform.originY},_updateMatrix2D:function(e){var t=this._matrix2d.identity(),n=this.transform;return e?t.rotate(-n.rotate%360*o.DEG_TO_RAD).scale(n.scaleX,n.scaleY):t.appendTransform(this.x+n.translateX,this.y+n.translateY,n.scaleX,n.scaleY,n.rotate,n.skewX,n.skewY)}});return l.setRenderMode=function(e){e==="canvas"||e===1?l.prototype.renderMode=1:l.prototype.renderMode=0},l}),define("Container",["require","exports","module","DisplayObject"],function(e,t,n){var r=e("DisplayObject"),i=r.extend({renderMode:0,init:function(e){this._super(e),this._initEvents()},_initEvents:function(){var e=this,t=this.elem,n,r,i,s,o,u,a=function(t){t.preventDefault(),n=e._getMouseX(t),r=e._getMouseY(t),i=e._hitTest(t.target)||e,e._triggerEvent("mousedown",i,n,r),s=!1,o=n,u=r},f=function(t){t.preventDefault(),e._triggerEvent("mouseup",i,n,r),s||e._triggerEvent("click",i,n,r),i=null},l=function(t){t.preventDefault(),n=e._getMouseX(t),r=e._getMouseY(t),e._triggerEvent("mousemove",i,n,r),!s&&(Math.abs(n-o)>3||Math.abs(r-u)>3)&&(s=!0)};t.addEventListener||(t.addEventListener=t.attachEvent),"ontouchstart"in window?(t.addEventListener("touchstart",a),t.addEventListener("touchend",f),t.addEventListener("touchmove",l)):(t.addEventListener("mousedown",a),t.addEventListener("mouseup",f),t.addEventListener("mousemove",l))},_getMouseX:function(e){var t=e.touches?e.touches[0]:e,n=this.elem.getBoundingClientRect().left;return t.clientX-n},_getMouseY:function(e){var t=e.touches?e.touches[0]:e,n=this.elem.getBoundingClientRect().top;return t.clientY-n},_triggerEvent:function(e,t,n,r){if(t){var i={type:e,srcTarget:t,mouseX:n,mouseY:r};while(t)t.trigger(i),t=t.parent}},_hitTest:function(e){var t;while(!t&&e&&e!==this.elem)t=e.displayObj,e=e.parentNode;return t}});return i}),define("Canvas",["require","exports","module","DisplayObject","Matrix2D"],function(e,t,n){var r=e("DisplayObject"),i=e("Matrix2D"),s=r.extend({renderMode:0,useElemSize:!0,_tagName:"canvas",_context2d:null,init:function(e){this._super(e),this._initEvents(),this._context2d=this.elem.getContext("2d")},removeAllChildren:function(){var e=this._children,t,n;while(e.length)t=e.length-1,n=e[t],n.parent=null,e.splice(t,1)},eachChildren:function(e){var t=this._children;for(var n=0,r=t.length;n<r;n++)e(t[n],n)},clear:function(){this._context2d.clearRect(0,0,this.width,this.height)},update:function(){var e=this._context2d;e.clearRect(0,0,this.width,this.height),this.draw(e)},_initEvents:function(){var e=this,t=this.elem,n,r,i,s,o,u,a=function(t){t.preventDefault(),n=e._getMouseX(t),r=e._getMouseY(t),i=e._hitTest(e._children,n,r)||e,e._triggerEvent("mousedown",i,n,r),s=!1,o=n,u=r},f=function(t){t.preventDefault(),e._triggerEvent("mouseup",i,n,r),s||e._triggerEvent("click",i,n,r),i=null},l=function(t){t.preventDefault(),n=e._getMouseX(t),r=e._getMouseY(t),e._triggerEvent("mousemove",i,n,r),!s&&(Math.abs(n-o)>3||Math.abs(r-u)>3)&&(s=!0)};t.addEventListener||(t.addEventListener=t.attachEvent),"ontouchstart"in window?(t.addEventListener("touchstart",a),t.addEventListener("touchend",f),t.addEventListener("touchmove",l)):(t.addEventListener("mousedown",a),t.addEventListener("mouseup",f),t.addEventListener("mousemove",l))},_getMouseX:function(e){return e.offsetX===undefined?e.layerX:e.offsetX},_getMouseY:function(e){return e.offsetY===undefined?e.layerY:e.offsetY},_triggerEvent:function(e,t,n,r){if(t){var i={type:e,srcTarget:t,mouseX:n,mouseY:r};while(t)t.trigger(i),t=t.parent}},_hitTest:function(e,t,n){var r;for(var i=e.length-1;i>=0;i--){r=e[i];if(r._children.length){r=this._hitTest(r._children,t,n);if(r)return r}else if(this._hitTestMatrix(r,t,n))return r}return null},_hitTestMatrix:function(e,t,n){if(!e.visible||!e.mouseEnabled)return!1;var r=new i,s=[],o,u,a;while(e&&e!==this)s.unshift(e),e=e.parent;r.append(1,0,0,1,-t,-n);for(var f=0,l=s.length;f<l;f++)e=s[f],a=e._matrix2d,o=e._getAnchorX(),u=e._getAnchorY(),o===0&&u===0?r.append(a.a,a.b,a.c,a.d,a.tx,a.ty):(r.append(a.a,a.b,a.c,a.d,a.tx+o,a.ty+u),r.append(1,0,0,1,-o,-u));r.invert();var c=r.tx,h=r.ty,p=e.radius,d=e.width,v=e.height;return p?p*p>=(c-p)*(c-p)+(h-p)*(h-p):d&&v?c>=0&&c<=d&&h>=0&&h<=v:!1}});return s}),define("Graphics2D",["require","exports","module"],function(e,t,n){var r=function(){};return r.get=function(e){return r.shapes[e]},r.commonStyle=function(e,t){t.stroke&&t.lineWidth===undefined&&(t.lineWidth=1),e.style("fill",t.fill),e.style("stroke",t.stroke),e.style("lineWidth",t.lineWidth)},r.commonDraw=function(e,t,n){t&&e.fill(),n&&e.stroke()},r.shapes={rect:{type:"rect",init:function(e){this.style("size",e),r.commonStyle(this,e)},draw:function(e){this.setFill(e)&&e.fillRect(0,0,this.width,this.height),this.setStroke(e)&&e.strokeRect(0,0,this.width,this.height)}},circle:{type:"circle",init:function(e){e.angle===undefined&&(e.angle=360),this.style("radius",e.radius),this.style("angle",e.angle),r.commonStyle(this,e)},draw:function(e){var t=this.radius,n=this.setFill(e),i=this.setStroke(e);e.beginPath(),e.arc(t,t,t,0,this.angle/360*Math.PI*2,0),this.angle<360&&e.lineTo(t,t),e.closePath(),r.commonDraw(e,n,i)}},ellipse:{type:"ellipse",init:function(e){this.style("radiusXY",e),r.commonStyle(this,e)},draw:function(e){var t=.5522848,n=this.radiusX,i=this.radiusY,s=n*t,o=i*t,u=n*2,a=i*2,f=this.setFill(e),l=this.setStroke(e);e.beginPath(),e.moveTo(0,i),e.bezierCurveTo(0,i-o,n-s,0,n,0),e.bezierCurveTo(n+s,0,u,i-o,u,i),e.bezierCurveTo(u,i+o,n+s,a,n,a),e.bezierCurveTo(n-s,a,0,i+o,0,i),e.closePath(),r.commonDraw(e,f,l)}},line:{type:"line",init:function(e){e.lineWidth===undefined&&(e.lineWidth=1),this.path=e.path,this.style("stroke",e.stroke),this.style("lineWidth",e.lineWidth)},draw:function(e){var t=this.path,n,r=this.setStroke(e);if(r&&t.length>1){e.beginPath();for(var i=0,s=t.length;i<s;i++)n=t[i],i===0?e.moveTo(n[0],n[1]):n.length===2?e.lineTo(n[0],n[1]):n.length===4?e.quadraticCurveTo(n[0],n[1],n[2],n[3]):n.length===6&&e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);e.stroke()}}},ploygon:{type:"ploygon",init:function(e){this.path=e.path,r.commonStyle(this,e)},draw:function(e){var t=this.path,n,i=this.setFill(e),s=this.setStroke(e);if(t.length>2){e.beginPath();for(var o=0,u=t.length;o<u;o++)n=t[o],o===0?e.moveTo(n[0],n[1]):n.length===2?e.lineTo(n[0],n[1]):n.length===4?e.quadraticCurveTo(n[0],n[1],n[2],n[3]):n.length===6&&e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);e.closePath(),r.commonDraw(e,i,s)}}},polyStar:{type:"polyStar",init:function(e){this.sides=e.sides,this.cohesion=e.cohesion,this.style("radius",e.radius),r.commonStyle(this,e)},draw:function(e){var t=this.radius,n=this.sides,i=this.cohesion,s,o,u,a=this.setFill(e),f=this.setStroke(e);e.beginPath();for(var l=0;l<n;l++)s=l/n*Math.PI*2,o=(1-Math.sin(s))*t,u=(1-Math.cos(s))*t,l===0?e.moveTo(o,u):e.lineTo(o,u),i&&(s+=Math.PI/n,o=(1-Math.sin(s)*i)*t,u=(1-Math.cos(s)*i)*t,e.lineTo(o,u));e.closePath(),r.commonDraw(e,a,f)}},roundRect:{type:"roundRect",init:function(){},draw:function(){}},lines:{type:"lines",init:function(e){e.lineWidth===undefined&&(e.lineWidth=1),this.paths=e.paths,this.style("stroke",e.stroke),this.style("lineWidth",e.lineWidth)},draw:function(e){var t=this.paths,n,r,i=this.setStroke(e);if(i&&t.length){e.beginPath();for(var s=0,o=t.length;s<o;s++){n=t[s];if(n.length>1)for(var u=0,a=n.length;u<a;u++)r=n[u],u===0?e.moveTo(r[0],r[1]):r.length===2?e.lineTo(r[0],r[1]):r.length===4?e.quadraticCurveTo(r[0],r[1],r[2],r[3]):r.length===6&&e.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5])}e.stroke()}}}},r}),define("Shape",["require","exports","module","DisplayObject","Graphics2D"],function(e,t,n){var r=e("DisplayObject"),i=e("Graphics2D"),s=r.extend({graphics:null,snapToPixel:!0,init:function(e){this._super(e),this._initGraphics(e.graphics)},draw:function(e){this.graphics&&this.graphics.draw.call(this,e)},setFill:function(e){var t=this.fillColor,n=this.fillGradient,r=this.fillImage;if(r)r.complete&&(t=e.createPattern(r,"no-repeat"));else if(n){switch(n[0]){case"top":case"bottom":t=e.createLinearGradient(0,0,0,this.height);break;case"left":case"right":t=e.createLinearGradient(0,0,this.width,0);break;case"left top":t=e.createLinearGradient(0,0,this.width,this.height);break;case"right top":t=e.createLinearGradient(this.width,0,0,this.height);break;case"center":var i=this.width/2,s=this.height/2;t=e.createRadialGradient(i,s,0,i,s,i>s?i:s)}t.addColorStop(0,n[1]),t.addColorStop(1,n[2])}return t?(e.fillStyle=t,!0):!1},setStroke:function(e){var t=this.strokeColor,n=this.lineWidth;if(t&&n){e.strokeStyle=t,e.lineWidth=n,e.lineCap=this.lineCap||"round",e.lineJoin=this.lineJoin||"round";if(this.snapToPixel&&n===1){var r=this._matrix2d;e.translate(r.tx>=0?.5:-0.5,r.ty>=0?.5:-0.5)}return!0}return!1},_initGraphics:function(e){var t=e.type,n=t?i.get(t):e;n&&n.init&&n.draw&&(this.graphics=n,n.init.call(this,e))}});return s}),define("Filter",["require","exports","module"],function(e,t,n){var r=function(){};return r.get=function(e,t,n){var i=r.filters[t];if(i)return i(e,n)},r.filters={grayscale:function(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");r.drawImage(e,0,0);var i=r.getImageData(0,0,n.width,n.height),s=i.data,o;for(var u=0,a=s.length;u<a;u+=4)o=(s[u]+s[u+1]+s[u+2])/3,s[u]=s[u+1]=s[u+2]=o;return r.putImageData(i,0,0),n},brightness:function(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.drawImage(e,0,0),r.globalCompositeOperation="lighter",r.drawImage(e,0,0),n},impression:function(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");r.drawImage(e,0,0);var i=r.getImageData(0,0,n.width,n.height),s=i.data,o=["1","0"],u=[];for(var a=0,f=s.length;a<f;a+=16){if(Math.floor(a/4/n.width)%4)continue;u.push(["rgba("+s[a]+","+s[a+1]+","+s[a+2]+","+s[a+3]+")",o[Math.floor(Math.random()*o.length)],a/4%n.width,Math.floor(a/4/n.width)])}r.clearRect(0,0,n.width,n.height),r.font="40px Microsoft Yahei",r.textBaseline="middle",r.textAlign="center",r.globalAlpha=.25;var l,c;while(u.length)l=Math.floor(Math.random()*u.length),c=u[l],r.fillStyle=c[0],r.fillText(c[1],c[2],c[3]),u.splice(l,1);return n},rilievo:function(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");r.drawImage(e,0,0);var i=r.getImageData(0,0,n.width,n.height),s=i.data,o,u,a,f=function(e){return e<0?e=0:e>255&&(e=255),e};for(var l=0,c=s.length;l<c;l+=4)o=l+4,s[o]===undefined&&(o=l),u=Math.floor(s[o]+s[o+1]+s[o+2]-(s[l]+s[l+1]+s[l+2])),a=f(u+128),s[l]=s[l+1]=s[l+2]=a;return r.putImageData(i,0,0),n}},r}),define("Bitmap",["require","exports","module","DisplayObject","Preload","Filter"],function(e,t,n){var r=e("DisplayObject"),i=e("Preload"),s=e("Filter"),o=!!document.createElement("canvas").getContext,u=document.createElement("div").style,a=u.webkitTransform===""?"webkit":u.WebkitTransform===""?"Webkit":u.msTransform===""?"ms":u.MozTransform===""?"Moz":"ct",f=r.extend({_image:null,_srcRect:null,_srcCanvas:null,_scaleToFit:!1,init:function(e){this._super(e),this._initImage(e)},draw:function(e){if(this._image.complete){var t=this._srcCanvas||this._image;this._srcRect?e.drawImage(t,this._srcRect[0],this._srcRect[1],this.width,this.height,0,0,this.width,this.height):this._scaleToFit?e.drawImage(t,0,0,t.width,t.height,0,0,this.width,this.height):e.drawImage(t,0,0,this.width,this.height,0,0,this.width,this.height)}},applyFilter:function(e,t){if(this.renderMode===0)this.elemStyle[a+"Filter"]=e?e+"("+t+")":"";else if(this.renderMode===1){var n=this._image;if(n.complete)this._srcCanvas=e&&o?s.get(n,e,t):null;else{var r=this;n.addEventListener||(n.addEventListener=n.attachEvent),n.addEventListener("load",function(){r.applyFilter(e,t)})}}},_initImage:function(e){var t=e.image;e.sourceRect?(this._srcRect=e.sourceRect,this.style("size",{width:this._srcRect[2],height:this._srcRect[3]})):e.scaleToFit&&(this._scaleToFit=e.scaleToFit),this.renderMode===0?(this.elemStyle.backgroundImage="url("+t+")",this.elemStyle.backgroundRepeat="no-repeat",this._srcRect?this.elemStyle.backgroundPosition="-"+this._srcRect[0]+"px -"+this._srcRect[1]+"px":this._scaleToFit&&(this.elemStyle.backgroundSize="100% 100%")):this.renderMode===1&&(typeof t=="string"?(i.hasItem(t)||i.loadFile({type:"image",url:t}),this._image=i.getItem(t)):this._image=t)}});return f}),define("Text",["require","exports","module","DisplayObject"],function(e,t,n){var r=e("DisplayObject"),i=r.extend({text:null,init:function(e){this._super(e),this._initText(e)},value:function(e){if(e===undefined)return this.text;this.text=e,this.renderMode===0&&(this.elem.innerHTML=e)},draw:function(e){e.font=this.font,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.fillStyle=this.textColor,e.fillText(this.text,0,0)},_initText:function(e){this.font=e.font||"20px Microsoft Yahei",this.textAlign=e.align||"left",this.textBaseline=e.baseline||"top",this.textColor=e.color||"black",this.value(e.text||""),this.renderMode===0&&(this.elemStyle.color=this.textColor)}});return i}),define("Timeline",["require","exports","module","Class","Ease"],function(e,t,n){var r=e("Class"),i=e("Ease"),s=r.extend({_paused:!0,_loop:!1,_targets:null,_currentTarget:null,_deltaTime:-1,_duration:-1,init:function(e){this._paused=!1,this._loop=e?!!e.loop:!1,this._targets=[],this._deltaTime=0,this._duration=0},play:function(e){typeof e=="number"?this.gotoAndPlay(e):this._paused=!1},stop:function(){this._paused=!0},gotoAndPlay:function(e){this._paused=!1,this._deltaTime=e},has:function(e){var t=this._targets;for(var n=t.length-1;n>=0;n--)if(t[n]===e)return!0;return!1},get:function(e){return this.has(e)||(this.removeKeyframes(e),e.data("tl_queue",[]),e.data("tl_start",{}),this._targets.push(e)),this._currentTarget=e,this},getTime:function(){return this._deltaTime},addKeyframe:function(e,t,n,r){var i=this._currentTarget,s=i.data("tl_queue"),o=i.data("tl_start");for(var u in e)o[u]=this._clone(i.style(u));s.push([e,t,n||"linear",r]),s.sort(function(e,t){return e[1]-t[1]});var a=[],f,l=0;for(var u=0,c=s.length;u<c;u++)f=s[u],a.push({from:l,to:f[1],start:o,end:f[0],easing:f[2],callback:f[3]}),l=f[1],o=this._merge(o,f[0]);return this._duration<l&&(this._duration=l),i.data("tl_steps",a),this},removeKeyframes:function(e){e.data("tl_queue",null),e.data("tl_start",null),e.data("tl_steps",null),e.data("tl_cur_step",null)},update:function(e){if(this._paused)return;var t=this._targets,n,r,i=this._deltaTime,s=this._duration;for(var o=0,u=t.length;o<u;o++)n=t[o],r=this._getStep(n,i),r&&(this._updateStep(n,r,i),i===s&&r.to===s&&r.callback&&r.callback(i));if(i===s)this._loop?this._deltaTime=0:this.stop();else{var a=i+e;this._deltaTime=a>s?s:a}},_getStep:function(e,t){var n=e.data("tl_cur_step");if(n){if(t>=n.from&&t<=n.to)return n;t>n.to&&n.callback&&n.callback(t),e.data("tl_cur_step",null)}var r=e.data("tl_steps"),i=r[r.length-1].to,s;if(t<=i)for(var o=0,u=r.length;o<u;o++){s=r[o];if(t>=s.from&&t<=s.to)return e.style(s.start),e.data("tl_cur_step",s),s}return null},_updateStep:function(e,t,n){if(t.to===t.from){e.style(t.end);return}var r=t.to-t.from,s=i.get(t.easing),o=(n-t.from)/r,u=s(o,o,0,1,1),a=t.start,f=t.end;for(var l in f)e._stepStyle(l,{pos:u,start:a[l],end:f[l]})},_clone:function(e){var t;if(typeof e=="object"){t={};for(var n in e)t[n]=this._clone(e[n])}else t=e;return t},_merge:function(e,t){var n=this._clone(e);if(typeof t=="object")for(var r in t)if(typeof n[r]=="object"&&typeof t[r]=="object")for(var i in t[r])n[r][i]=t[r][i];else n[r]=t[r];else n=t;return n}});return s}),define("Sprite",["require","exports","module","DisplayObject","Preload"],function(e,t,n){var r=e("DisplayObject"),i=e("Preload"),s=r.extend({_paused:!0,_images:null,_imageIndex:-1,_frames:null,_frameIndex:-1,_currentFrame:null,_animations:null,_currentAnimation:null,_deltaTime:-1,init:function(e){this._super(e),this._initSpriteSheet(e.spriteSheet)},play:function(e){typeof e=="string"?this.playAnimation(e):typeof e=="number"?this.gotoAndPlay(e):this._paused=!1},stop:function(){this._paused=!0},gotoAndPlay:function(e){this._paused=!1,this._currentAnimation=null,this._frameIndex=e},gotoAndStop:function(e){this._paused=!0,this._currentAnimation=null,this._frameIndex=e},playAnimation:function(e){this._paused=!1;var t=this._animations[e];t&&(this._currentAnimation=t,this._frameIndex=t.start,this._deltaTime=0)},update:function(e){if(this._paused)return;this._updateFrame();var t,n,r,i,s,o=this._currentAnimation;o?(t=o.name,n=o.start,r=o.end,i=o.next,s=o.duration):(t=null,n=0,r=this._frames.length-1,i=!0,s=0);var u;s>0?(this._deltaTime+=e,u=Math.floor((r-n+1)*(this._deltaTime/s)+n)):u=this._frameIndex+1,u>r?(typeof i=="string"?this.playAnimation(i):i===!0?this._frameIndex=n:this.stop(),this.trigger({type:"animationend",name:t,animation:o})):this._frameIndex=u},draw:function(e){var t=this._currentFrame;if(t){var n=this._images[t[4]];n&&n.complete&&e.drawImage(n,t[0],t[1],t[2],t[3],t[5],t[6],t[2],t[3])}},_initSpriteSheet:function(e){this._initImages(e.images),this._initFrames(e.frames),this._initAnimations(e.animations)},_initImages:function(e){this._images=[];var t;for(var n=0,r=e.length;n<r;n++)t=e[n],this.renderMode!==0&&(i.hasItem(t)||i.loadFile({type:"image",url:t}),t=i.getItem(t)),this._images.push(t)},_initFrames:function(e,t){t||(this._frames=[]);if(e instanceof Array)for(var n=0,r=e.length;n<r;n++)e[n]instanceof Array?this._frames.push(e[n]):this._initFrames(e[n],!0);else for(var i=0,s=e.rows;i<s;i++)for(var n=0,r=e.cols;n<r;n++){if(i*e.cols+n===e.num)break;this._frames.push([n*e.width,i*e.height,e.width,e.height,e.image||0,0,0])}},_initAnimations:function(e){this._animations={};var t;for(var n in e)t=e[n],this._animations[n]={name:n,start:t[0],end:t[1],next:t[2],duration:t[3]}},_updateFrame:function(){var e=this._currentFrame=this._frames[this._frameIndex];if(e){(this.width!==e[2]||this.height!==e[3])&&this.style("size",{width:e[2],height:e[3]});if(this.renderMode===0){var t=this.elemStyle;this._imageIndex!==e[4]&&(this._imageIndex=e[4],t.backgroundImage="url("+this._images[e[4]]+")",t.backgroundRepeat="no-repeat"),t.backgroundPosition="-"+e[0]+"px -"+e[1]+"px"}}}});return s}),define("ParticleEmitter",["require","exports","module","Shape","Bitmap"],function(e,t,n){var r=e("Shape"),i=e("Bitmap"),s=function(){};return s.get=function(e){return s.particles[e]},s.particles={rain:{type:"rain",init:function(e){var t=e.width,n=e.height,i;this.particles=[],this.data("fall_width",t),this.data("fall_height",n);for(var s=0,o=e.num||60;s<o;s++)i=new r({renderMode:this.renderMode,pos:{x:Math.floor(Math.random()*t),y:-Math.floor(Math.random()*n)},graphics:{type:"rect",width:s%6===0?3:2,height:s%3===0?28:20,fill:"#FFF"},alpha:Math.floor(Math.random()*3)/10+.2}),i.data("fall_speed",Math.floor(Math.random()*25)/100+.25),this.particles.push(i),this.addChild(i)},update:function(e){var t=this.particles,n=this.data("fall_width"),r=this.data("fall_height"),i,s,o;for(var u=0,a=t.length;u<a;u++)i=t[u],s=i.data("fall_speed")*e,o=i.y,o>r&&(o=-Math.floor(Math.random()*r)),i.style("y",o+s)}},snow:{type:"snow",init:function(e){var t=e.width,n=e.height,s=e.image,o,u,a,f;this.particles=[],this.data("fall_width",t),this.data("fall_height",n);for(var l=0,c=e.num||60;l<c;l++)a={x:Math.floor(Math.random()*t),y:-Math.floor(Math.random()*n)},u=Math.floor(Math.random()*10)+15,f=Math.floor(Math.random()*4)/10+.6,o=s?new i({renderMode:this.renderMode,pos:a,width:u,height:u,scaleToFit:!0,image:s,alpha:f}):new r({renderMode:this.renderMode,pos:a,alpha:Math.floor(Math.random()*5)/10+.3,graphics:{type:"circle",radius:Math.floor(Math.random()*3)+4,fill:"#FFF",angle:360}}),o.data("fall_x",o.x),o.data("fall_width",Math.floor(Math.random()*10+10)),o.data("fall_speed",Math.floor(Math.random()*15+15)/1e3),this.particles.push(o),this.addChild(o)},update:function(e){var t=this.particles,n=this.data("fall_width"),r=this.data("fall_height"),i,s,o,u,a;for(var f=0,l=t.length;f<l;f++)i=t[f],s=i.data("fall_speed"),o=s*e,u=i.data("fall_x"),a=i.y,a>r&&(i.fallTime=0,a=-Math.floor(Math.random()*r)),i.style("pos",{x:u+Math.sin(a/(s*2e3))*i.data("fall_width"),y:a+o})}},smoke:{type:"smoke",init:function(e){var t=this.renderMode,n=e.height,r=0,s=n,o="images/smoke.png",u=this,a=this.particles=[];this.data("spawn_time",0),this.spawn=function(){var e=Math.floor(Math.random()*20)+80,n=new i({renderMode:t,x:r-e/2,y:s,width:e,height:e,image:o,scaleToFit:!0,alpha:.8});n.data({life_time:0,now_size:1,start_size:100,end_size:40,vx:.5-Math.random()*1,vy:-Math.floor(Math.random()*20+20)/10}),n.style({transform:{rotate:Math.floor(Math.random()*360)}}),a.push(n),u.addChild(n)}},update:function(e){var t=this.particles,n=this.data("spawn_time"),r,i,s,o,u,a,f,l,c;n>80?(this.spawn(),this.data("spawn_time",0)):this.data("spawn_time",n+e);for(var h=t.length-1;h>=0;h--)r=t[h],i=r.data("life_time"),i>6e3?(t.splice(h,1),this.removeChild(r)):(a=r.x,f=r.y,l=r.transform.rotate,c=r.alpha,s=r.width,o=r.data("vx"),u=r.data("vy"),s+=.6,r.data("life_time",i+e),r.style({x:a+o,y:f+u,size:{width:s,height:s},transform:{rotate:l-1},alpha:c-.004}))}},fireworks:{type:"fireworks",init:function(e){var t=e.list,n=e.image,r=e.num,s=0,o=0,u;this.particles=[];for(var a=0;a<(r||60);a++){var f=t.length,l=Math.floor(Math.random()*f);u=new i({renderMode:this.renderMode,image:n,sourceRect:t[l]});var c=Math.random()*360*Math.PI/180,h=Math.random()*360;u.data("angle",c);var p=Math.random()*.1+.2;u.data("speed",p),u.style({x:s,y:o,transform:{rotate:h}}),this.particles.push(u),this.addChild(u)}},update:function(e){var t=this.particles;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.data("angle"),o=i.data("speed"),u=i.x,a=i.y,f=i.alpha,l=o*e,c=l*Math.cos(s),h=l*Math.sin(s);u+=c,a+=h,i.style({x:u,y:a,alpha:f-.01})}}}},s}),define("ParticleSystem",["require","exports","module","DisplayObject","ParticleEmitter"],function(e,t,n){var r=e("DisplayObject"),i=e("ParticleEmitter"),s=r.extend({emitter:null,particles:null,init:function(e){this._super(e),this._initParticle(e.particle)},update:function(e){this.emitter&&this.emitter.update.call(this,e)},_initParticle:function(e){var t=e.type,n=t?i.get(t):e;n&&n.init&&n.update&&(this.emitter=n,n.init.call(this,e))}});return s}),define("SkeletalAnimation",["require","exports","module","DisplayObject","Timeline","Bitmap"],function(e,t,n){var r=e("DisplayObject"),i=e("Timeline"),s=e("Bitmap"),o=r.extend({_paused:!0,_bones:null,_animations:null,_currentAnimation:null,_timeline:null,init:function(e){this._super(e),this._initBones(e)},play:function(e){typeof e=="string"?this.playAnimation(e):this._paused=!1},stop:function(){this._paused=!0},playAnimation:function(e){this._paused=!1;var t=this._animations[e];t&&(this._currentAnimation=t,this._timeline=this._initTimeline(t))},update:function(e){if(this._paused)return;this._timeline&&this._timeline.update(e)},_initBones:function(e){this._bones={},this._animations={};var t=e.bones,n=e.animations,i,o;for(var u=0,a=t.length;u<a;u++)i=t[u],i.image?o=new s({renderMode:this.renderMode,x:0,y:0,width:i.width,height:i.height,image:i.image}):o=new r({renderMode:this.renderMode,x:0,y:0,width:i.width,height:i.height}),i.parent||this.addChild(o),this._bones[i.tag]=o;for(var u=0,a=t.length;u<a;u++)i=t[u],i.parent&&this._bones[i.parent].addChild(this._bones[i.tag]);for(var u in n)this._animations[u]=n[u]},_initTimeline:function(e){var t=new i({loop:!0}),n,r,s,o;for(var u=0,a=e.length;u<a;u++){n=e[u],r=this._bones[n.tag],s=n.frames,t.get(r);for(var f=0,l=s.length;f<l;f++)o=s[f],t.addKeyframe(o,o.time)}return t}});return o}),define("cartoon",["require","exports","module","Class","Ticker","Loader","Preload","StyleSheet","DisplayObject","Container","Canvas","Graphics2D","Shape","Filter","Bitmap","Text","Tween","Timeline","Sprite","ParticleEmitter","ParticleSystem","SkeletalAnimation"],function(e,t,n){var r={Class:e("Class"),Ticker:e("Ticker"),Loader:e("Loader"),Preload:e("Preload"),StyleSheet:e("StyleSheet"),DisplayObject:e("DisplayObject"),Container:e("Container"),Canvas:e("Canvas"),Graphics2D:e("Graphics2D"),Shape:e("Shape"),Filter:e("Filter"),Bitmap:e("Bitmap"),Text:e("Text"),Tween:e("Tween"),Timeline:e("Timeline"),Sprite:e("Sprite"),ParticleEmitter:e("ParticleEmitter"),ParticleSystem:e("ParticleSystem"),SkeletalAnimation:e("SkeletalAnimation")};return r}),define("../extension/THREE",["require","exports","module"],function(e,t,n){var r={REVISION:"68"};return typeof n=="object"&&(n.exports=r),r.CullFaceNone=0,r.CullFaceBack=1,r.CullFaceFront=2,r.CullFaceFrontBack=3,r.FrontFaceDirectionCW=0,r.FrontFaceDirectionCCW=1,r.BasicShadowMap=0,r.PCFShadowMap=1,r.PCFSoftShadowMap=2,r.FrontSide=0,r.BackSide=1,r.DoubleSide=2,r.NoShading=0,r.FlatShading=1,r.SmoothShading=2,r.NoColors=0,r.FaceColors=1,r.VertexColors=2,r.NoBlending=0,r.NormalBlending=1,r.AdditiveBlending=2,r.SubtractiveBlending=3,r.MultiplyBlending=4,r.CustomBlending=5,r.AddEquation=100,r.SubtractEquation=101,r.ReverseSubtractEquation=102,r.ZeroFactor=200,r.OneFactor=201,r.SrcColorFactor=202,r.OneMinusSrcColorFactor=203,r.SrcAlphaFactor=204,r.OneMinusSrcAlphaFactor=205,r.DstAlphaFactor=206,r.OneMinusDstAlphaFactor=207,r.DstColorFactor=208,r.OneMinusDstColorFactor=209,r.SrcAlphaSaturateFactor=210,r.MultiplyOperation=0,r.MixOperation=1,r.AddOperation=2,r.UVMapping=function(){},r.CubeReflectionMapping=function(){},r.CubeRefractionMapping=function(){},r.SphericalReflectionMapping=function(){},r.SphericalRefractionMapping=function(){},r.RepeatWrapping=1e3,r.ClampToEdgeWrapping=1001,r.MirroredRepeatWrapping=1002,r.NearestFilter=1003,r.NearestMipMapNearestFilter=1004,r.NearestMipMapLinearFilter=1005,r.LinearFilter=1006,r.LinearMipMapNearestFilter=1007,r.LinearMipMapLinearFilter=1008,r.UnsignedByteType=1009,r.ByteType=1010,r.ShortType=1011,r.UnsignedShortType=1012,r.IntType=1013,r.UnsignedIntType=1014,r.FloatType=1015,r.UnsignedShort4444Type=1016,r.UnsignedShort5551Type=1017,r.UnsignedShort565Type=1018,r.AlphaFormat=1019,r.RGBFormat=1020,r.RGBAFormat=1021,r.LuminanceFormat=1022,r.LuminanceAlphaFormat=1023,r.RGB_S3TC_DXT1_Format=2001,r.RGBA_S3TC_DXT1_Format=2002,r.RGBA_S3TC_DXT3_Format=2003,r.RGBA_S3TC_DXT5_Format=2004,r.Color=function(e){return arguments.length===3?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},r.Color.prototype={constructor:r.Color,r:1,g:1,b:1,set:function(e){return e instanceof r.Color?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(t===0)this.r=this.g=this.b=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*6*(2/3-n):e},i=n<=.5?n*(1+t):n+t-n*t,s=2*n-i;this.r=r(s,i,e+1/3),this.g=r(s,i,e),this.b=r(s,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(r.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0},n=this.r,r=this.g,i=this.b,s=Math.max(n,r,i),o=Math.min(n,r,i),u,a,f=(o+s)/2;if(o===s)u=0,a=0;else{var l=s-o;a=f<=.5?l/(s+o):l/(2-s-o);switch(s){case n:u=(r-i)/l+(r<i?6:0);break;case r:u=(i-n)/l+2;break;case i:u=(n-r)/l+4}u/=6}return t.h=u,t.s=a,t.l=f,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new r.Color).setRGB(this.r,this.g,this.b)}},r.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},r.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=r!==undefined?r:1},r.Quaternion.prototype={constructor:r.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof r.Euler==0)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),i=Math.cos(e._y/2),s=Math.cos(e._z/2),o=Math.sin(e._x/2),u=Math.sin(e._y/2),a=Math.sin(e._z/2);return e.order==="XYZ"?(this._x=o*i*s+n*u*a,this._y=n*u*s-o*i*a,this._z=n*i*a+o*u*s,this._w=n*i*s-o*u*a):e.order==="YXZ"?(this._x=o*i*s+n*u*a,this._y=n*u*s-o*i*a,this._z=n*i*a-o*u*s,this._w=n*i*s+o*u*a):e.order==="ZXY"?(this._x=o*i*s-n*u*a,this._y=n*u*s+o*i*a,this._z=n*i*a+o*u*s,this._w=n*i*s-o*u*a):e.order==="ZYX"?(this._x=o*i*s-n*u*a,this._y=n*u*s+o*i*a,this._z=n*i*a-o*u*s,this._w=n*i*s+o*u*a):e.order==="YZX"?(this._x=o*i*s+n*u*a,this._y=n*u*s+o*i*a,this._z=n*i*a-o*u*s,this._w=n*i*s-o*u*a):e.order==="XZY"&&(this._x=o*i*s-n*u*a,this._y=n*u*s-o*i*a,this._z=n*i*a+o*u*s,this._w=n*i*s+o*u*a),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],u=t[9],a=t[2],f=t[6],l=t[10],c=n+o+l,h;return c>0?(h=.5/Math.sqrt(c+1),this._w=.25/h,this._x=(f-u)*h,this._y=(i-a)*h,this._z=(s-r)*h):n>o&&n>l?(h=2*Math.sqrt(1+n-o-l),this._w=(f-u)/h,this._x=.25*h,this._y=(r+s)/h,this._z=(i+a)/h):o>l?(h=2*Math.sqrt(1+o-n-l),this._w=(i-a)/h,this._x=(r+s)/h,this._y=.25*h,this._z=(u+f)/h):(h=2*Math.sqrt(1+l-n-o),this._w=(s-r)/h,this._x=(i+a)/h,this._y=(u+f)/h,this._z=.25*h),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,n=1e-6;return function(i,s){return e===undefined&&(e=new r.Vector3),t=i.dot(s)+1,t<n?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,s),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return t!==undefined?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,u=t._y,a=t._z,f=t._w;return this._x=n*f+s*o+r*a-i*u,this._y=r*f+s*u+i*o-n*a,this._z=i*f+s*a+n*u-r*o,this._w=s*f-n*o-r*u-i*a,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this._x,r=this._y,i=this._z,s=this._w,o=s*e._w+n*e._x+r*e._y+i*e._z;o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e);if(o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var f=Math.sin((1-t)*u)/a,l=Math.sin(t*u)/a;return this._w=s*f+this._w*l,this._x=n*f+this._x*l,this._y=r*f+this._y*l,this._z=i*f+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new r.Quaternion(this._x,this._y,this._z,this._w)}},r.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},r.Vector2=function(e,t){this.x=e||0,this.y=t||0},r.Vector2.prototype={constructor:r.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==undefined?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return t!==undefined?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(n,i){return e===undefined&&(e=new r.Vector2,t=new r.Vector2),e.set(n,n),t.set(i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new r.Vector2(this.x,this.y)}},r.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},r.Vector3.prototype={constructor:r.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==undefined?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return t!==undefined?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==undefined?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof r.Euler==0&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),e===undefined&&(e=new r.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,n){return e===undefined&&(e=new r.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,u=e.w,a=u*t+s*r-o*n,f=u*n+o*t-i*r,l=u*r+i*n-s*t,c=-i*t-s*n-o*r;return this.x=a*u+c*-i+f*-o-l*-s,this.y=f*u+c*-s+l*-i-a*-o,this.z=l*u+c*-o+a*-s-f*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,i){return e===undefined&&(e=new r.Vector3,t=new r.Vector3),e.set(n,n,n),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(t!==undefined)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return this.x=r*u-i*o,this.y=i*s-n*u,this.z=n*o-r*s,this},projectOnVector:function(){var e,t;return function(n){return e===undefined&&(e=new r.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return e===undefined&&(e=new r.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return e===undefined&&(e=new r.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(r.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){var n=e*4,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new r.Vector3(this.x,this.y,this.z)}},r.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==undefined?r:1},r.Vector4.prototype={constructor:r.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==undefined?e.w:1,this},add:function(e,t){return t!==undefined?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return t!==undefined?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,s=.01,o=.1,u=e.elements,a=u[0],f=u[4],l=u[8],c=u[1],h=u[5],p=u[9],d=u[2],v=u[6],m=u[10];if(Math.abs(f-c)<s&&Math.abs(l-d)<s&&Math.abs(p-v)<s){if(Math.abs(f+c)<o&&Math.abs(l+d)<o&&Math.abs(p+v)<o&&Math.abs(a+h+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(a+1)/2,y=(h+1)/2,b=(m+1)/2,w=(f+c)/4,E=(l+d)/4,S=(p+v)/4;return g>y&&g>b?g<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(g),r=w/n,i=E/n):y>b?y<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(y),n=w/r,i=S/r):b<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(b),n=E/i,r=S/i),this.set(n,r,i,t),this}var x=Math.sqrt((v-p)*(v-p)+(l-d)*(l-d)+(c-f)*(c-f));return Math.abs(x)<.001&&(x=1),this.x=(v-p)/x,this.y=(l-d)/x,this.z=(c-f)/x,this.w=Math.acos((a+h+m-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,i){return e===undefined&&(e=new r.Vector4,t=new r.Vector4),e.set(n,n,n,n),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new r.Vector4(this.x,this.y,this.z,this.w)}},r.Euler=function(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||r.Euler.DefaultOrder},r.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],r.Euler.DefaultOrder="XYZ",r.Euler.prototype={constructor:r.Euler,_x:0,_y:0,_z:0,_order:r.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t){var n=r.Math.clamp,i=e.elements,s=i[0],o=i[4],u=i[8],a=i[1],f=i[5],l=i[9],c=i[2],h=i[6],p=i[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,f),this._z=0)):t==="YXZ"?(this._x=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(u,p),this._z=Math.atan2(a,f)):(this._y=Math.atan2(-c,s),this._z=0)):t==="ZXY"?(this._x=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-o,f)):(this._y=0,this._z=Math.atan2(a,s))):t==="ZYX"?(this._y=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(h,p),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-o,f))):t==="YZX"?(this._z=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,f),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(u,p))):t==="XZY"?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,f),this._y=Math.atan2(u,s)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,this.onChangeCallback(),this},setFromQuaternion:function(e,t,n){var i=r.Math.clamp,s=e.x*e.x,o=e.y*e.y,u=e.z*e.z,a=e.w*e.w;return t=t||this._order,t==="XYZ"?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-s-o+u),this._y=Math.asin(i(2*(e.x*e.z+e.y*e.w),-1,1)),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+s-o-u)):t==="YXZ"?(this._x=Math.asin(i(2*(e.x*e.w-e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-s-o+u),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-s+o-u)):t==="ZXY"?(this._x=Math.asin(i(2*(e.x*e.w+e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-s-o+u),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-s+o-u)):t==="ZYX"?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-s-o+u),this._y=Math.asin(i(2*(e.y*e.w-e.x*e.z),-1,1)),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+s-o-u)):t==="YZX"?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-s+o-u),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+s-o-u),this._z=Math.asin(i(2*(e.x*e.y+e.z*e.w),-1,1))):t==="XZY"?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-s+o-u),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+s-o-u),this._z=Math.asin(i(2*(e.z*e.w-e.x*e.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+t),this._order=t,n!==!1&&this.onChangeCallback(),this},reorder:function(){var e=new r.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==undefined&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new r.Euler(this._x,this._y,this._z,this._order)}},r.Line3=function(e,t){this.start=e!==undefined?e:new r.Vector3,this.end=t!==undefined?t:new r.Vector3},r.Line3.prototype={constructor:r.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new r.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new r.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new r.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new r.Vector3,t=new r.Vector3;return function(n,i){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var s=t.dot(t),o=t.dot(e),u=o/s;return i&&(u=r.Math.clamp(u,0,1)),u}}(),closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t),s=n||new r.Vector3;return this.delta(s).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new r.Line3).copy(this)}},r.Box2=function(e,t){this.min=e!==undefined?e:new r.Vector2(Infinity,Infinity),this.max=t!==undefined?t:new r.Vector2(-Infinity,-Infinity)},r.Box2.prototype={constructor:r.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new r.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new r.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new r.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var n=t||new r.Vector2;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var n=t||new r.Vector2;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new r.Vector2;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new r.Box2).copy(this)}},r.Box3=function(e,t){this.min=e!==undefined?e:new r.Vector3(Infinity,Infinity,Infinity),this.max=t!==undefined?t:new r.Vector3(-Infinity,-Infinity,-Infinity)},r.Box3.prototype={constructor:r.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new r.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new r.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(t.geometry!==undefined&&t.geometry.vertices!==undefined){var r=t.geometry.vertices;for(var i=0,s=r.length;i<s;i++)e.copy(r[i]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new r.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new r.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var n=t||new r.Vector3;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var n=t||new r.Vector3;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new r.Vector3;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new r.Vector3;return function(t){var n=t||new r.Sphere;return n.center=this.center(),n.radius=this.size(e).length()*.5,n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new r.Box3).copy(this)}},r.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9);var f=this.elements;f[0]=e!==undefined?e:1,f[3]=t||0,f[6]=n||0,f[1]=r||0,f[4]=i!==undefined?i:1,f[7]=s||0,f[2]=o||0,f[5]=u||0,f[8]=a!==undefined?a:1},r.Matrix3.prototype={constructor:r.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new r.Vector3;return function(t,n,r){n===undefined&&(n=0),r===undefined&&(r=t.length);for(var i=0,s=n,o;i<r;i+=3,s+=3)e.x=t[s],e.y=t[s+1],e.z=t[s+2],e.applyMatrix3(this),t[s]=e.x,t[s+1]=e.y,t[s+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*s*f-t*o*a-n*i*f+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(s);return console.warn(s),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new r.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},r.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.elements=new Float32Array(16);var m=this.elements;m[0]=e!==undefined?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=s!==undefined?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=l!==undefined?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=v!==undefined?v:1},r.Matrix4.prototype={constructor:r.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREEMatrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractRotation:function(){var e=new r.Vector3;return function(t){var n=this.elements,r=t.elements,i=1/e.set(r[0],r[1],r[2]).length(),s=1/e.set(r[4],r[5],r[6]).length(),o=1/e.set(r[8],r[9],r[10]).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,this}}(),makeRotationFromEuler:function(e){e instanceof r.Euler==0&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,s=e.z,o=Math.cos(n),u=Math.sin(n),a=Math.cos(i),f=Math.sin(i),l=Math.cos(s),c=Math.sin(s);if(e.order==="XYZ"){var h=o*l,p=o*c,d=u*l,v=u*c;t[0]=a*l,t[4]=-a*c,t[8]=f,t[1]=p+d*f,t[5]=h-v*f,t[9]=-u*a,t[2]=v-h*f,t[6]=d+p*f,t[10]=o*a}else if(e.order==="YXZ"){var m=a*l,g=a*c,y=f*l,b=f*c;t[0]=m+b*u,t[4]=y*u-g,t[8]=o*f,t[1]=o*c,t[5]=o*l,t[9]=-u,t[2]=g*u-y,t[6]=b+m*u,t[10]=o*a}else if(e.order==="ZXY"){var m=a*l,g=a*c,y=f*l,b=f*c;t[0]=m-b*u,t[4]=-o*c,t[8]=y+g*u,t[1]=g+y*u,t[5]=o*l,t[9]=b-m*u,t[2]=-o*f,t[6]=u,t[10]=o*a}else if(e.order==="ZYX"){var h=o*l,p=o*c,d=u*l,v=u*c;t[0]=a*l,t[4]=d*f-p,t[8]=h*f+v,t[1]=a*c,t[5]=v*f+h,t[9]=p*f-d,t[2]=-f,t[6]=u*a,t[10]=o*a}else if(e.order==="YZX"){var w=o*a,E=o*f,S=u*a,x=u*f;t[0]=a*l,t[4]=x-w*c,t[8]=S*c+E,t[1]=c,t[5]=o*l,t[9]=-u*l,t[2]=-f*l,t[6]=E*c+S,t[10]=w-x*c}else if(e.order==="XZY"){var w=o*a,E=o*f,S=u*a,x=u*f;t[0]=a*l,t[4]=-c,t[8]=f*l,t[1]=w*c+x,t[5]=o*l,t[9]=E*c-S,t[2]=S*c-E,t[6]=u*l,t[10]=x*c+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[4]=l-g,t[8]=c+m,t[1]=l+g,t[5]=1-(f+d),t[9]=p-v,t[2]=c-m,t[6]=p+v,t[10]=1-(f+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new r.Vector3,t=new r.Vector3,n=new r.Vector3;return function(r,i,s){var o=this.elements;return n.subVectors(r,i).normalize(),n.length()===0&&(n.z=1),e.crossVectors(s,n).normalize(),e.length()===0&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return t!==undefined?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],w=n[15],E=r[0],S=r[4],x=r[8],T=r[12],N=r[1],C=r[5],k=r[9],L=r[13],A=r[2],O=r[6],M=r[10],_=r[14],D=r[3],P=r[7],H=r[11],B=r[15];return i[0]=s*E+o*N+u*A+a*D,i[4]=s*S+o*C+u*O+a*P,i[8]=s*x+o*k+u*M+a*H,i[12]=s*T+o*L+u*_+a*B,i[1]=f*E+l*N+c*A+h*D,i[5]=f*S+l*C+c*O+h*P,i[9]=f*x+l*k+c*M+h*H,i[13]=f*T+l*L+c*_+h*B,i[2]=p*E+d*N+v*A+m*D,i[6]=p*S+d*C+v*O+m*P,i[10]=p*x+d*k+v*M+m*H,i[14]=p*T+d*L+v*_+m*B,i[3]=g*E+y*N+b*A+w*D,i[7]=g*S+y*C+b*O+w*P,i[11]=g*x+y*k+b*M+w*H,i[15]=g*T+y*L+b*_+w*B,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new r.Vector3;return function(t,n,r){n===undefined&&(n=0),r===undefined&&(r=t.length);for(var i=0,s=n,o;i<r;i+=3,s+=3)e.x=t[s],e.y=t[s+1],e.z=t[s+2],e.applyMatrix4(this),t[s]=e.x,t[s+1]=e.y,t[s+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14],p=e[3],d=e[7],v=e[11],m=e[15];return p*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+d*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+v*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+m*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new r.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(w==0){var E="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(E);return console.warn(E),this.identity(),this}return this.multiplyScalar(1/w),this},translate:function(e){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new r.Vector3,t=new r.Matrix4;return function(n,r,i){var s=this.elements,o=e.set(s[0],s[1],s[2]).length(),u=e.set(s[4],s[5],s[6]).length(),a=e.set(s[8],s[9],s[10]).length(),f=this.determinant();f<0&&(o=-o),n.x=s[12],n.y=s[13],n.z=s[14],t.elements.set(this.elements);var l=1/o,c=1/u,h=1/a;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),i.x=o,i.y=u,i.z=a,this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements,u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return o[0]=u,o[4]=0,o[8]=f,o[12]=0,o[1]=0,o[5]=a,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,i){var s=n*Math.tan(r.Math.degToRad(e*.5)),o=-s,u=o*t,a=s*t;return this.makeFrustum(u,a,o,s,n,i)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i,l=(t+e)/u,c=(n+r)/a,h=(s+i)/f;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2/a,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new r.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},r.Ray=function(e,t){this.origin=e!==undefined?e:new r.Vector3,this.direction=t!==undefined?t:new r.Vector3},r.Ray.prototype={constructor:r.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var n=t||new r.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new r.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new r.Vector3;n.subVectors(e,this.origin);var i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new r.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),o=e.distanceTo(t)*.5,u=this.origin.clone().sub(i),a=-this.direction.dot(s),f=u.dot(this.direction),l=-u.dot(s),c=u.lengthSq(),h=Math.abs(1-a*a),p,d,v,m;if(h>=0){p=a*l-f,d=a*f-l,m=o*h;if(p>=0)if(d>=-m)if(d<=m){var g=1/h;p*=g,d*=g,v=p*(p+a*d+2*f)+d*(a*p+d+2*l)+c}else d=o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d=-o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d<=-m?(p=Math.max(0,-(-a*o+f)),d=p>0?-o:Math.min(Math.max(-o,-l),o),v=-p*p+d*(d+2*l)+c):d<=m?(p=0,d=Math.min(Math.max(-o,-l),o),v=d*(d+2*l)+c):(p=Math.max(0,-(a*o+f)),d=p>0?o:Math.min(Math.max(-o,-l),o),v=-p*p+d*(d+2*l)+c)}else d=a>0?-o:o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;return n&&n.copy(this.direction.clone().multiplyScalar(p).add(this.origin)),r&&r.copy(s.clone().multiplyScalar(d).add(i)),v},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new r.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),i=e.dot(e)-r*r,s=t.radius*t.radius;if(i>s)return null;var o=Math.sqrt(s-i),u=r-o,a=r+o;return u<0&&a<0?null:u<0?this.at(a,n):this.at(u,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var n=e.normal.dot(this.direction);return n*t<0?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0)return e.distanceToPoint(this.origin)==0?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return n===null?null:this.at(n,t)},isIntersectionBox:function(){var e=new r.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var n,r,i,s,o,u,a=1/this.direction.x,f=1/this.direction.y,l=1/this.direction.z,c=this.origin;a>=0?(n=(e.min.x-c.x)*a,r=(e.max.x-c.x)*a):(n=(e.max.x-c.x)*a,r=(e.min.x-c.x)*a),f>=0?(i=(e.min.y-c.y)*f,s=(e.max.y-c.y)*f):(i=(e.max.y-c.y)*f,s=(e.min.y-c.y)*f);if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;l>=0?(o=(e.min.z-c.z)*l,u=(e.max.z-c.z)*l):(o=(e.max.z-c.z)*l,u=(e.min.z-c.z)*l);if(n>u||o>r)return null;if(o>n||n!==n)n=o;if(u<r||r!==r)r=u;return r<0?null:this.at(n>=0?n:r,t)},intersectTriangle:function(){var e=new r.Vector3,t=new r.Vector3,n=new r.Vector3,i=new r.Vector3;return function(r,s,o,u,a){t.subVectors(s,r),n.subVectors(o,r),i.crossVectors(t,n);var f=this.direction.dot(i),l;if(f>0){if(u)return null;l=1}else{if(!(f<0))return null;l=-1,f=-f}e.subVectors(this.origin,r);var c=l*this.direction.dot(n.crossVectors(e,n));if(c<0)return null;var h=l*this.direction.dot(t.cross(e));if(h<0)return null;if(c+h>f)return null;var p=-l*e.dot(i);return p<0?null:this.at(p/f,a)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new r.Ray).copy(this)}},r.Sphere=function(e,t){this.center=e!==undefined?e:new r.Vector3,this.radius=t!==undefined?t:0},r.Sphere.prototype={constructor:r.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new r.Box3;return function(t,n){var r=this.center;n!==undefined?r.copy(n):e.setFromPoints(t).center(r);var i=0;for(var s=0,o=t.length;s<o;s++)i=Math.max(i,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),i=t||new r.Vector3;return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new r.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new r.Sphere).copy(this)}},r.Frustum=function(e,t,n,i,s,o){this.planes=[e!==undefined?e:new r.Plane,t!==undefined?t:new r.Plane,n!==undefined?n:new r.Plane,i!==undefined?i:new r.Plane,s!==undefined?s:new r.Plane,o!==undefined?o:new r.Plane]},r.Frustum.prototype={constructor:r.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){var t=this.planes;for(var n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=n[9],p=n[10],d=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-u,d-c,y-v).normalize(),t[1].setComponents(o+r,l+u,d+c,y+v).normalize(),t[2].setComponents(o+i,l+a,d+h,y+m).normalize(),t[3].setComponents(o-i,l-a,d-h,y-m).normalize(),t[4].setComponents(o-s,l-f,d-p,y-g).normalize(),t[5].setComponents(o+s,l+f,d+p,y+g).normalize(),this},intersectsObject:function(){var e=new r.Sphere;return function(t){var n=t.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center,r=-e.radius;for(var i=0;i<6;i++){var s=t[i].distanceToPoint(n);if(s<r)return!1}return!0},intersectsBox:function(){var e=new r.Vector3,t=new r.Vector3;return function(n){var r=this.planes;for(var i=0;i<6;i++){var s=r[i];e.x=s.normal.x>0?n.min.x:n.max.x,t.x=s.normal.x>0?n.max.x:n.min.x,e.y=s.normal.y>0?n.min.y:n.max.y,t.y=s.normal.y>0?n.max.y:n.min.y,e.z=s.normal.z>0?n.min.z:n.max.z,t.z=s.normal.z>0?n.max.z:n.min.z;var o=s.distanceToPoint(e),u=s.distanceToPoint(t);if(o<0&&u<0)return!1}return!0}}(),containsPoint:function(e){var t=this.planes;for(var n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new r.Frustum).copy(this)}},r.Plane=function(e,t){this.normal=e!==undefined?e:new r.Vector3(1,0,0),this.constant=t!==undefined?t:0},r.Plane.prototype={constructor:r.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new r.Vector3,t=new r.Vector3;return function(n,r,i){var s=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(s,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e),i=t||new r.Vector3;return i.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new r.Vector3;return function(t,n){var i=n||new r.Vector3,s=t.delta(e),o=this.normal.dot(s);if(o==0)return this.distanceToPoint(t.start)==0?i.copy(t.start):undefined;var u=-(t.start.dot(this.normal)+this.constant)/o;return u<0||u>1?undefined:i.copy(s).multiplyScalar(u).add(t.start)}}(),coplanarPoint:function(e){var t=e||new r.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new r.Vector3,t=new r.Vector3,n=new r.Matrix3;return function(r,i){var s=i||n.getNormalMatrix(r),o=e.copy(this.normal).applyMatrix3(s),u=this.coplanarPoint(t);return u.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(o,u),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new r.Plane).copy(this)}},r.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36),n=0,r;return function(){for(var i=0;i<36;i++)i==8||i==13||i==18||i==23?t[i]="-":i==14?t[i]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),r=n&15,n>>=4,t[i]=e[i==19?r&3|8:r]);return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(e*6-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0}},r.Spline=function(e){function p(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t}this.points=e;var t=[],n={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,t[0]=s===0?s:s-1,t[1]=s,t[2]=s>this.points.length-2?this.points.length-1:s+1,t[3]=s>this.points.length-3?this.points.length-1:s+2,f=this.points[t[0]],l=this.points[t[1]],c=this.points[t[2]],h=this.points[t[3]],u=o*o,a=o*u,n.x=p(f.x,l.x,c.x,h.x,o,u,a),n.y=p(f.y,l.y,c.y,h.y,o,u,a),n.z=p(f.z,l.z,c.z,h.z,o,u,a),n},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,i,s,o=0,u=0,a=0,f=new r.Vector3,l=new r.Vector3,c=[],h=0;c[0]=0,e||(e=100),i=this.points.length*e,f.copy(this.points[0]);for(t=1;t<i;t++)n=t/i,s=this.getPoint(n),l.copy(s),h+=l.distanceTo(f),f.copy(s),o=(this.points.length-1)*n,u=Math.floor(o),u!=a&&(c[u]=h,a=u);return c[c.length]=h,{chunks:c,total:h}},this.reparametrizeByArcLength=function(e){var t,n,i,s,o,u,a,f,l,c=[],h=new r.Vector3,p=this.getLength();c.push(h.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){a=p.chunks[t]-p.chunks[t-1],f=Math.ceil(e*a/p.total),s=(t-1)/(this.points.length-1),o=t/(this.points.length-1);for(n=1;n<f-1;n++)i=s+n*(1/f)*(o-s),l=this.getPoint(i),c.push(h.copy(l).clone());c.push(h.copy(this.points[t]).clone())}this.points=c}},r.Triangle=function(e,t,n){this.a=e!==undefined?e:new r.Vector3,this.b=t!==undefined?t:new r.Vector3,this.c=n!==undefined?n:new r.Vector3},r.Triangle.normal=function(){var e=new r.Vector3;return function(t,n,i,s){var o=s||new r.Vector3;o.subVectors(i,n),e.subVectors(t,n),o.cross(e);var u=o.lengthSq();return u>0?o.multiplyScalar(1/Math.sqrt(u)):o.set(0,0,0)}}(),r.Triangle.barycoordFromPoint=function(){var e=new r.Vector3,t=new r.Vector3,n=new r.Vector3;return function(i,s,o,u,a){e.subVectors(u,s),t.subVectors(o,s),n.subVectors(i,s);var f=e.dot(e),l=e.dot(t),c=e.dot(n),h=t.dot(t),p=t.dot(n),d=f*h-l*l,v=a||new r.Vector3;if(d==0)return v.set(-2,-1,-1);var m=1/d,g=(h*c-l*p)*m,y=(f*p-l*c)*m;return v.set(1-g-y,y,g)}}(),r.Triangle.containsPoint=function(){var e=new r.Vector3;return function(t,n,i,s){var o=r.Triangle.barycoordFromPoint(t,n,i,s,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),r.Triangle.prototype={constructor:r.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new r.Vector3,t=new r.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new r.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return r.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new r.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return r.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return r.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new r.Triangle).copy(this)}},r.Clock=function(e){this.autoStart=e!==undefined?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},r.Clock.prototype={constructor:r.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},r.EventDispatcher=function(){},r.EventDispatcher.prototype={constructor:r.EventDispatcher,apply:function(e){e.addEventListener=r.EventDispatcher.prototype.addEventListener,e.hasEventListener=r.EventDispatcher.prototype.hasEventListener,e.removeEventListener=r.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=r.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){this._listeners===undefined&&(this._listeners={});var n=this._listeners;n[e]===undefined&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(this._listeners===undefined)return!1;var n=this._listeners;return n[e]!==undefined&&n[e].indexOf(t)!==-1?!0:!1},removeEventListener:function(e,t){if(this._listeners===undefined)return;var n=this._listeners,r=n[e];if(r!==undefined){var i=r.indexOf(t);i!==-1&&r.splice(i,1)}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners,n=t[e.type];if(n!==undefined){e.target=this;var r=[],i=n.length;for(var s=0;s<i;s++)r[s]=n[s];for(var s=0;s<i;s++)r[s].call(this,e)}}},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||Infinity,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},n=function(e,t,r,i){e.raycast(t,r);if(i===!0){var s=e.children;for(var o=0,u=s.length;o<u;o++)n(s[o],t,r,!0)}};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},intersectObject:function(e,r){var i=[];return n(e,this,i,r),i.sort(t),i},intersectObjects:function(e,r){var i=[];for(var s=0,o=e.length;s<o;s++)n(e[s],this,i,r);return i.sort(t),i}}}(r),r.Object3D=function(){this.id=r.Object3DIdCount++,this.uuid=r.Math.generateUUID(),this.name="",this.parent=undefined,this.children=[],this.up=r.Object3D.DefaultUp.clone();var e=this,t=new r.Vector3,n=new r.Euler,i=new r.Quaternion,s=new r.Vector3(1,1,1);n.onChange(function(){i.setFromEuler(n,!1)}),i.onChange(function(){n.setFromQuaternion(i,undefined,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:n},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:s}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new r.Matrix4,this.matrixWorld=new r.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},r.Object3D.DefaultUp=new r.Vector3(0,1,0),r.Object3D.prototype={constructor:r.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new r.Quaternion;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new r.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new r.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new r.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new r.Vector3;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new r.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new r.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new r.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new r.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new r.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}if(e===this)return console.error("THREE.Object3D.add:",e,"can't be added as a child of itself."),this;if(e instanceof r.Object3D){e.parent!==undefined&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);var n=this;while(n.parent!==undefined)n=n.parent;n!==undefined&&n instanceof r.Scene&&n.__addObject(e)}else console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D.");return this},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var n=this.children.indexOf(e);if(n!==-1){e.parent=undefined,e.dispatchEvent({type:"removed"}),this.children.splice(n,1);var i=this;while(i.parent!==undefined)i=i.parent;i!==undefined&&i instanceof r.Scene&&i.__removeObject(e)}},raycast:function(){},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(this.visible===!1)return;e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverseVisible(e)},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e)return i;if(t===!0){i=i.getObjectById(e,t);if(i!==undefined)return i}}return undefined},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e)return i;if(t===!0){i=i.getObjectByName(e,t);if(i!==undefined)return i}}return undefined},getChildByName:function(e,t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.matrixWorldNeedsUpdate===!0||e===!0)this.parent===undefined?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){e===undefined&&(e=new r.Object3D),t===undefined&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData));if(t===!0)for(var n=0;n<this.children.length;n++){var i=this.children[n];e.add(i.clone())}return e}},r.EventDispatcher.prototype.apply(r.Object3D.prototype),r.Object3DIdCount=0,r.Projector=function(){function R(){if(t===i){var e=new r.RenderableObject;return n.push(e),i++,t++,e}return n[t++]}function U(){if(o===a){var e=new r.RenderableVertex;return u.push(e),a++,o++,e}return u[o++]}function z(){if(l===h){var e=new r.RenderableFace;return c.push(e),h++,l++,e}return c[l++]}function W(){if(d===m){var e=new r.RenderableLine;return v.push(e),m++,d++,e}return v[d++]}function X(){if(y===w){var e=new r.RenderableSprite;return b.push(e),w++,y++,e}return b[y++]}function V(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function $(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return i>=0&&s>=0&&o>=0&&u>=0?!0:i<0&&s<0||o<0&&u<0?!1:(i<0?n=Math.max(n,i/(i-s)):s<0&&(r=Math.min(r,i/(i-s))),o<0?n=Math.max(n,o/(o-u)):u<0&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var e,t,n=[],i=0,s,o,u=[],a=0,f,l,c=[],h=0,p,d,v=[],m=0,g,y,b=[],w=0,E={objects:[],lights:[],elements:[]},S=new r.Vector3,x=new r.Vector3,T=new r.Vector3,N=new r.Vector3,C=new r.Vector4,k=new r.Box3(new r.Vector3(-1,-1,-1),new r.Vector3(1,1,1)),L=new r.Box3,A=new Array(3),O=new Array(4),M=new r.Matrix4,_=new r.Matrix4,D,P=new r.Matrix4,H=new r.Matrix3,B=new r.Frustum,j=new r.Vector4,F=new r.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(_)},this.unprojectVector=function(){var e=new r.Matrix4;return function(t,n){return e.getInverse(n.projectionMatrix),_.multiplyMatrices(n.matrixWorld,e),t.applyProjection(_)}}(),this.pickingRay=function(e,t){e.z=-1;var n=new r.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(n,t),n.sub(e).normalize(),new r.Raycaster(e,n)};var I=function(){var e=[],t=[],n=null,i=null,o=new r.Matrix3,a=function(r){n=r,i=n.material,o.getNormalMatrix(n.matrixWorld),e.length=0,t.length=0},l=function(e){var t=e.position,n=e.positionWorld,r=e.positionScreen;n.copy(t).applyMatrix4(D),r.copy(n).applyMatrix4(_);var i=1/r.w;r.x*=i,r.y*=i,r.z*=i,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1},c=function(e,t,n){s=U(),s.position.set(e,t,n),l(s)},h=function(t,n,r){e.push(t,n,r)},d=function(e,n){t.push(e,n)},v=function(e,t,n){return e.visible===!0||t.visible===!0||n.visible===!0?!0:(A[0]=e.positionScreen,A[1]=t.positionScreen,A[2]=n.positionScreen,k.isIntersectionBox(L.setFromPoints(A)))},m=function(e,t,n){return(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},g=function(e,t){var r=u[e],i=u[t];p=W(),p.id=n.id,p.v1.copy(r),p.v2.copy(i),p.z=(r.positionScreen.z+i.positionScreen.z)/2,p.material=n.material,E.elements.push(p)},y=function(s,a,l){var c=u[s],h=u[a],p=u[l];if(v(c,h,p)===!1)return;if(i.side===r.DoubleSide||m(c,h,p)===!0){f=z(),f.id=n.id,f.v1.copy(c),f.v2.copy(h),f.v3.copy(p),f.z=(c.positionScreen.z+h.positionScreen.z+p.positionScreen.z)/3;for(var d=0;d<3;d++){var g=arguments[d]*3,y=f.vertexNormalsModel[d];y.set(e[g],e[g+1],e[g+2]),y.applyMatrix3(o).normalize();var b=arguments[d]*2,w=f.uvs[d];w.set(t[b],t[b+1])}f.vertexNormalsLength=3,f.material=n.material,E.elements.push(f)}};return{setObject:a,projectVertex:l,checkTriangleVisibility:v,checkBackfaceCulling:m,pushVertex:c,pushNormal:h,pushUv:d,pushLine:g,pushTriangle:y}},q=new I;this.projectScene=function(n,i,s,a){l=0,d=0,y=0,E.elements.length=0,n.autoUpdate===!0&&n.updateMatrixWorld(),i.parent===undefined&&i.updateMatrixWorld(),M.copy(i.matrixWorldInverse.getInverse(i.matrixWorld)),_.multiplyMatrices(i.projectionMatrix,M),B.setFromMatrix(_),t=0,E.objects.length=0,E.lights.length=0,n.traverseVisible(function(t){if(t instanceof r.Light)E.lights.push(t);else if(t instanceof r.Mesh||t instanceof r.Line||t instanceof r.Sprite)if(t.frustumCulled===!1||B.intersectsObject(t)===!0)e=R(),e.id=t.id,e.object=t,t.renderDepth!==null?e.z=t.renderDepth:(N.setFromMatrixPosition(t.matrixWorld),N.applyProjection(_),e.z=N.z),E.objects.push(e)}),s===!0&&E.objects.sort(V);for(var c=0,h=E.objects.length;c<h;c++){var v=E.objects[c].object,m=v.geometry;q.setObject(v),D=v.matrixWorld,o=0;if(v instanceof r.Mesh){if(m instanceof r.BufferGeometry){var b=m.attributes,w=m.offsets;if(b.position===undefined)continue;var k=b.position.array;for(var L=0,A=k.length;L<A;L+=3)q.pushVertex(k[L],k[L+1],k[L+2]);if(b.normal!==undefined){var O=b.normal.array;for(var L=0,A=O.length;L<A;L+=3)q.pushNormal(O[L],O[L+1],O[L+2])}if(b.uv!==undefined){var I=b.uv.array;for(var L=0,A=I.length;L<A;L+=2)q.pushUv(I[L],I[L+1])}if(b.index!==undefined){var J=b.index.array;if(w.length>0)for(var c=0;c<w.length;c++){var K=w[c],Q=K.index;for(var L=K.start,A=K.start+K.count;L<A;L+=3)q.pushTriangle(J[L]+Q,J[L+1]+Q,J[L+2]+Q)}else for(var L=0,A=J.length;L<A;L+=3)q.pushTriangle(J[L],J[L+1],J[L+2])}else for(var L=0,A=k.length/3;L<A;L+=3)q.pushTriangle(L,L+1,L+2)}else if(m instanceof r.Geometry){var G=m.vertices,Y=m.faces,Z=m.faceVertexUvs[0];H.getNormalMatrix(D);var et=v.material instanceof r.MeshFaceMaterial,tt=et===!0?v.material:null;for(var nt=0,rt=G.length;nt<rt;nt++){var it=G[nt];q.pushVertex(it.x,it.y,it.z)}for(var st=0,ot=Y.length;st<ot;st++){var ut=Y[st],at=et===!0?tt.materials[ut.materialIndex]:v.material;if(at===undefined)continue;var ft=at.side,lt=u[ut.a],ct=u[ut.b],ht=u[ut.c];if(at.morphTargets===!0){var pt=m.morphTargets,dt=v.morphTargetInfluences,vt=lt.position,mt=ct.position,gt=ht.position;S.set(0,0,0),x.set(0,0,0),T.set(0,0,0);for(var yt=0,bt=pt.length;yt<bt;yt++){var wt=dt[yt];if(wt===0)continue;var Et=pt[yt].vertices;S.x+=(Et[ut.a].x-vt.x)*wt,S.y+=(Et[ut.a].y-vt.y)*wt,S.z+=(Et[ut.a].z-vt.z)*wt,x.x+=(Et[ut.b].x-mt.x)*wt,x.y+=(Et[ut.b].y-mt.y)*wt,x.z+=(Et[ut.b].z-mt.z)*wt,T.x+=(Et[ut.c].x-gt.x)*wt,T.y+=(Et[ut.c].y-gt.y)*wt,T.z+=(Et[ut.c].z-gt.z)*wt}lt.position.add(S),ct.position.add(x),ht.position.add(T),q.projectVertex(lt),q.projectVertex(ct),q.projectVertex(ht)}if(q.checkTriangleVisibility(lt,ct,ht)===!1)continue;var St=q.checkBackfaceCulling(lt,ct,ht);if(ft!==r.DoubleSide){if(ft===r.FrontSide&&St===!1)continue;if(ft===r.BackSide&&St===!0)continue}f=z(),f.id=v.id,f.v1.copy(lt),f.v2.copy(ct),f.v3.copy(ht),f.normalModel.copy(ut.normal),St===!1&&(ft===r.BackSide||ft===r.DoubleSide)&&f.normalModel.negate(),f.normalModel.applyMatrix3(H).normalize();var xt=ut.vertexNormals;for(var Tt=0,Nt=Math.min(xt.length,3);Tt<Nt;Tt++){var Ct=f.vertexNormalsModel[Tt];Ct.copy(xt[Tt]),St===!1&&(ft===r.BackSide||ft===r.DoubleSide)&&Ct.negate(),Ct.applyMatrix3(H).normalize()}f.vertexNormalsLength=xt.length;var kt=Z[st];if(kt!==undefined)for(var Lt=0;Lt<3;Lt++)f.uvs[Lt].copy(kt[Lt]);f.color=ut.color,f.material=at,f.z=(lt.positionScreen.z+ct.positionScreen.z+ht.positionScreen.z)/3,E.elements.push(f)}}}else if(v instanceof r.Line){if(m instanceof r.BufferGeometry){var b=m.attributes;if(b.position!==undefined){var k=b.position.array;for(var L=0,A=k.length;L<A;L+=3)q.pushVertex(k[L],k[L+1],k[L+2]);if(b.index!==undefined){var J=b.index.array;for(var L=0,A=J.length;L<A;L+=2)q.pushLine(J[L],J[L+1])}else{var At=v.type===r.LinePieces?2:1;for(var L=0,A=k.length/3-1;L<A;L+=At)q.pushLine(L,L+1)}}}else if(m instanceof r.Geometry){P.multiplyMatrices(_,D);var G=v.geometry.vertices;if(G.length===0)continue;lt=U(),lt.positionScreen.copy(G[0]).applyMatrix4(P);var At=v.type===r.LinePieces?2:1;for(var nt=1,rt=G.length;nt<rt;nt++){lt=U(),lt.positionScreen.copy(G[nt]).applyMatrix4(P);if((nt+1)%At>0)continue;ct=u[o-2],j.copy(lt.positionScreen),F.copy(ct.positionScreen),$(j,F)===!0&&(j.multiplyScalar(1/j.w),F.multiplyScalar(1/F.w),p=W(),p.id=v.id,p.v1.positionScreen.copy(j),p.v2.positionScreen.copy(F),p.z=Math.max(j.z,F.z),p.material=v.material,v.material.vertexColors===r.VertexColors&&(p.vertexColors[0].copy(v.geometry.colors[nt]),p.vertexColors[1].copy(v.geometry.colors[nt-1])),E.elements.push(p))}}}else if(v instanceof r.Sprite){C.set(D.elements[12],D.elements[13],D.elements[14],1),C.applyMatrix4(_);var Ot=1/C.w;C.z*=Ot,C.z>=-1&&C.z<=1&&(g=X(),g.id=v.id,g.x=C.x*Ot,g.y=C.y*Ot,g.z=C.z,g.object=v,g.rotation=v.rotation,g.scale.x=v.scale.x*Math.abs(g.x-(C.x+i.projectionMatrix.elements[0])/(C.w+i.projectionMatrix.elements[12])),g.scale.y=v.scale.y*Math.abs(g.y-(C.y+i.projectionMatrix.elements[5])/(C.w+i.projectionMatrix.elements[13])),g.material=v.material,E.elements.push(g))}}return a===!0&&E.elements.sort(V),E}},r.Face3=function(e,t,n,i,s,o){this.a=e,this.b=t,this.c=n,this.normal=i instanceof r.Vector3?i:new r.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof r.Color?s:new r.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=o!==undefined?o:0},r.Face3.prototype={constructor:r.Face3,clone:function(){var e=new r.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(var t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(var t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},r.Face4=function(e,t,n,i,s,o,u){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new r.Face3(e,t,n,s,o,u)},r.BufferAttribute=function(e,t){this.array=e,this.itemSize=t},r.BufferAttribute.prototype={constructor:r.BufferAttribute,get length(){return this.array.length},set:function(e){return this.array.set(e),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}},r.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new r.BufferAttribute(e,t)},r.BufferGeometry=function(){this.id=r.GeometryIdCount++,this.uuid=r.Math.generateUUID(),this.name="",this.attributes={},this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},r.BufferGeometry.prototype={constructor:r.BufferGeometry,addAttribute:function(e,t){if(t instanceof r.BufferAttribute==0){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[e]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:n!==undefined?n:0})},applyMatrix:function(e){var t=this.attributes.position;t!==undefined&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var n=this.attributes.normal;if(n!==undefined){var i=(new r.Matrix3).getNormalMatrix(e);i.applyToVector3Array(n.array),n.needsUpdate=!0}},fromGeometry:function(e,t){t=t||{vertexColors:r.NoColors};var n=e.vertices,i=e.faces,s=e.faceVertexUvs,o=t.vertexColors,u=s[0].length>0,a=i[0].vertexNormals.length==3,f=new Float32Array(i.length*3*3);this.addAttribute("position",new r.BufferAttribute(f,3));var l=new Float32Array(i.length*3*3);this.addAttribute("normal",new r.BufferAttribute(l,3));if(o!==r.NoColors){var c=new Float32Array(i.length*3*3);this.addAttribute("color",new r.BufferAttribute(c,3))}if(u===!0){var h=new Float32Array(i.length*3*2);this.addAttribute("uvs",new r.BufferAttribute(h,2))}for(var p=0,d=0,v=0;p<i.length;p++,d+=6,v+=9){var m=i[p],g=n[m.a],y=n[m.b],b=n[m.c];f[v]=g.x,f[v+1]=g.y,f[v+2]=g.z,f[v+3]=y.x,f[v+4]=y.y,f[v+5]=y.z,f[v+6]=b.x,f[v+7]=b.y,f[v+8]=b.z;if(a===!0){var w=m.vertexNormals[0],E=m.vertexNormals[1],S=m.vertexNormals[2];l[v]=w.x,l[v+1]=w.y,l[v+2]=w.z,l[v+3]=E.x,l[v+4]=E.y,l[v+5]=E.z,l[v+6]=S.x,l[v+7]=S.y,l[v+8]=S.z}else{var x=m.normal;l[v]=x.x,l[v+1]=x.y,l[v+2]=x.z,l[v+3]=x.x,l[v+4]=x.y,l[v+5]=x.z,l[v+6]=x.x,l[v+7]=x.y,l[v+8]=x.z}if(o===r.FaceColors){var T=m.color;c[v]=T.r,c[v+1]=T.g,c[v+2]=T.b,c[v+3]=T.r,c[v+4]=T.g,c[v+5]=T.b,c[v+6]=T.r,c[v+7]=T.g,c[v+8]=T.b}else if(o===r.VertexColors){var N=m.vertexColors[0],C=m.vertexColors[1],k=m.vertexColors[2];c[v]=N.r,c[v+1]=N.g,c[v+2]=N.b,c[v+3]=C.r,c[v+4]=C.g,c[v+5]=C.b,c[v+6]=k.r,c[v+7]=k.g,c[v+8]=k.b}if(u===!0){var L=s[0][p][0],A=s[0][p][1],O=s[0][p][2];h[d]=L.x,h[d+1]=L.y,h[d+2]=A.x,h[d+3]=A.y,h[d+4]=O.x,h[d+5]=O.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new r.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;e.length>=3&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var n=3,i=e.length;n<i;n+=3){var s=e[n],o=e[n+1],u=e[n+2];s<t.min.x?t.min.x=s:s>t.max.x&&(t.max.x=s),o<t.min.y?t.min.y=o:o>t.max.y&&(t.max.y=o),u<t.min.z?t.min.z=u:u>t.max.z&&(t.max.z=u)}}if(e===undefined||e.length===0)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')},computeBoundingSphere:function(){var e=new r.Box3,t=new r.Vector3;return function(){this.boundingSphere===null&&(this.boundingSphere=new r.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();var i=this.boundingSphere.center;for(var s=0,o=n.length;s<o;s+=3)t.set(n[s],n[s+1],n[s+2]),e.expandByPoint(t);e.center(i);var u=0;for(var s=0,o=n.length;s<o;s+=3)t.set(n[s],n[s+1],n[s+2]),u=Math.max(u,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var e,t,n,i,s=this.attributes.position.array.length;if(this.attributes.normal===undefined)this.attributes.normal={itemSize:3,array:new Float32Array(s)};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var o=this.attributes.position.array,u=this.attributes.normal.array,a,f,l,c,h,p,d=new r.Vector3,v=new r.Vector3,m=new r.Vector3,g=new r.Vector3,y=new r.Vector3;if(this.attributes.index){var b=this.attributes.index.array,w=this.offsets.length>0?this.offsets:[{start:0,count:b.length,index:0}];for(n=0,i=w.length;n<i;++n){var E=w[n].start,S=w[n].count,x=w[n].index;for(e=E,t=E+S;e<t;e+=3)a=x+b[e],f=x+b[e+1],l=x+b[e+2],c=o[a*3],h=o[a*3+1],p=o[a*3+2],d.set(c,h,p),c=o[f*3],h=o[f*3+1],p=o[f*3+2],v.set(c,h,p),c=o[l*3],h=o[l*3+1],p=o[l*3+2],m.set(c,h,p),g.subVectors(m,v),y.subVectors(d,v),g.cross(y),u[a*3]+=g.x,u[a*3+1]+=g.y,u[a*3+2]+=g.z,u[f*3]+=g.x,u[f*3+1]+=g.y,u[f*3+2]+=g.z,u[l*3]+=g.x,u[l*3+1]+=g.y,u[l*3+2]+=g.z}}else for(e=0,t=o.length;e<t;e+=9)c=o[e],h=o[e+1],p=o[e+2],d.set(c,h,p),c=o[e+3],h=o[e+4],p=o[e+5],v.set(c,h,p),c=o[e+6],h=o[e+7],p=o[e+8],m.set(c,h,p),g.subVectors(m,v),y.subVectors(d,v),g.cross(y),u[e]=g.x,u[e+1]=g.y,u[e+2]=g.z,u[e+3]=g.x,u[e+4]=g.y,u[e+5]=g.z,u[e+6]=g.x,u[e+7]=g.y,u[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeTangents:function(){function I(e,n,r){c=t[e*3],h=t[e*3+1],p=t[e*3+2],d=t[n*3],v=t[n*3+1],m=t[n*3+2],g=t[r*3],y=t[r*3+1],b=t[r*3+2],w=i[e*2],E=i[e*2+1],S=i[n*2],x=i[n*2+1],T=i[r*2],N=i[r*2+1],C=d-c,k=g-c,L=v-h,A=y-h,O=m-p,M=b-p,_=S-w,D=T-w,P=x-E,H=N-E,B=1/(_*H-D*P),j.set((H*C-P*k)*B,(H*L-P*A)*B,(H*O-P*M)*B),F.set((_*k-D*C)*B,(_*A-D*L)*B,(_*M-D*O)*B),a[e].add(j),a[n].add(j),a[r].add(j),f[e].add(F),f[n].add(F),f[r].add(F)}function it(e){Z.x=n[e*3],Z.y=n[e*3+1],Z.z=n[e*3+2],et.copy(Z),nt=a[e],G.copy(nt),G.sub(Z.multiplyScalar(Z.dot(nt))).normalize(),Y.crossVectors(et,nt),rt=Y.dot(f[e]),tt=rt<0?-1:1,u[e*4]=G.x,u[e*4+1]=G.y,u[e*4+2]=G.z,u[e*4+3]=tt}if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes.index.array,t=this.attributes.position.array,n=this.attributes.normal.array,i=this.attributes.uv.array,s=t.length/3;if(this.attributes.tangent===undefined){var o=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(o)}}var u=this.attributes.tangent.array,a=[],f=[];for(var l=0;l<s;l++)a[l]=new r.Vector3,f[l]=new r.Vector3;var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=new r.Vector3,F=new r.Vector3,q,R,U,z,W,X,V,$=this.offsets;for(U=0,z=$.length;U<z;++U){var J=$[U].start,K=$[U].count,Q=$[U].index;for(q=J,R=J+K;q<R;q+=3)W=Q+e[q],X=Q+e[q+1],V=Q+e[q+2],I(W,X,V)}var G=new r.Vector3,Y=new r.Vector3,Z=new r.Vector3,et=new r.Vector3,tt,nt,rt;for(U=0,z=$.length;U<z;++U){var J=$[U].start,K=$[U].count,Q=$[U].index;for(q=J,R=J+K;q<R;q+=3)W=Q+e[q],X=Q+e[q+1],V=Q+e[q+2],it(W),it(X),it(V)}},computeOffsets:function(e){var t=e;e===undefined&&(t=65535);var n=Date.now(),r=this.attributes.index.array,i=this.attributes.position.array,s=i.length/3,o=r.length/3,u=new Uint16Array(r.length),a=0,f=0,l=[{start:0,count:0,index:0}],c=l[0],h=0,p=0,d=new Int32Array(6),v=new Int32Array(i.length),m=new Int32Array(i.length);for(var g=0;g<i.length;g++)v[g]=-1,m[g]=-1;for(var y=0;y<o;y++){p=0;for(var b=0;b<3;b++){var w=r[y*3+b];v[w]==-1?(d[b*2]=w,d[b*2+1]=-1,p++):v[w]<c.index?(d[b*2]=w,d[b*2+1]=-1,h++):(d[b*2]=w,d[b*2+1]=v[w])}var E=f+p;if(E>c.index+t){var S={start:a,count:0,index:f};l.push(S),c=S;for(var x=0;x<6;x+=2){var T=d[x+1];T>-1&&T<c.index&&(d[x+1]=-1)}}for(var x=0;x<6;x+=2){var w=d[x],T=d[x+1];T===-1&&(T=f++),v[w]=T,m[T]=w,u[a++]=T-c.index,c.count++}}return this.reorderBuffers(u,m,f),this.offsets=l,l},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){var e=this.attributes.normal.array,t,n,r,i;for(var s=0,o=e.length;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i=1/Math.sqrt(t*t+n*n+r*r),e[s]*=i,e[s+1]*=i,e[s+2]*=i},reorderBuffers:function(e,t,n){var r={},i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var s in this.attributes){if(s=="index")continue;var o=this.attributes[s].array;for(var u=0,a=i.length;u<a;u++){var f=i[u];if(o instanceof f){r[s]=new f(this.attributes[s].itemSize*n);break}}}for(var l=0;l<n;l++){var c=t[l];for(var s in this.attributes){if(s=="index")continue;var h=this.attributes[s].array,p=this.attributes[s].itemSize,d=r[s];for(var v=0;v<p;v++)d[l*p+v]=h[c*p+v]}}this.attributes.index.array=e;for(var s in this.attributes){if(s=="index")continue;this.attributes[s].array=r[s],this.attributes[s].numItems=this.attributes[s].itemSize*n}},clone:function(){var e=new r.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var n in this.attributes){var i=this.attributes[n],s=i.array,o={itemSize:i.itemSize,array:null};for(var u=0,a=t.length;u<a;u++){var f=t[u];if(s instanceof f){o.array=new f(s);break}}e.attributes[n]=o}for(var u=0,a=this.offsets.length;u<a;u++){var l=this.offsets[u];e.offsets.push({start:l.start,index:l.index,count:l.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},r.EventDispatcher.prototype.apply(r.BufferGeometry.prototype),r.Geometry=function(){this.id=r.GeometryIdCount++,this.uuid=r.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.groupsNeedUpdate=!1},r.Geometry.prototype={constructor:r.Geometry,applyMatrix:function(e){var t=(new r.Matrix3).getNormalMatrix(e);for(var n=0,i=this.vertices.length;n<i;n++){var s=this.vertices[n];s.applyMatrix4(e)}for(var n=0,i=this.faces.length;n<i;n++){var o=this.faces[n];o.normal.applyMatrix3(t).normalize();for(var u=0,a=o.vertexNormals.length;u<a;u++)o.vertexNormals[u].applyMatrix3(t).normalize()}this.boundingBox instanceof r.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof r.Sphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=new r.Vector3;return e.addVectors(this.boundingBox.min,this.boundingBox.max),e.multiplyScalar(-0.5),this.applyMatrix((new r.Matrix4).makeTranslation(e.x,e.y,e.z)),this.computeBoundingBox(),e},computeFaceNormals:function(){var e=new r.Vector3,t=new r.Vector3;for(var n=0,i=this.faces.length;n<i;n++){var s=this.faces[n],o=this.vertices[s.a],u=this.vertices[s.b],a=this.vertices[s.c];e.subVectors(a,u),t.subVectors(o,u),e.cross(t),e.normalize(),s.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,s,o,u;u=new Array(this.vertices.length);for(t=0,n=this.vertices.length;t<n;t++)u[t]=new r.Vector3;if(e){var a,f,l,c,h=new r.Vector3,p=new r.Vector3,d=new r.Vector3,v=new r.Vector3,m=new r.Vector3;for(i=0,s=this.faces.length;i<s;i++)o=this.faces[i],a=this.vertices[o.a],f=this.vertices[o.b],l=this.vertices[o.c],h.subVectors(l,f),p.subVectors(a,f),h.cross(p),u[o.a].add(h),u[o.b].add(h),u[o.c].add(h)}else for(i=0,s=this.faces.length;i<s;i++)o=this.faces[i],u[o.a].add(o.normal),u[o.b].add(o.normal),u[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)u[t].normalize();for(i=0,s=this.faces.length;i<s;i++)o=this.faces[i],o.vertexNormals[0]=u[o.a].clone(),o.vertexNormals[1]=u[o.b].clone(),o.vertexNormals[2]=u[o.c].clone()},computeMorphNormals:function(){var e,t,n,i,s;for(n=0,i=this.faces.length;n<i;n++){s=this.faces[n],s.__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]);for(e=0,t=s.vertexNormals.length;e<t;e++)s.__originalVertexNormals[e]?s.__originalVertexNormals[e].copy(s.vertexNormals[e]):s.__originalVertexNormals[e]=s.vertexNormals[e].clone()}var o=new r.Geometry;o.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var u=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals,f,l;for(n=0,i=this.faces.length;n<i;n++)f=new r.Vector3,l={a:new r.Vector3,b:new r.Vector3,c:new r.Vector3},u.push(f),a.push(l)}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var f,l;for(n=0,i=this.faces.length;n<i;n++)s=this.faces[n],f=c.faceNormals[n],l=c.vertexNormals[n],f.copy(s.normal),l.a.copy(s.vertexNormals[0]),l.b.copy(s.vertexNormals[1]),l.c.copy(s.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)s=this.faces[n],s.normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals},computeTangents:function(){function j(e,t,n,r,i,s,o){l=e.vertices[t],c=e.vertices[n],h=e.vertices[r],p=f[i],d=f[s],v=f[o],m=c.x-l.x,g=h.x-l.x,y=c.y-l.y,b=h.y-l.y,w=c.z-l.z,E=h.z-l.z,S=d.x-p.x,x=v.x-p.x,T=d.y-p.y,N=v.y-p.y,C=1/(S*N-x*T),M.set((N*m-T*g)*C,(N*y-T*b)*C,(N*w-T*E)*C),_.set((S*g-x*m)*C,(S*b-x*y)*C,(S*E-x*w)*C),A[t].add(M),A[n].add(M),A[r].add(M),O[t].add(_),O[n].add(_),O[r].add(_)}var e,t,n,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A=[],O=[],M=new r.Vector3,_=new r.Vector3,D=new r.Vector3,P=new r.Vector3,H=new r.Vector3,B;for(n=0,i=this.vertices.length;n<i;n++)A[n]=new r.Vector3,O[n]=new r.Vector3;for(e=0,t=this.faces.length;e<t;e++)a=this.faces[e],f=this.faceVertexUvs[0][e],j(this,a.a,a.b,a.c,0,1,2);var F=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){a=this.faces[e];for(s=0;s<Math.min(a.vertexNormals.length,3);s++)H.copy(a.vertexNormals[s]),u=a[F[s]],k=A[u],D.copy(k),D.sub(H.multiplyScalar(H.dot(k))).normalize(),P.crossVectors(a.vertexNormals[s],k),L=P.dot(O[u]),B=L<0?-1:1,a.vertexTangents[s]=new r.Vector4(D.x,D.y,D.z,B)}this.hasTangents=!0},computeLineDistances:function(){var e=0,t=this.vertices;for(var n=0,r=t.length;n<r;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new r.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new r.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof r.Geometry==0){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var i,s=this.vertices.length,o=this.faceVertexUvs[0].length,u=this.vertices,a=e.vertices,f=this.faces,l=e.faces,c=this.faceVertexUvs[0],h=e.faceVertexUvs[0];n===undefined&&(n=0),t!==undefined&&(i=(new r.Matrix3).getNormalMatrix(t));for(var p=0,d=a.length;p<d;p++){var v=a[p],m=v.clone();t!==undefined&&m.applyMatrix4(t),u.push(m)}for(p=0,d=l.length;p<d;p++){var g=l[p],y,b,w,E=g.vertexNormals,S=g.vertexColors;y=new r.Face3(g.a+s,g.b+s,g.c+s),y.normal.copy(g.normal),i!==undefined&&y.normal.applyMatrix3(i).normalize();for(var x=0,T=E.length;x<T;x++)b=E[x].clone(),i!==undefined&&b.applyMatrix3(i).normalize(),y.vertexNormals.push(b);y.color.copy(g.color);for(var x=0,T=S.length;x<T;x++)w=S[x],y.vertexColors.push(w.clone());y.materialIndex=g.materialIndex+n,f.push(y)}for(p=0,d=h.length;p<d;p++){var N=h[p],C=[];if(N===undefined)continue;for(var x=0,T=N.length;x<T;x++)C.push(new r.Vector2(N[x].x,N[x].y));c.push(C)}},mergeVertices:function(){var e={},t=[],n=[],r,i,s=4,o=Math.pow(10,s),u,a,f,l,c,h,p,d;for(u=0,a=this.vertices.length;u<a;u++)r=this.vertices[u],i=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o),e[i]===undefined?(e[i]=u,t.push(this.vertices[u]),n[u]=t.length-1):n[u]=n[e[i]];var v=[];for(u=0,a=this.faces.length;u<a;u++){f=this.faces[u],f.a=n[f.a],f.b=n[f.b],f.c=n[f.c],l=[f.a,f.b,f.c];var m=-1;for(var g=0;g<3;g++)if(l[g]==l[(g+1)%3]){m=g,v.push(u);break}}for(u=v.length-1;u>=0;u--){var y=v[u];this.faces.splice(y,1);for(h=0,p=this.faceVertexUvs.length;h<p;h++)this.faceVertexUvs[h].splice(y,1)}var b=this.vertices.length-t.length;return this.vertices=t,b},makeGroups:function(){var e=0;return function(t,n){var r,i,s,o,u,a={},f,l=this.morphTargets.length,c=this.morphNormals.length;this.geometryGroups={},this.geometryGroupsList=[];for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],o=t?s.materialIndex:0,o in a||(a[o]={hash:o,counter:0}),u=a[o].hash+"_"+a[o].counter,u in this.geometryGroups||(f={id:e++,faces3:[],materialIndex:o,vertices:0,numMorphTargets:l,numMorphNormals:c},this.geometryGroups[u]=f,this.geometryGroupsList.push(f)),this.geometryGroups[u].vertices+3>n&&(a[o].counter+=1,u=a[o].hash+"_"+a[o].counter,u in this.geometryGroups||(f={id:e++,faces3:[],materialIndex:o,vertices:0,numMorphTargets:l,numMorphNormals:c},this.geometryGroups[u]=f,this.geometryGroupsList.push(f))),this.geometryGroups[u].faces3.push(r),this.geometryGroups[u].vertices+=3}}(),clone:function(){var e=new r.Geometry,t=this.vertices;for(var n=0,i=t.length;n<i;n++)e.vertices.push(t[n].clone());var s=this.faces;for(var n=0,i=s.length;n<i;n++)e.faces.push(s[n].clone());var o=this.faceVertexUvs[0];for(var n=0,i=o.length;n<i;n++){var u=o[n],a=[];for(var f=0,l=u.length;f<l;f++)a.push(new r.Vector2(u[f].x,u[f].y));e.faceVertexUvs[0].push(a)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},r.EventDispatcher.prototype.apply(r.Geometry.prototype),r.GeometryIdCount=0,r.Camera=function(){r.Object3D.call(this),this.matrixWorldInverse=new r.Matrix4,this.projectionMatrix=new r.Matrix4},r.Camera.prototype=Object.create(r.Object3D.prototype),r.Camera.prototype.lookAt=function(){var e=new r.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),r.Camera.prototype.clone=function(e){return e===undefined&&(e=new r.Camera),r.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},r.CubeCamera=function(e,t,n){r.Object3D.call(this);var i=90,s=1,o=new r.PerspectiveCamera(i,s,e,t);o.up.set(0,-1,0),o.lookAt(new r.Vector3(1,0,0)),this.add(o);var u=new r.PerspectiveCamera(i,s,e,t);u.up.set(0,-1,0),u.lookAt(new r.Vector3(-1,0,0)),this.add(u);var a=new r.PerspectiveCamera(i,s,e,t);a.up.set(0,0,1),a.lookAt(new r.Vector3(0,1,0)),this.add(a);var f=new r.PerspectiveCamera(i,s,e,t);f.up.set(0,0,-1),f.lookAt(new r.Vector3(0,-1,0)),this.add(f);var l=new r.PerspectiveCamera(i,s,e,t);l.up.set(0,-1,0),l.lookAt(new r.Vector3(0,0,1)),this.add(l);var c=new r.PerspectiveCamera(i,s,e,t);c.up.set(0,-1,0),c.lookAt(new r.Vector3(0,0,-1)),this.add(c),this.renderTarget=new r.WebGLRenderTargetCube(n,n,{format:r.RGBFormat,magFilter:r.LinearFilter,minFilter:r.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,r=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,o,n),n.activeCubeFace=1,e.render(t,u,n),n.activeCubeFace=2,e.render(t,a,n),n.activeCubeFace=3,e.render(t,f,n),n.activeCubeFace=4,e.render(t,l,n),n.generateMipmaps=r,n.activeCubeFace=5,e.render(t,c,n)}},r.CubeCamera.prototype=Object.create(r.Object3D.prototype),r.OrthographicCamera=function(e,t,n,i,s,o){r.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s!==undefined?s:.1,this.far=o!==undefined?o:2e3,this.updateProjectionMatrix()},r.OrthographicCamera.prototype=Object.create(r.Camera.prototype),r.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},r.OrthographicCamera.prototype.clone=function(){var e=new r.OrthographicCamera;return r.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},r.PerspectiveCamera=function(e,t,n,i){r.Camera.call(this),this.fov=e!==undefined?e:50,this.aspect=t!==undefined?t:1,this.near=n!==undefined?n:.1,this.far=i!==undefined?i:2e3,this.updateProjectionMatrix()},r.PerspectiveCamera.prototype=Object.create(r.Camera.prototype),r.PerspectiveCamera.prototype.setLens=function(e,t){t===undefined&&(t=24),this.fov=2*r.Math.radToDeg(Math.atan(t/(e*2))),this.updateProjectionMatrix()},r.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},r.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(r.Math.degToRad(this.fov*.5))*this.near,n=-t,i=e*n,s=e*t,o=Math.abs(s-i),u=Math.abs(t-n);this.projectionMatrix.makeFrustum(i+this.x*o/this.fullWidth,i+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*u/this.fullHeight,t-this.y*u/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},r.PerspectiveCamera.prototype.clone=function(){var e=new r.PerspectiveCamera;return r.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},r.Light=function(e){r.Object3D.call(this),this.color=new r.Color(e)},r.Light.prototype=Object.create(r.Object3D.prototype),r.Light.prototype.clone=function(e){return e===undefined&&(e=new r.Light),r.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},r.AmbientLight=function(e){r.Light.call(this,e)},r.AmbientLight.prototype=Object.create(r.Light.prototype),r.AmbientLight.prototype.clone=function(){var e=new r.AmbientLight;return r.Light.prototype.clone.call(this,e),e},r.AreaLight=function(e,t){r.Light.call(this,e),this.normal=new r.Vector3(0,-1,0),this.right=new r.Vector3(1,0,0),this.intensity=t!==undefined?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},r.AreaLight.prototype=Object.create(r.Light.prototype),r.DirectionalLight=function(e,t){r.Light.call(this,e),this.position.set(0,1,0),this.target=new r.Object3D,this.intensity=t!==undefined?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new r.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},r.DirectionalLight.prototype=Object.create(r.Light.prototype),r.DirectionalLight.prototype.clone=function(){var e=new r.DirectionalLight;return r.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},r.HemisphereLight=function(e,t,n){r.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new r.Color(t),this.intensity=n!==undefined?n:1},r.HemisphereLight.prototype=Object.create(r.Light.prototype),r.HemisphereLight.prototype.clone=function(){var e=new r.HemisphereLight;return r.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},r.PointLight=function(e,t,n){r.Light.call(this,e),this.intensity=t!==undefined?t:1,this.distance=n!==undefined?n:0},r.PointLight.prototype=Object.create(r.Light.prototype),r.PointLight.prototype.clone=function(){var e=new r.PointLight;return r.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},r.SpotLight=function(e,t,n,i,s){r.Light.call(this,e),this.position.set(0,1,0),this.target=new r.Object3D,this.intensity=t!==undefined?t:1,this.distance=n!==undefined?n:0,this.angle=i!==undefined?i:Math.PI/3,this.exponent=s!==undefined?s:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},r.SpotLight.prototype=Object.create(r.Light.prototype),r.SpotLight.prototype.clone=function(){var e=new r.SpotLight;return r.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},r.Cache=function(){this.files={}},r.Cache.prototype={constructor:r.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},r.Loader=function(e){this.showStatus=e,this.statusDomElement=e?r.Loader.prototype.addStatusElement():null,this.imageLoader=new r.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},r.Loader.prototype={constructor:r.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.length===1?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){var n=[];for(var r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i instanceof r.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function s(e,s,o,u,a,f,l){var c=t+o,h,p=r.Loader.Handlers.get(c);p!==null?h=p.load(c):(h=new r.Texture,p=n.imageLoader,p.crossOrigin=n.crossOrigin,p.load(c,function(e){if(r.Math.isPowerOfTwo(e.width)===!1||r.Math.isPowerOfTwo(e.height)===!1){var t=i(e.width),n=i(e.height),s=document.createElement("canvas");s.width=t,s.height=n;var o=s.getContext("2d");o.drawImage(e,0,0,t,n),h.image=s}else h.image=e;h.needsUpdate=!0})),h.sourceFile=o,u&&(h.repeat.set(u[0],u[1]),u[0]!==1&&(h.wrapS=r.RepeatWrapping),u[1]!==1&&(h.wrapT=r.RepeatWrapping)),a&&h.offset.set(a[0],a[1]);if(f){var d={repeat:r.RepeatWrapping,mirror:r.MirroredRepeatWrapping};d[f[0]]!==undefined&&(h.wrapS=d[f[0]]),d[f[1]]!==undefined&&(h.wrapT=d[f[1]])}l&&(h.anisotropy=l),e[s]=h}function o(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var n=this,u="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var f=e.shading.toLowerCase();f==="phong"?u="MeshPhongMaterial":f==="basic"&&(u="MeshBasicMaterial")}e.blending!==undefined&&r[e.blending]!==undefined&&(a.blending=r[e.blending]);if(e.transparent!==undefined||e.opacity<1)a.transparent=e.transparent;e.depthTest!==undefined&&(a.depthTest=e.depthTest),e.depthWrite!==undefined&&(a.depthWrite=e.depthWrite),e.visible!==undefined&&(a.visible=e.visible),e.flipSided!==undefined&&(a.side=r.BackSide),e.doubleSided!==undefined&&(a.side=r.DoubleSide),e.wireframe!==undefined&&(a.wireframe=e.wireframe),e.vertexColors!==undefined&&(e.vertexColors==="face"?a.vertexColors=r.FaceColors:e.vertexColors&&(a.vertexColors=r.VertexColors)),e.colorDiffuse?a.color=o(e.colorDiffuse):e.DbgColor&&(a.color=e.DbgColor),e.colorSpecular&&(a.specular=o(e.colorSpecular)),e.colorAmbient&&(a.ambient=o(e.colorAmbient)),e.colorEmissive&&(a.emissive=o(e.colorEmissive)),e.transparency&&(a.opacity=e.transparency),e.specularCoef&&(a.shininess=e.specularCoef),e.mapDiffuse&&t&&s(a,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&s(a,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&s(a,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&s(a,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&s(a,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&s(a,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(a.bumpScale=e.mapBumpScale);if(e.mapNormal){var l=r.ShaderLib.normalmap,c=r.UniformsUtils.clone(l.uniforms);c.tNormal.value=a.normalMap,e.mapNormalFactor&&c.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),a.map&&(c.tDiffuse.value=a.map,c.enableDiffuse.value=!0),a.specularMap&&(c.tSpecular.value=a.specularMap,c.enableSpecular.value=!0),a.lightMap&&(c.tAO.value=a.lightMap,c.enableAO.value=!0),c.diffuse.value.setHex(a.color),c.specular.value.setHex(a.specular),c.ambient.value.setHex(a.ambient),c.shininess.value=a.shininess,a.opacity!==undefined&&(c.opacity.value=a.opacity);var h={fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:c,lights:!0,fog:!0},p=new r.ShaderMaterial(h);a.transparent&&(p.transparent=!0)}else var p=new r[u](a);return e.DbgName!==undefined&&(p.name=e.DbgName),p}},r.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var r=this.handlers[t],i=this.handlers[t+1];if(r.test(e))return i}return null}},r.XHRLoader=function(e){this.cache=new r.Cache,this.manager=e!==undefined?e:r.DefaultLoadingManager},r.XHRLoader.prototype={constructor:r.XHRLoader,load:function(e,t,n,r){var i=this,s=i.cache.get(e);if(s!==undefined){t&&t(s);return}var o=new XMLHttpRequest;o.open("GET",e,!0),o.addEventListener("load",function(n){i.cache.add(e,this.response),t&&t(this.response),i.manager.itemEnd(e)},!1),n!==undefined&&o.addEventListener("progress",function(e){n(e)},!1),r!==undefined&&o.addEventListener("error",function(e){r(e)},!1),this.crossOrigin!==undefined&&(o.crossOrigin=this.crossOrigin),this.responseType!==undefined&&(o.responseType=this.responseType),o.send(null),i.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},r.ImageLoader=function(e){this.cache=new r.Cache,this.manager=e!==undefined?e:r.DefaultLoadingManager},r.ImageLoader.prototype={constructor:r.ImageLoader,load:function(e,t,n,r){var i=this,s=i.cache.get(e);if(s!==undefined){t(s);return}var o=document.createElement("img");return t!==undefined&&o.addEventListener("load",function(n){i.cache.add(e,this),t(this),i.manager.itemEnd(e)},!1),n!==undefined&&o.addEventListener("progress",function(e){n(e)},!1),r!==undefined&&o.addEventListener("error",function(e){r(e)},!1),this.crossOrigin!==undefined&&(o.crossOrigin=this.crossOrigin),o.src=e,i.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},r.JSONLoader=function(e){r.Loader.call(this,e),this.withCredentials=!1},r.JSONLoader.prototype=Object.create(r.Loader.prototype),r.JSONLoader.prototype.load=function(e,t,n){var r=this;n=n&&typeof n=="string"?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},r.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(s.status===200||s.status===0){if(s.responseText){var u=JSON.parse(s.responseText);if(u.metadata!==undefined&&u.metadata.type==="scene"){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}var a=e.parse(u,r);n(a.geometry,a.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+s.status+")");else s.readyState===s.LOADING?i&&(o===0&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&i!==undefined&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.withCredentials=this.withCredentials,s.send(null)},r.JSONLoader.prototype.parse=function(e,t){function o(t){function n(e,t){return e&1<<t}var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=e.faces,P=e.vertices,H=e.normals,B=e.colors,j=0;if(e.uvs!==undefined){for(s=0;s<e.uvs.length;s++)e.uvs[s].length&&j++;for(s=0;s<j;s++)i.faceVertexUvs[s]=[]}a=0,f=P.length;while(a<f)S=new r.Vector3,S.x=P[a++]*t,S.y=P[a++]*t,S.z=P[a++]*t,i.vertices.push(S);a=0,f=D.length;while(a<f){d=D[a++],v=n(d,0),m=n(d,1),g=n(d,3),y=n(d,4),b=n(d,5),w=n(d,6),E=n(d,7);if(v){T=new r.Face3,T.a=D[a],T.b=D[a+1],T.c=D[a+3],N=new r.Face3,N.a=D[a+1],N.b=D[a+2],N.c=D[a+3],a+=4,m&&(p=D[a++],T.materialIndex=p,N.materialIndex=p),u=i.faces.length;if(g)for(s=0;s<j;s++){A=e.uvs[s],i.faceVertexUvs[s][u]=[],i.faceVertexUvs[s][u+1]=[];for(o=0;o<4;o++)h=D[a++],M=A[h*2],_=A[h*2+1],O=new r.Vector2(M,_),o!==2&&i.faceVertexUvs[s][u].push(O),o!==0&&i.faceVertexUvs[s][u+1].push(O)}y&&(c=D[a++]*3,T.normal.set(H[c++],H[c++],H[c]),N.normal.copy(T.normal));if(b)for(s=0;s<4;s++)c=D[a++]*3,L=new r.Vector3(H[c++],H[c++],H[c]),s!==2&&T.vertexNormals.push(L),s!==0&&N.vertexNormals.push(L);w&&(l=D[a++],k=B[l],T.color.setHex(k),N.color.setHex(k));if(E)for(s=0;s<4;s++)l=D[a++],k=B[l],s!==2&&T.vertexColors.push(new r.Color(k)),s!==0&&N.vertexColors.push(new r.Color(k));i.faces.push(T),i.faces.push(N)}else{x=new r.Face3,x.a=D[a++],x.b=D[a++],x.c=D[a++],m&&(p=D[a++],x.materialIndex=p),u=i.faces.length;if(g)for(s=0;s<j;s++){A=e.uvs[s],i.faceVertexUvs[s][u]=[];for(o=0;o<3;o++)h=D[a++],M=A[h*2],_=A[h*2+1],O=new r.Vector2(M,_),i.faceVertexUvs[s][u].push(O)}y&&(c=D[a++]*3,x.normal.set(H[c++],H[c++],H[c]));if(b)for(s=0;s<3;s++)c=D[a++]*3,L=new r.Vector3(H[c++],H[c++],H[c]),x.vertexNormals.push(L);w&&(l=D[a++],x.color.setHex(B[l]));if(E)for(s=0;s<3;s++)l=D[a++],x.vertexColors.push(new r.Color(B[l]));i.faces.push(x)}}}function u(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,s=e.skinWeights.length;n<s;n+=t){var o=e.skinWeights[n],u=t>1?e.skinWeights[n+1]:0,a=t>2?e.skinWeights[n+2]:0,f=t>3?e.skinWeights[n+3]:0;i.skinWeights.push(new r.Vector4(o,u,a,f))}if(e.skinIndices)for(var n=0,s=e.skinIndices.length;n<s;n+=t){var l=e.skinIndices[n],c=t>1?e.skinIndices[n+1]:0,h=t>2?e.skinIndices[n+2]:0,p=t>3?e.skinIndices[n+3]:0;i.skinIndices.push(new r.Vector4(l,c,h,p))}i.bones=e.bones,i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&console.warn("When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match."),i.animation=e.animation,i.animations=e.animations}function a(t){if(e.morphTargets!==undefined){var n,s,o,u,a,f;for(n=0,s=e.morphTargets.length;n<s;n++){i.morphTargets[n]={},i.morphTargets[n].name=e.morphTargets[n].name,i.morphTargets[n].vertices=[],a=i.morphTargets[n].vertices,f=e.morphTargets[n].vertices;for(o=0,u=f.length;o<u;o+=3){var l=new r.Vector3;l.x=f[o]*t,l.y=f[o+1]*t,l.z=f[o+2]*t,a.push(l)}}}if(e.morphColors!==undefined){var n,s,c,h,p,d,v;for(n=0,s=e.morphColors.length;n<s;n++){i.morphColors[n]={},i.morphColors[n].name=e.morphColors[n].name,i.morphColors[n].colors=[],p=i.morphColors[n].colors,d=e.morphColors[n].colors;for(c=0,h=d.length;c<h;c+=3)v=new r.Color(16755200),v.setRGB(d[c],d[c+1],d[c+2]),p.push(v)}}}var n=this,i=new r.Geometry,s=e.scale!==undefined?1/e.scale:1;o(s),u(),a(s),i.computeFaceNormals(),i.computeBoundingSphere();if(e.materials===undefined||e.materials.length===0)return{geometry:i};var f=this.initMaterials(e.materials,t);return this.needsTangents(f)&&i.computeTangents(),{geometry:i,materials:f}},r.LoadingManager=function(e,t,n){var r=this,i=0,s=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++},this.itemEnd=function(e){i++,r.onProgress!==undefined&&r.onProgress(e,i,s),i===s&&r.onLoad!==undefined&&r.onLoad()}},r.DefaultLoadingManager=new r.LoadingManager,r.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:r.DefaultLoadingManager},r.BufferGeometryLoader.prototype={constructor:r.BufferGeometryLoader,load:function(e,t,n,i){var s=this,o=new r.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(s.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new r.BufferGeometry,n=e.attributes;for(var i in n){var s=n[i];t.attributes[i]={itemSize:s.itemSize,array:new self[s.type](s.array)}}var o=e.offsets;o!==undefined&&(t.offsets=JSON.parse(JSON.stringify(o)));var u=e.boundingSphere;return u!==undefined&&(t.boundingSphere=new r.Sphere((new r.Vector3).fromArray(u.center!==undefined?u.center:[0,0,0]),u.radius)),t}},r.MaterialLoader=function(e){this.manager=e!==undefined?e:r.DefaultLoadingManager},r.MaterialLoader.prototype={constructor:r.MaterialLoader,load:function(e,t,n,i){var s=this,o=new r.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(s.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new r[e.type];e.color!==undefined&&t.color.setHex(e.color),e.ambient!==undefined&&t.ambient.setHex(e.ambient),e.emissive!==undefined&&t.emissive.setHex(e.emissive),e.specular!==undefined&&t.specular.setHex(e.specular),e.shininess!==undefined&&(t.shininess=e.shininess),e.uniforms!==undefined&&(t.uniforms=e.uniforms),e.vertexShader!==undefined&&(t.vertexShader=e.vertexShader),e.fragmentShader!==undefined&&(t.fragmentShader=e.fragmentShader),e.vertexColors!==undefined&&(t.vertexColors=e.vertexColors),e.blending!==undefined&&(t.blending=e.blending),e.side!==undefined&&(t.side=e.side),e.opacity!==undefined&&(t.opacity=e.opacity),e.transparent!==undefined&&(t.transparent=e.transparent),e.wireframe!==undefined&&(t.wireframe=e.wireframe);if(e.materials!==undefined)for(var n=0,i=e.materials.length;n<i;n++)t.materials.push(this.parse(e.materials[n]));return t}},r.ObjectLoader=function(e){this.manager=e!==undefined?e:r.DefaultLoadingManager},r.ObjectLoader.prototype={constructor:r.ObjectLoader,load:function(e,t,n,i){var s=this,o=new r.XHRLoader(s.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(s.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),n=this.parseMaterials(e.materials),r=this.parseObject(e.object,t,n);return r},parseGeometries:function(e){var t={};if(e!==undefined){var n=new r.JSONLoader,i=new r.BufferGeometryLoader;for(var s=0,o=e.length;s<o;s++){var u,a=e[s];switch(a.type){case"PlaneGeometry":u=new r.PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"CubeGeometry":u=new r.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":u=new r.CircleGeometry(a.radius,a.segments);break;case"CylinderGeometry":u=new r.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":u=new r.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":u=new r.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":u=new r.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":u=new r.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":u=i.parse(a.data);break;case"Geometry":u=n.parse(a.data).geometry}u.uuid=a.uuid,a.name!==undefined&&(u.name=a.name),t[a.uuid]=u}}return t},parseMaterials:function(e){var t={};if(e!==undefined){var n=new r.MaterialLoader;for(var i=0,s=e.length;i<s;i++){var o=e[i],u=n.parse(o);u.uuid=o.uuid,o.name!==undefined&&(u.name=o.name),t[o.uuid]=u}}return t},parseObject:function(){var e=new r.Matrix4;return function(t,n,i){var s;switch(t.type){case"Scene":s=new r.Scene;break;case"PerspectiveCamera":s=new r.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":s=new r.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":s=new r.AmbientLight(t.color);break;case"DirectionalLight":s=new r.DirectionalLight(t.color,t.intensity);break;case"PointLight":s=new r.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":s=new r.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":s=new r.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=n[t.geometry],u=i[t.material];o===undefined&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),u===undefined&&console.error("THREE.ObjectLoader: Undefined material "+t.material),s=new r.Mesh(o,u);break;case"Sprite":var u=i[t.material];u===undefined&&console.error("THREE.ObjectLoader: Undefined material "+t.material),s=new r.Sprite(u);break;default:s=new r.Object3D}s.uuid=t.uuid,t.name!==undefined&&(s.name=t.name),t.matrix!==undefined?(e.fromArray(t.matrix),e.decompose(s.position,s.quaternion,s.scale)):(t.position!==undefined&&s.position.fromArray(t.position),t.rotation!==undefined&&s.rotation.fromArray(t.rotation),t.scale!==undefined&&s.scale.fromArray(t.scale)),t.visible!==undefined&&(s.visible=t.visible),t.userData!==undefined&&(s.userData=t.userData);if(t.children!==undefined)for(var a in t.children)s.add(this.parseObject(t.children[a],n,i));return s}}()},r.TextureLoader=function(e){this.manager=e!==undefined?e:r.DefaultLoadingManager},r.TextureLoader.prototype={constructor:r.TextureLoader,load:function(e,t,n,i){var s=this,o=new r.ImageLoader(s.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){var n=new r.Texture(e);n.needsUpdate=!0,t!==undefined&&t(n)},n,i)},setCrossOrigin:function(e){this.crossOrigin=e}},r.Material=function(){this.id=r.MaterialIdCount++,this.uuid=r.Math.generateUUID(),this.name="",this.side=r.FrontSide,this.opacity=1,this.transparent=!1,this.blending=r.NormalBlending,this.blendSrc=r.SrcAlphaFactor,this.blendDst=r.OneMinusSrcAlphaFactor,this.blendEquation=r.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},r.Material.prototype={constructor:r.Material,setValues:function(e){if(e===undefined)return;for(var t in e){var n=e[t];if(n===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var i=this[t];i instanceof r.Color?i.set(n):i instanceof r.Vector3&&n instanceof r.Vector3?i.copy(n):t=="overdraw"?this[t]=Number(n):this[t]=n}}},clone:function(e){return e===undefined&&(e=new r.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},r.EventDispatcher.prototype.apply(r.Material.prototype),r.MaterialIdCount=0,r.LineBasicMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=r.NoColors,this.fog=!0,this.setValues(e)},r.LineBasicMaterial.prototype=Object.create(r.Material.prototype),r.LineBasicMaterial.prototype.clone=function(){var e=new r.LineBasicMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},r.LineDashedMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},r.LineDashedMaterial.prototype=Object.create(r.Material.prototype),r.LineDashedMaterial.prototype.clone=function(){var e=new r.LineDashedMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},r.MeshBasicMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=r.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=r.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=r.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},r.MeshBasicMaterial.prototype=Object.create(r.Material.prototype),r.MeshBasicMaterial.prototype.clone=function(){var e=new r.MeshBasicMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},r.MeshLambertMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.ambient=new r.Color(16777215),this.emissive=new r.Color(0),this.wrapAround=!1,this.wrapRGB=new r.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=r.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=r.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=r.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},r.MeshLambertMaterial.prototype=Object.create(r.Material.prototype),r.MeshLambertMaterial.prototype.clone=function(){var e=new r.MeshLambertMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},r.MeshPhongMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.ambient=new r.Color(16777215),this.emissive=new r.Color(0),this.specular=new r.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new r.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=r.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=r.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=r.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},r.MeshPhongMaterial.prototype=Object.create(r.Material.prototype),r.MeshPhongMaterial.prototype.clone=function(){var e=new r.MeshPhongMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},r.MeshDepthMaterial=function(e){r.Material.call(this),this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},r.MeshDepthMaterial.prototype=Object.create(r.Material.prototype),r.MeshDepthMaterial.prototype.clone=function(){var e=new r.MeshDepthMaterial;return r.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},r.MeshNormalMaterial=function(e){r.Material.call(this,e),this.shading=r.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},r.MeshNormalMaterial.prototype=Object.create(r.Material.prototype),r.MeshNormalMaterial.prototype.clone=function(){var e=new r.MeshNormalMaterial;return r.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},r.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},r.MeshFaceMaterial.prototype.clone=function(){var e=new r.MeshFaceMaterial;for(var t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},r.PointCloudMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=r.NoColors,this.fog=!0,this.setValues(e)},r.PointCloudMaterial.prototype=Object.create(r.Material.prototype),r.PointCloudMaterial.prototype.clone=function(){var e=new r.PointCloudMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},r.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new r.PointCloudMaterial(e)},r.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new r.PointCloudMaterial(e)},r.ShaderMaterial=function(e){r.Material.call(this),this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=r.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=r.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=undefined,this.setValues(e)},r.ShaderMaterial.prototype=Object.create(r.Material.prototype),r.ShaderMaterial.prototype.clone=function(){var e=new r.ShaderMaterial;return r.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=r.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},r.RawShaderMaterial=function(e){r.ShaderMaterial.call(this,e)},r.RawShaderMaterial.prototype=Object.create(r.ShaderMaterial.prototype),r.RawShaderMaterial.prototype.clone=function(){var e=new r.RawShaderMaterial;return r.ShaderMaterial.prototype.clone.call(this,e),e},r.SpriteMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},r.SpriteMaterial.prototype=Object.create(r.Material.prototype),r.SpriteMaterial.prototype.clone=function(){var e=new r.SpriteMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},r.SpriteCanvasMaterial=function(e){r.Material.call(this),this.color=new r.Color(16777215),this.program=function(e,t){},this.setValues(e)},r.SpriteCanvasMaterial.prototype=Object.create(r.Material.prototype),r.SpriteCanvasMaterial.prototype.clone=function(){var e=new r.SpriteCanvasMaterial;return r.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},r.ParticleCanvasMaterial=r.SpriteCanvasMaterial,r.Texture=function(e,t,n,i,s,o,u,a,f){this.id=r.TextureIdCount++,this.uuid=r.Math.generateUUID(),this.name="",this.image=e!==undefined?e:r.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==undefined?t:r.Texture.DEFAULT_MAPPING,this.wrapS=n!==undefined?n:r.ClampToEdgeWrapping,this.wrapT=i!==undefined?i:r.ClampToEdgeWrapping,this.magFilter=s!==undefined?s:r.LinearFilter,this.minFilter=o!==undefined?o:r.LinearMipMapLinearFilter,this.anisotropy=f!==undefined?f:1,this.format=u!==undefined?u:r.RGBAFormat,this.type=a!==undefined?a:r.UnsignedByteType,this.offset=new r.Vector2(0,0),this.repeat=new r.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},r.Texture.DEFAULT_IMAGE=undefined,r.Texture.DEFAULT_MAPPING=new r.UVMapping,r.Texture.prototype={constructor:r.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return e===undefined&&(e=new r.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},r.EventDispatcher.prototype.apply(r.Texture.prototype),r.TextureIdCount=0,r.CubeTexture=function(e,t,n,i,s,o,u,a,f){r.Texture.call(this,e,t,n,i,s,o,u,a,f),this.images=e},r.CubeTexture.prototype=Object.create(r.Texture.prototype),r.CubeTexture.clone=function(e){return e===undefined&&(e=new r.CubeTexture),r.Texture.prototype.clone.call(this,e),e.images=this.images,e},r.CompressedTexture=function(e,t,n,i,s,o,u,a,f,l,c){r.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={width:t,height:n},this.mipmaps=e,this.generateMipmaps=!1},r.CompressedTexture.prototype=Object.create(r.Texture.prototype),r.CompressedTexture.prototype.clone=function(){var e=new r.CompressedTexture;return r.Texture.prototype.clone.call(this,e),e},r.DataTexture=function(e,t,n,i,s,o,u,a,f,l,c){r.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={data:e,width:t,height:n}},r.DataTexture.prototype=Object.create(r.Texture.prototype),r.DataTexture.prototype.clone=function(){var e=new r.DataTexture;return r.Texture.prototype.clone.call(this,e),e},r.PointCloud=function(e,t){r.Object3D.call(this),this.geometry=e!==undefined?e:new r.Geometry,this.material=t!==undefined?t:new r.PointCloudMaterial({color:Math.random()*16777215}),this.sortParticles=!1},r.PointCloud.prototype=Object.create(r.Object3D.prototype),r.PointCloud.prototype.raycast=function(){var e=new r.Matrix4,t=new r.Ray;return function(n,i){var s=this,o=s.geometry,u=n.params.PointCloud.threshold;e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e);if(o.boundingBox!==null&&t.isIntersectionBox(o.boundingBox)===!1)return;var a=u/((this.scale.x+this.scale.y+this.scale.z)/3),f=new r.Vector3,l=function(e,r){var o=t.distanceToPoint(e);if(o<a){var u=t.closestPointToPoint(e);u.applyMatrix4(s.matrixWorld);var f=n.ray.origin.distanceTo(u);i.push({distance:f,distanceToRay:o,point:u.clone(),index:r,face:null,object:s})}};if(o instanceof r.BufferGeometry){var c=o.attributes,h=c.position.array;if(c.index!==undefined){var p=c.index.array,d=o.offsets;if(d.length===0){var v={start:0,count:p.length,index:0};d=[v]}for(var m=0,g=d.length;m<g;++m){var y=d[m].start,b=d[m].count,w=d[m].index;for(var E=y,S=y+b;E<S;E++){var x=w+p[E];f.set(h[x*3],h[x*3+1],h[x*3+2]),l(f,x)}}}else{var T=h.length/3;for(var E=0;E<T;E++)f.set(h[3*E],h[3*E+1],h[3*E+2]),l(f,E)}}else{var N=this.geometry.vertices;for(var E=0;E<N.length;E++)l(N[E],E)}}}(),r.PointCloud.prototype.clone=function(e){return e===undefined&&(e=new r.PointCloud(this.geometry,this.material)),e.sortParticles=this.sortParticles,r.Object3D.prototype.clone.call(this,e),e},r.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new r.PointCloud(e,t)},r.Line=function(e,t,n){r.Object3D.call(this),this.geometry=e!==undefined?e:new r.Geometry,this.material=t!==undefined?t:new r.LineBasicMaterial({color:Math.random()*16777215}),this.type=n!==undefined?n:r.LineStrip},r.LineStrip=0,r.LinePieces=1,r.Line.prototype=Object.create(r.Object3D.prototype),r.Line.prototype.raycast=function(){var e=new r.Matrix4,t=new r.Ray,n=new r.Sphere;return function(i,s){var o=i.linePrecision,u=o*o,a=this.geometry;a.boundingSphere===null&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(this.matrixWorld);if(i.ray.isIntersectionSphere(n)===!1)return;e.getInverse(this.matrixWorld),t.copy(i.ray).applyMatrix4(e);if(a instanceof r.Geometry){var f=a.vertices,l=f.length,c=new r.Vector3,h=new r.Vector3,p=this.type===r.LineStrip?1:2;for(var d=0;d<l-1;d+=p){var v=t.distanceSqToSegment(f[d],f[d+1],h,c);if(v>u)continue;var m=t.origin.distanceTo(h);if(m<i.near||m>i.far)continue;s.push({distance:m,point:c.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}(),r.Line.prototype.clone=function(e){return e===undefined&&(e=new r.Line(this.geometry,this.material,this.type)),r.Object3D.prototype.clone.call(this,e),e},r.Mesh=function(e,t){r.Object3D.call(this),this.geometry=e!==undefined?e:new r.Geometry,this.material=t!==undefined?t:new r.MeshBasicMaterial({color:Math.random()*16777215}),this.updateMorphTargets()},r.Mesh.prototype=Object.create(r.Object3D.prototype),r.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},r.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==undefined?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},r.Mesh.prototype.raycast=function(){var e=new r.Matrix4,t=new r.Ray,n=new r.Sphere,i=new r.Vector3,s=new r.Vector3,o=new r.Vector3;return function(u,a){var f=this.geometry;f.boundingSphere===null&&f.computeBoundingSphere(),n.copy(f.boundingSphere),n.applyMatrix4(this.matrixWorld);if(u.ray.isIntersectionSphere(n)===!1)return;e.getInverse(this.matrixWorld),t.copy(u.ray).applyMatrix4(e);if(f.boundingBox!==null&&t.isIntersectionBox(f.boundingBox)===!1)return;if(f instanceof r.BufferGeometry){var l=this.material;if(l===undefined)return;var c=f.attributes,h,p,d,v=u.precision;if(c.index!==undefined){var m=c.index.array,g=c.position.array,y=f.offsets;y.length===0&&(y=[{start:0,count:m.length,index:0}]);for(var b=0,w=y.length;b<w;++b){var E=y[b].start,S=y[b].count,x=y[b].index;for(var T=E,N=E+S;T<N;T+=3){h=x+m[T],p=x+m[T+1],d=x+m[T+2],i.set(g[h*3],g[h*3+1],g[h*3+2]),s.set(g[p*3],g[p*3+1],g[p*3+2]),o.set(g[d*3],g[d*3+1],g[d*3+2]);if(l.side===r.BackSide)var C=t.intersectTriangle(o,s,i,!0);else var C=t.intersectTriangle(i,s,o,l.side!==r.DoubleSide);if(C===null)continue;C.applyMatrix4(this.matrixWorld);var k=u.ray.origin.distanceTo(C);if(k<v||k<u.near||k>u.far)continue;a.push({distance:k,point:C,indices:[h,p,d],face:null,faceIndex:null,object:this})}}}else{var g=c.position.array;for(var T=0,L=0,N=g.length;T<N;T+=3,L+=9){h=T,p=T+1,d=T+2,i.set(g[L],g[L+1],g[L+2]),s.set(g[L+3],g[L+4],g[L+5]),o.set(g[L+6],g[L+7],g[L+8]);if(l.side===r.BackSide)var C=t.intersectTriangle(o,s,i,!0);else var C=t.intersectTriangle(i,s,o,l.side!==r.DoubleSide);if(C===null)continue;C.applyMatrix4(this.matrixWorld);var k=u.ray.origin.distanceTo(C);if(k<v||k<u.near||k>u.far)continue;a.push({distance:k,point:C,indices:[h,p,d],face:null,faceIndex:null,object:this})}}}else if(f instanceof r.Geometry){var A=this.material instanceof r.MeshFaceMaterial,O=A===!0?this.material.materials:null,h,p,d,M,v=u.precision,_=f.vertices;for(var D=0,P=f.faces.length;D<P;D++){var H=f.faces[D],l=A===!0?O[H.materialIndex]:this.material;if(l===undefined)continue;h=_[H.a],p=_[H.b],d=_[H.c];if(l.morphTargets===!0){var B=f.morphTargets,j=this.morphTargetInfluences;i.set(0,0,0),s.set(0,0,0),o.set(0,0,0);for(var F=0,I=B.length;F<I;F++){var q=j[F];if(q===0)continue;var R=B[F].vertices;i.x+=(R[H.a].x-h.x)*q,i.y+=(R[H.a].y-h.y)*q,i.z+=(R[H.a].z-h.z)*q,s.x+=(R[H.b].x-p.x)*q,s.y+=(R[H.b].y-p.y)*q,s.z+=(R[H.b].z-p.z)*q,o.x+=(R[H.c].x-d.x)*q,o.y+=(R[H.c].y-d.y)*q,o.z+=(R[H.c].z-d.z)*q}i.add(h),s.add(p),o.add(d),h=i,p=s,d=o}if(l.side===r.BackSide)var C=t.intersectTriangle(d,p,h,!0);else var C=t.intersectTriangle(h,p,d,l.side!==r.DoubleSide);if(C===null)continue;C.applyMatrix4(this.matrixWorld);var k=u.ray.origin.distanceTo(C);if(k<v||k<u.near||k>u.far)continue;a.push({distance:k,point:C,face:H,faceIndex:D,object:this})}}}}(),r.Mesh.prototype.clone=function(e,t){return e===undefined&&(e=new r.Mesh(this.geometry,this.material)),r.Object3D.prototype.clone.call(this,e,t),e},r.Bone=function(e){r.Object3D.call(this),this.skin=e,this.accumulatedRotWeight=0,this.accumulatedPosWeight=0,this.accumulatedSclWeight=0},r.Bone.prototype=Object.create(r.Object3D.prototype),r.Bone.prototype.updateMatrixWorld=function(e){r.Object3D.prototype.updateMatrixWorld.call(this,e),this.accumulatedRotWeight=0,this.accumulatedPosWeight=0,this.accumulatedSclWeight=0},r.Skeleton=function(e,t,n){this.useVertexTexture=n!==undefined?n:!0,this.identityMatrix=new r.Matrix4,e=e||[],this.bones=e.slice(0);if(this.useVertexTexture){var i;this.bones.length>256?i=64:this.bones.length>64?i=32:this.bones.length>16?i=16:i=8,this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new r.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,r.RGBAFormat,r.FloatType),this.boneTexture.minFilter=r.NearestFilter,this.boneTexture.magFilter=r.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(t===undefined)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var s=0,o=this.bones.length;s<o;s++)this.boneInverses.push(new r.Matrix4)}},r.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new r.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},r.Skeleton.prototype.pose=function(){var e;for(var t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},r.Skeleton.prototype.update=function(){var e=new r.Matrix4;for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,t*16)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},r.SkinnedMesh=function(e,t,n){r.Mesh.call(this,e,t),this.bindMode="attached",this.bindMatrix=new r.Matrix4,this.bindMatrixInverse=new r.Matrix4;var i=[];if(this.geometry&&this.geometry.bones!==undefined){var s,o,u,a,f;for(var l=0,c=this.geometry.bones.length;l<c;++l)o=this.geometry.bones[l],u=o.pos,a=o.rotq,f=o.scl,s=new r.Bone(this),i.push(s),s.name=o.name,s.position.set(u[0],u[1],u[2]),s.quaternion.set(a[0],a[1],a[2],a[3]),f!==undefined?s.scale.set(f[0],f[1],f[2]):s.scale.set(1,1,1);for(var l=0,c=this.geometry.bones.length;l<c;++l)o=this.geometry.bones[l],o.parent!==-1?i[o.parent].add(i[l]):this.add(i[l])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new r.Skeleton(i,undefined,n))},r.SkinnedMesh.prototype=Object.create(r.Mesh.prototype),r.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,t===undefined&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},r.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},r.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof r.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==Infinity?t.multiplyScalar(n):t.set(1)}},r.SkinnedMesh.prototype.updateMatrixWorld=function(e){r.Mesh.prototype.updateMatrixWorld.call(this,!0),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},r.SkinnedMesh.prototype.clone=function(e){return e===undefined&&(e=new r.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),r.Mesh.prototype.clone.call(this,e),e},r.MorphAnimMesh=function(e,t){r.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},r.MorphAnimMesh.prototype=Object.create(r.Mesh.prototype),r.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},r.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},r.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},r.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});var t,n=e.animations,r=/([a-z]+)_?(\d+)/;for(var i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i],u=o.name.match(r);if(u&&u.length>1){var a=u[1],f=u[2];n[a]||(n[a]={start:Infinity,end:-Infinity});var l=n[a];i<l.start&&(l.start=i),i>l.end&&(l.end=i),t||(t=a)}}e.firstAnimation=t},r.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},r.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},r.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)}else this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration);var n=this.startKeyframe+r.Math.clamp(Math.floor(this.time/t),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},r.MorphAnimMesh.prototype.interpolateTargets=function(e,t,n){var r=this.morphTargetInfluences;for(var i=0,s=r.length;i<s;i++)r[i]=0;e>-1&&(r[e]=1-n),t>-1&&(r[t]=n)},r.MorphAnimMesh.prototype.clone=function(e){return e===undefined&&(e=new r.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,r.Mesh.prototype.clone.call(this,e),e},r.LOD=function(){r.Object3D.call(this),this.objects=[]},r.LOD.prototype=Object.create(r.Object3D.prototype),r.LOD.prototype.addLevel=function(e,t){t===undefined&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length;n++)if(t<this.objects[n].distance)break;this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},r.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n;t++)if(e<this.objects[t].distance)break;return this.objects[t-1].object},r.LOD.prototype.raycast=function(){var e=new r.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,n)}}(),r.LOD.prototype.update=function(){var e=new r.Vector3,t=new r.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);this.objects[0].object.visible=!0;for(var i=1,s=this.objects.length;i<s;i++){if(!(r>=this.objects[i].distance))break;this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0}for(;i<s;i++)this.objects[i].object.visible=!1}}}(),r.LOD.prototype.clone=function(e){e===undefined&&(e=new r.LOD),r.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var i=this.objects[t].object.clone();i.visible=t===0,e.addLevel(i,this.objects[t].distance)}return e},r.Sprite=function(){var e=new Float32Array([-0.5,-0.5,0,.5,-0.5,0,.5,.5,0]),t=new r.BufferGeometry;return t.addAttribute("position",new r.BufferAttribute(e,3)),function(e){r.Object3D.call(this),this.geometry=t,this.material=e!==undefined?e:new r.SpriteMaterial}}(),r.Sprite.prototype=Object.create(r.Object3D.prototype),r.Sprite.prototype.raycast=function(){var e=new r.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceToPoint(e);if(r>this.scale.x)return;n.push({distance:r,point:this.position,face:null,object:this})}}(),r.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},r.Sprite.prototype.clone=function(e){return e===undefined&&(e=new r.Sprite(this.material)),r.Object3D.prototype.clone.call(this,e),e},r.Particle=r.Sprite,r.Scene=function(){r.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},r.Scene.prototype=Object.create(r.Object3D.prototype),r.Scene.prototype.__addObject=function(e){if(e instanceof r.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e),e.target&&e.target.parent===undefined&&this.add(e.target);else if(!(e instanceof r.Camera||e instanceof r.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}this.dispatchEvent({type:"objectAdded",object:e}),e.dispatchEvent({type:"addedToScene",scene:this});for(var n=0;n<e.children.length;n++)this.__addObject(e.children[n])},r.Scene.prototype.__removeObject=function(e){if(e instanceof r.Light){var t=this.__lights.indexOf(e);t!==-1&&this.__lights.splice(t,1);if(e.shadowCascadeArray)for(var n=0;n<e.shadowCascadeArray.length;n++)this.__removeObject(e.shadowCascadeArray[n])}else if(!(e instanceof r.Camera)){this.__objectsRemoved.push(e);var t=this.__objectsAdded.indexOf(e);t!==-1&&this.__objectsAdded.splice(t,1)}this.dispatchEvent({type:"objectRemoved",object:e}),e.dispatchEvent({type:"removedFromScene",scene:this});for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},r.Scene.prototype.clone=function(e){return e===undefined&&(e=new r.Scene),r.Object3D.prototype.clone.call(this,e),this.fog!==null&&(e.fog=this.fog.clone()),this.overrideMaterial!==null&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},r.Fog=function(e,t,n){this.name="",this.color=new r.Color(e),this.near=t!==undefined?t:1,this.far=n!==undefined?n:1e3},r.Fog.prototype.clone=function(){return new r.Fog(this.color.getHex(),this.near,this.far)},r.FogExp2=function(e,t){this.name="",this.color=new r.Color(e),this.density=t!==undefined?t:25e-5},r.FogExp2.prototype.clone=function(){return new r.FogExp2(this.color.getHex(),this.density)},r.CanvasRenderer=function(e){function wt(){pt.setRGB(0,0,0),dt.setRGB(0,0,0),vt.setRGB(0,0,0);for(var e=0,t=o.length;e<t;e++){var n=o[e],i=n.color;n instanceof r.AmbientLight?pt.add(i):n instanceof r.DirectionalLight?dt.add(i):n instanceof r.PointLight&&vt.add(i)}}function Et(e,t,n){for(var i=0,s=o.length;i<s;i++){var u=o[i];et.copy(u.color);if(u instanceof r.DirectionalLight){var a=mt.setFromMatrixPosition(u.matrixWorld).normalize(),f=t.dot(a);if(f<=0)continue;f*=u.intensity,n.add(et.multiplyScalar(f))}else if(u instanceof r.PointLight){var a=mt.setFromMatrixPosition(u.matrixWorld),f=t.dot(mt.subVectors(a,e).normalize());if(f<=0)continue;f*=u.distance==0?1:1-Math.min(e.distanceTo(a)/u.distance,1);if(f==0)continue;f*=u.intensity,n.add(et.multiplyScalar(f))}}}function St(e,t,n){Dt(n.opacity),Pt(n.blending);var i=t.scale.x*c,s=t.scale.y*h,o=.5*Math.sqrt(i*i+s*s);ht.min.set(e.x-o,e.y-o),ht.max.set(e.x+o,e.y+o);if(n instanceof r.SpriteMaterial){var u=n.map;if(u!==null&&u.image!==undefined){u.hasEventListener("update",Lt)===!1&&(u.image.width>0&&At(u),u.addEventListener("update",Lt));var a=tt[u.id];a!==undefined?It(a):It("rgba( 0, 0, 0, 1 )");var f=u.image,l=f.width*u.offset.x,p=f.height*u.offset.y,d=f.width*u.repeat.x,v=f.height*u.repeat.y,m=i/d,y=s/v;g.save(),g.translate(e.x,e.y),n.rotation!==0&&g.rotate(n.rotation),g.translate(-i/2,-s/2),g.scale(m,y),g.translate(-l,-p),g.fillRect(l,p,d,v),g.restore()}else It(n.color.getStyle()),g.save(),g.translate(e.x,e.y),n.rotation!==0&&g.rotate(n.rotation),g.scale(i,-s),g.fillRect(-0.5,-0.5,1,1),g.restore()}else n instanceof r.SpriteCanvasMaterial&&(Ft(n.color.getStyle()),It(n.color.getStyle()),g.save(),g.translate(e.x,e.y),n.rotation!==0&&g.rotate(n.rotation),g.scale(i,s),n.program(g),g.restore())}function xt(e,t,n,i){Dt(i.opacity),Pt(i.blending),g.beginPath(),g.moveTo(e.positionScreen.x,e.positionScreen.y),g.lineTo(t.positionScreen.x,t.positionScreen.y);if(i instanceof r.LineBasicMaterial){Ht(i.linewidth),Bt(i.linecap),jt(i.linejoin);if(i.vertexColors!==r.VertexColors)Ft(i.color.getStyle());else{var s=n.vertexColors[0].getStyle(),o=n.vertexColors[1].getStyle();if(s===o)Ft(s);else{try{var u=g.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);u.addColorStop(0,s),u.addColorStop(1,o)}catch(a){u=s}Ft(u)}}g.stroke(),ht.expandByScalar(i.linewidth*2)}else i instanceof r.LineDashedMaterial&&(Ht(i.linewidth),Bt(i.linecap),jt(i.linejoin),Ft(i.color.getStyle()),qt([i.dashSize,i.gapSize]),g.stroke(),ht.expandByScalar(i.linewidth*2),qt([]))}function Tt(e,i,s,o,u,a,f,l){n.info.render.vertices+=3,n.info.render.faces++,Dt(l.opacity),Pt(l.blending),H=e.positionScreen.x,B=e.positionScreen.y,j=i.positionScreen.x,F=i.positionScreen.y,I=s.positionScreen.x,q=s.positionScreen.y,Nt(H,B,j,F,I,q),(l instanceof r.MeshLambertMaterial||l instanceof r.MeshPhongMaterial)&&l.map===null?(Y.copy(l.color),Z.copy(l.emissive),l.vertexColors===r.FaceColors&&Y.multiply(f.color),$.copy(pt),gt.copy(e.positionWorld).add(i.positionWorld).add(s.positionWorld).divideScalar(3),Et(gt,f.normalModel,$),$.multiply(Y).add(Z),l.wireframe===!0?Ct($,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):kt($)):l instanceof r.MeshBasicMaterial||l instanceof r.MeshLambertMaterial||l instanceof r.MeshPhongMaterial?l.map!==null?l.map.mapping instanceof r.UVMapping&&(rt=f.uvs,Ot(H,B,j,F,I,q,rt[o].x,rt[o].y,rt[u].x,rt[u].y,rt[a].x,rt[a].y,l.map)):l.envMap!==null?l.envMap.mapping instanceof r.SphericalReflectionMapping?(yt.copy(f.vertexNormalsModel[o]).applyMatrix3(bt),it=.5*yt.x+.5,st=.5*yt.y+.5,yt.copy(f.vertexNormalsModel[u]).applyMatrix3(bt),ot=.5*yt.x+.5,ut=.5*yt.y+.5,yt.copy(f.vertexNormalsModel[a]).applyMatrix3(bt),at=.5*yt.x+.5,ft=.5*yt.y+.5,Ot(H,B,j,F,I,q,it,st,ot,ut,at,ft,l.envMap)):l.envMap.mapping instanceof r.SphericalRefractionMapping&&(yt.copy(f.vertexNormalsModel[o]).applyMatrix3(bt),it=-0.5*yt.x+.5,st=-0.5*yt.y+.5,yt.copy(f.vertexNormalsModel[u]).applyMatrix3(bt),ot=-0.5*yt.x+.5,ut=-0.5*yt.y+.5,yt.copy(f.vertexNormalsModel[a]).applyMatrix3(bt),at=-0.5*yt.x+.5,ft=-0.5*yt.y+.5,Ot(H,B,j,F,I,q,it,st,ot,ut,at,ft,l.envMap)):($.copy(l.color),l.vertexColors===r.FaceColors&&$.multiply(f.color),l.wireframe===!0?Ct($,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):kt($)):l instanceof r.MeshDepthMaterial?($.r=$.g=$.b=1-t(e.positionScreen.z*e.positionScreen.w,L.near,L.far),l.wireframe===!0?Ct($,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):kt($)):l instanceof r.MeshNormalMaterial?(yt.copy(f.normalModel).applyMatrix3(bt),$.setRGB(yt.x,yt.y,yt.z).multiplyScalar(.5).addScalar(.5),l.wireframe===!0?Ct($,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):kt($)):($.setRGB(1,1,1),l.wireframe===!0?Ct($,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):kt($))}function Nt(e,t,n,r,i,s){g.beginPath(),g.moveTo(e,t),g.lineTo(n,r),g.lineTo(i,s),g.closePath()}function Ct(e,t,n,r){Ht(t),Bt(n),jt(r),Ft(e.getStyle()),g.stroke(),ht.expandByScalar(t*2)}function kt(e){It(e.getStyle()),g.fill()}function Lt(e){At(e.target)}function At(e){if(e instanceof r.CompressedTexture)return;var t=e.wrapS===r.RepeatWrapping,n=e.wrapT===r.RepeatWrapping,i=e.image,s=document.createElement("canvas");s.width=i.width,s.height=i.height;var o=s.getContext("2d");o.setTransform(1,0,0,-1,0,i.height),o.drawImage(i,0,0),tt[e.id]=g.createPattern(s,t===!0&&n===!0?"repeat":t===!0&&n===!1?"repeat-x":t===!1&&n===!0?"repeat-y":"no-repeat")}function Ot(e,t,n,i,s,o,u,a,f,l,c,h,p){if(p instanceof r.DataTexture)return;p.hasEventListener("update",Lt)===!1&&(p.image!==undefined&&p.image.width>0&&At(p),p.addEventListener("update",Lt));var d=tt[p.id];if(d===undefined){It("rgba(0,0,0,1)"),g.fill();return}It(d);var v,m,y,b,w,E,S,x,T=p.offset.x/p.repeat.x,N=p.offset.y/p.repeat.y,C=p.image.width*p.repeat.x,k=p.image.height*p.repeat.y;u=(u+T)*C,a=(a+N)*k,f=(f+T)*C,l=(l+N)*k,c=(c+T)*C,h=(h+N)*k,n-=e,i-=t,s-=e,o-=t,f-=u,l-=a,c-=u,h-=a,S=f*h-c*l;if(S===0)return;x=1/S,v=(h*n-l*s)*x,m=(h*i-l*o)*x,y=(f*s-c*n)*x,b=(f*o-c*i)*x,w=e-v*u-y*a,E=t-m*u-b*a,g.save(),g.transform(v,m,y,b,w,E),g.fill(),g.restore()}function Mt(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d,v,m,y,b,w,E,S=h.width-1,x=h.height-1;o*=S,u*=x,a*=S,f*=x,l*=S,c*=x,n-=e,r-=t,i-=e,s-=t,a-=o,f-=u,l-=o,c-=u,w=a*c-l*f,E=1/w,p=(c*n-f*i)*E,d=(c*r-f*s)*E,v=(a*i-l*n)*E,m=(a*s-l*r)*E,y=e-p*o-v*u,b=t-d*o-m*u,g.save(),g.transform(p,d,v,m,y,b),g.clip(),g.drawImage(h,0,0),g.restore()}function _t(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=r*r+i*i,o;if(s===0)return;o=n/Math.sqrt(s),r*=o,i*=o,t.x+=r,t.y+=i,e.x-=r,e.y-=i}function Dt(e){w!==e&&(g.globalAlpha=e,w=e)}function Pt(e){E!==e&&(e===r.NormalBlending?g.globalCompositeOperation="source-over":e===r.AdditiveBlending?g.globalCompositeOperation="lighter":e===r.SubtractiveBlending&&(g.globalCompositeOperation="darker"),E=e)}function Ht(e){T!==e&&(g.lineWidth=e,T=e)}function Bt(e){N!==e&&(g.lineCap=e,N=e)}function jt(e){C!==e&&(g.lineJoin=e,C=e)}function Ft(e){S!==e&&(g.strokeStyle=e,S=e)}function It(e){x!==e&&(g.fillStyle=e,x=e)}function qt(e){k.length!==e.length&&(g.setLineDash(e),k=e)}console.log("THREE.CanvasRenderer",r.REVISION);var t=r.Math.smoothstep;e=e||{};var n=this,i,s,o,u=new r.Projector,a=e.canvas!==undefined?e.canvas:document.createElement("canvas"),f=a.width,l=a.height,c=Math.floor(f/2),h=Math.floor(l/2),p=0,d=0,v=f,m=l,g=a.getContext("2d",{alpha:e.alpha===!0}),y=new r.Color(0),b=0,w=1,E=0,S=null,x=null,T=null,N=null,C=null,k=[],L,A,O,M,_,D=new r.RenderableVertex,P=new r.RenderableVertex,H,B,j,F,I,q,R,U,z,W,X,V,$=new r.Color,J=new r.Color,K=new r.Color,Q=new r.Color,G=new r.Color,Y=new r.Color,Z=new r.Color,et=new r.Color,tt={},nt,rt,it,st,ot,ut,at,ft,lt=new r.Box2,ct=new r.Box2,ht=new r.Box2,pt=new r.Color,dt=new r.Color,vt=new r.Color,mt=new r.Vector3,gt=new r.Vector3,yt=new r.Vector3,bt=new r.Matrix3;g.setLineDash===undefined&&(g.setLineDash=function(){}),this.domElement=a,this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,n){f=e*this.devicePixelRatio,l=t*this.devicePixelRatio,a.width=f,a.height=l,c=Math.floor(f/2),h=Math.floor(l/2),n!==!1&&(a.style.width=e+"px",a.style.height=t+"px"),lt.min.set(-c,-h),lt.max.set(c,h),ct.min.set(-c,-h),ct.max.set(c,h),w=1,E=0,S=null,x=null,T=null,N=null,C=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){p=e*this.devicePixelRatio,d=t*this.devicePixelRatio,v=n*this.devicePixelRatio,m=r*this.devicePixelRatio},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){y.set(e),b=t!==undefined?t:1,ct.min.set(-c,-h),ct.max.set(c,h)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return y},this.getClearAlpha=function(){return b},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ct.empty()===!1&&(ct.intersect(lt),ct.expandByScalar(2),ct.min.x=ct.min.x+c,ct.min.y=-ct.min.y+h,ct.max.x=ct.max.x+c,ct.max.y=-ct.max.y+h,b<1&&g.clearRect(ct.min.x|0,ct.min.y|0,ct.max.x-ct.min.x|0,ct.max.y-ct.min.y|0),b>0&&(Pt(r.NormalBlending),Dt(1),It("rgba("+Math.floor(y.r*255)+","+Math.floor(y.g*255)+","+Math.floor(y.b*255)+","+b+")"),g.fillRect(ct.min.x|0,ct.min.y|0,ct.max.x-ct.min.x|0,ct.max.y-ct.min.y|0)),ct.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof r.Camera==0){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}this.autoClear===!0&&this.clear(),n.info.render.vertices=0,n.info.render.faces=0,g.setTransform(v/f,0,0,-m/l,p,l-d),g.translate(c,h),i=u.projectScene(e,t,this.sortObjects,this.sortElements),s=i.elements,o=i.lights,L=t,bt.getNormalMatrix(t.matrixWorldInverse),wt();for(var a=0,y=s.length;a<y;a++){var b=s[a],w=b.material;if(w===undefined||w.opacity===0)continue;ht.makeEmpty();if(b instanceof r.RenderableSprite)A=b,A.x*=c,A.y*=h,St(A,b,w);else if(b instanceof r.RenderableLine)A=b.v1,O=b.v2,A.positionScreen.x*=c,A.positionScreen.y*=h,O.positionScreen.x*=c,O.positionScreen.y*=h,ht.setFromPoints([A.positionScreen,O.positionScreen]),lt.isIntersectionBox(ht)===!0&&xt(A,O,b,w);else if(b instanceof r.RenderableFace){A=b.v1,O=b.v2,M=b.v3;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;if(O.positionScreen.z<-1||O.positionScreen.z>1)continue;if(M.positionScreen.z<-1||M.positionScreen.z>1)continue;A.positionScreen.x*=c,A.positionScreen.y*=h,O.positionScreen.x*=c,O.positionScreen.y*=h,M.positionScreen.x*=c,M.positionScreen.y*=h,w.overdraw>0&&(_t(A.positionScreen,O.positionScreen,w.overdraw),_t(O.positionScreen,M.positionScreen,w.overdraw),_t(M.positionScreen,A.positionScreen,w.overdraw)),ht.setFromPoints([A.positionScreen,O.positionScreen,M.positionScreen]),lt.isIntersectionBox(ht)===!0&&Tt(A,O,M,0,1,2,b,w)}ct.union(ht)}g.setTransform(1,0,0,1,0,0)}},r.ShaderChunk={},r.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n",r.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif",r.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",r.ShaderChunk.default_vertex="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;",r.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",r.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n",r.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",r.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif",r.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif",r.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",r.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif",r.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif",r.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",r.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",r.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",r.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif",r.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",r.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif",r.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif",r.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif",r.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif",r.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",r.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif",r.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",r.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n",r.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif",r.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",r.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n",r.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",r.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#else\n\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		cubeColor.xyz *= cubeColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif",r.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",r.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",r.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",r.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",r.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif",r.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif",r.ShaderChunk.defaultnormal_vertex="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;",r.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",r.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",r.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",r.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif",r.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",r.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif",r.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif",r.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif",r.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n",r.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif",r.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",r.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",r.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif",r.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",r.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",r.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r)i[n]=r[n]}return i},clone:function(e){var t,n,i,s,o={};for(t in e){o[t]={};for(n in e[t])s=e[t][n],s instanceof r.Color||s instanceof r.Vector2||s instanceof r.Vector3||s instanceof r.Vector4||s instanceof r.Matrix4||s instanceof r.Texture?o[t][n]=s.clone():s instanceof Array?o[t][n]=s.slice():o[t][n]=s}return o}},r.UniformsLib={common:{diffuse:{type:"c",value:new r.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new r.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new r.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new r.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new r.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new r.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},r.ShaderLib={basic:{uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.shadowmap]),vertexShader:[r.ShaderChunk.map_pars_vertex,r.ShaderChunk.lightmap_pars_vertex,r.ShaderChunk.envmap_pars_vertex,r.ShaderChunk.color_pars_vertex,r.ShaderChunk.morphtarget_pars_vertex,r.ShaderChunk.skinning_pars_vertex,r.ShaderChunk.shadowmap_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.map_vertex,r.ShaderChunk.lightmap_vertex,r.ShaderChunk.color_vertex,r.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",r.ShaderChunk.morphnormal_vertex,r.ShaderChunk.skinnormal_vertex,r.ShaderChunk.defaultnormal_vertex,"	#endif",r.ShaderChunk.morphtarget_vertex,r.ShaderChunk.skinning_vertex,r.ShaderChunk.default_vertex,r.ShaderChunk.logdepthbuf_vertex,r.ShaderChunk.worldpos_vertex,r.ShaderChunk.envmap_vertex,r.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",r.ShaderChunk.color_pars_fragment,r.ShaderChunk.map_pars_fragment,r.ShaderChunk.alphamap_pars_fragment,r.ShaderChunk.lightmap_pars_fragment,r.ShaderChunk.envmap_pars_fragment,r.ShaderChunk.fog_pars_fragment,r.ShaderChunk.shadowmap_pars_fragment,r.ShaderChunk.specularmap_pars_fragment,r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( diffuse, opacity );",r.ShaderChunk.logdepthbuf_fragment,r.ShaderChunk.map_fragment,r.ShaderChunk.alphamap_fragment,r.ShaderChunk.alphatest_fragment,r.ShaderChunk.specularmap_fragment,r.ShaderChunk.lightmap_fragment,r.ShaderChunk.color_fragment,r.ShaderChunk.envmap_fragment,r.ShaderChunk.shadowmap_fragment,r.ShaderChunk.linear_to_gamma_fragment,r.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.lights,r.UniformsLib.shadowmap,{ambient:{type:"c",value:new r.Color(16777215)},emissive:{type:"c",value:new r.Color(0)},wrapRGB:{type:"v3",value:new r.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",r.ShaderChunk.map_pars_vertex,r.ShaderChunk.lightmap_pars_vertex,r.ShaderChunk.envmap_pars_vertex,r.ShaderChunk.lights_lambert_pars_vertex,r.ShaderChunk.color_pars_vertex,r.ShaderChunk.morphtarget_pars_vertex,r.ShaderChunk.skinning_pars_vertex,r.ShaderChunk.shadowmap_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.map_vertex,r.ShaderChunk.lightmap_vertex,r.ShaderChunk.color_vertex,r.ShaderChunk.morphnormal_vertex,r.ShaderChunk.skinbase_vertex,r.ShaderChunk.skinnormal_vertex,r.ShaderChunk.defaultnormal_vertex,r.ShaderChunk.morphtarget_vertex,r.ShaderChunk.skinning_vertex,r.ShaderChunk.default_vertex,r.ShaderChunk.logdepthbuf_vertex,r.ShaderChunk.worldpos_vertex,r.ShaderChunk.envmap_vertex,r.ShaderChunk.lights_lambert_vertex,r.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",r.ShaderChunk.color_pars_fragment,r.ShaderChunk.map_pars_fragment,r.ShaderChunk.alphamap_pars_fragment,r.ShaderChunk.lightmap_pars_fragment,r.ShaderChunk.envmap_pars_fragment,r.ShaderChunk.fog_pars_fragment,r.ShaderChunk.shadowmap_pars_fragment,r.ShaderChunk.specularmap_pars_fragment,r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",r.ShaderChunk.logdepthbuf_fragment,r.ShaderChunk.map_fragment,r.ShaderChunk.alphamap_fragment,r.ShaderChunk.alphatest_fragment,r.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",r.ShaderChunk.lightmap_fragment,r.ShaderChunk.color_fragment,r.ShaderChunk.envmap_fragment,r.ShaderChunk.shadowmap_fragment,r.ShaderChunk.linear_to_gamma_fragment,r.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.bump,r.UniformsLib.normalmap,r.UniformsLib.fog,r.UniformsLib.lights,r.UniformsLib.shadowmap,{ambient:{type:"c",value:new r.Color(16777215)},emissive:{type:"c",value:new r.Color(0)},specular:{type:"c",value:new r.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new r.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",r.ShaderChunk.map_pars_vertex,r.ShaderChunk.lightmap_pars_vertex,r.ShaderChunk.envmap_pars_vertex,r.ShaderChunk.lights_phong_pars_vertex,r.ShaderChunk.color_pars_vertex,r.ShaderChunk.morphtarget_pars_vertex,r.ShaderChunk.skinning_pars_vertex,r.ShaderChunk.shadowmap_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.map_vertex,r.ShaderChunk.lightmap_vertex,r.ShaderChunk.color_vertex,r.ShaderChunk.morphnormal_vertex,r.ShaderChunk.skinbase_vertex,r.ShaderChunk.skinnormal_vertex,r.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",r.ShaderChunk.morphtarget_vertex,r.ShaderChunk.skinning_vertex,r.ShaderChunk.default_vertex,r.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",r.ShaderChunk.worldpos_vertex,r.ShaderChunk.envmap_vertex,r.ShaderChunk.lights_phong_vertex,r.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",r.ShaderChunk.color_pars_fragment,r.ShaderChunk.map_pars_fragment,r.ShaderChunk.alphamap_pars_fragment,r.ShaderChunk.lightmap_pars_fragment,r.ShaderChunk.envmap_pars_fragment,r.ShaderChunk.fog_pars_fragment,r.ShaderChunk.lights_phong_pars_fragment,r.ShaderChunk.shadowmap_pars_fragment,r.ShaderChunk.bumpmap_pars_fragment,r.ShaderChunk.normalmap_pars_fragment,r.ShaderChunk.specularmap_pars_fragment,r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",r.ShaderChunk.logdepthbuf_fragment,r.ShaderChunk.map_fragment,r.ShaderChunk.alphamap_fragment,r.ShaderChunk.alphatest_fragment,r.ShaderChunk.specularmap_fragment,r.ShaderChunk.lights_phong_fragment,r.ShaderChunk.lightmap_fragment,r.ShaderChunk.color_fragment,r.ShaderChunk.envmap_fragment,r.ShaderChunk.shadowmap_fragment,r.ShaderChunk.linear_to_gamma_fragment,r.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:r.UniformsUtils.merge([r.UniformsLib.particle,r.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",r.ShaderChunk.color_pars_vertex,r.ShaderChunk.shadowmap_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",r.ShaderChunk.logdepthbuf_vertex,r.ShaderChunk.worldpos_vertex,r.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",r.ShaderChunk.color_pars_fragment,r.ShaderChunk.map_particle_pars_fragment,r.ShaderChunk.fog_pars_fragment,r.ShaderChunk.shadowmap_pars_fragment,r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( psColor, opacity );",r.ShaderChunk.logdepthbuf_fragment,r.ShaderChunk.map_particle_fragment,r.ShaderChunk.alphatest_fragment,r.ShaderChunk.color_fragment,r.ShaderChunk.shadowmap_fragment,r.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",r.ShaderChunk.color_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",r.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",r.ShaderChunk.color_pars_fragment,r.ShaderChunk.fog_pars_fragment,r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",r.ShaderChunk.logdepthbuf_fragment,r.ShaderChunk.color_fragment,r.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[r.ShaderChunk.morphtarget_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.morphtarget_vertex,r.ShaderChunk.default_vertex,r.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",r.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",r.ShaderChunk.morphtarget_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",r.ShaderChunk.morphtarget_vertex,r.ShaderChunk.default_vertex,r.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",r.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:r.UniformsUtils.merge([r.UniformsLib.fog,r.UniformsLib.lights,r.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new r.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new r.Color(16777215)},specular:{type:"c",value:new r.Color(1118481)},ambient:{type:"c",value:new r.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new r.Vector2(0,0)},uRepeat:{type:"v2",value:new r.Vector2(1,1)},wrapRGB:{type:"v3",value:new r.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","	uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",r.ShaderChunk.shadowmap_pars_fragment,r.ShaderChunk.fog_pars_fragment,r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",r.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );","	vec3 specularTex = vec3( 1.0 );","	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= uNormalScale;","	normalTex = normalize( normalTex );","	if( enableDiffuse ) {","		#ifdef GAMMA_INPUT","			vec4 texelColor = texture2D( tDiffuse, vUv );","			texelColor.xyz *= texelColor.xyz;","			gl_FragColor = gl_FragColor * texelColor;","		#else","			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","		#endif","	}","	if( enableAO ) {","		#ifdef GAMMA_INPUT","			vec4 aoColor = texture2D( tAO, vUv );","			aoColor.xyz *= aoColor.xyz;","			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","		#else","			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","		#endif","	}",r.ShaderChunk.alphatest_fragment,"	if( enableSpecular )","		specularTex = texture2D( tSpecular, vUv ).xyz;","	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","	vec3 finalNormal = tsb * normalTex;","	#ifdef FLIP_SIDED","		finalNormal = -finalNormal;","	#endif","	vec3 normal = normalize( finalNormal );","	vec3 viewPosition = normalize( vViewPosition );","	#if MAX_POINT_LIGHTS > 0","		vec3 pointDiffuse = vec3( 0.0 );","		vec3 pointSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","			float pointDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 )","				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","			pointVector = normalize( pointVector );","			#ifdef WRAP_AROUND","				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","			#else","				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","			#endif","			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","			vec3 pointHalfVector = normalize( pointVector + viewPosition );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		vec3 spotDiffuse = vec3( 0.0 );","		vec3 spotSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","			float spotDistance = 1.0;","			if ( spotLightDistance[ i ] > 0.0 )","				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","			spotVector = normalize( spotVector );","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","				#ifdef WRAP_AROUND","					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","				#else","					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","				#endif","				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","				vec3 spotHalfVector = normalize( spotVector + viewPosition );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0 ) / 8.0;","				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_DIR_LIGHTS > 0","		vec3 dirDiffuse = vec3( 0.0 );","		vec3 dirSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			#ifdef WRAP_AROUND","				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","			#else","				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","			#endif","			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","			vec3 dirHalfVector = normalize( dirVector + viewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		vec3 hemiDiffuse = vec3( 0.0 );","		vec3 hemiSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","			hemiDiffuse += diffuse * hemiColor;","			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","			vec3 lVectorGround = -lVector;","			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","			float dotProductGround = dot( normal, lVectorGround );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","		}","	#endif","	vec3 totalDiffuse = vec3( 0.0 );","	vec3 totalSpecular = vec3( 0.0 );","	#if MAX_DIR_LIGHTS > 0","		totalDiffuse += dirDiffuse;","		totalSpecular += dirSpecular;","	#endif","	#if MAX_HEMI_LIGHTS > 0","		totalDiffuse += hemiDiffuse;","		totalSpecular += hemiSpecular;","	#endif","	#if MAX_POINT_LIGHTS > 0","		totalDiffuse += pointDiffuse;","		totalSpecular += pointSpecular;","	#endif","	#if MAX_SPOT_LIGHTS > 0","		totalDiffuse += spotDiffuse;","		totalSpecular += spotSpecular;","	#endif","	#ifdef METAL","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","	#else","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","	#endif","	if ( enableReflection ) {","		vec3 vReflect;","		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","		if ( useRefract ) {","			vReflect = refract( cameraToVertex, normal, refractionRatio );","		} else {","			vReflect = reflect( cameraToVertex, normal );","		}","		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","		#ifdef GAMMA_INPUT","			cubeColor.xyz *= cubeColor.xyz;","		#endif","		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","	}",r.ShaderChunk.shadowmap_fragment,r.ShaderChunk.linear_to_gamma_fragment,r.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","	uniform sampler2D tDisplacement;","	uniform float uDisplacementScale;","	uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",r.ShaderChunk.skinning_pars_vertex,r.ShaderChunk.shadowmap_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.skinbase_vertex,r.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING","		vNormal = normalize( normalMatrix * skinnedNormal.xyz );","		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * skinnedTangent.xyz );","	#else","		vNormal = normalize( normalMatrix * normal );","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	vUv = uv * uRepeat + uOffset;","	vec3 displacedPosition;","	#ifdef VERTEX_TEXTURES","		if ( enableDisplacement ) {","			vec3 dv = texture2D( tDisplacement, uv ).xyz;","			float df = uDisplacementScale * dv.x + uDisplacementBias;","			displacedPosition = position + normalize( normal ) * df;","		} else {","			#ifdef USE_SKINNING","				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","				vec4 skinned = vec4( 0.0 );","				skinned += boneMatX * skinVertex * skinWeight.x;","				skinned += boneMatY * skinVertex * skinWeight.y;","				skinned += boneMatZ * skinVertex * skinWeight.z;","				skinned += boneMatW * skinVertex * skinWeight.w;","				skinned  = bindMatrixInverse * skinned;","				displacedPosition = skinned.xyz;","			#else","				displacedPosition = position;","			#endif","		}","	#else","		#ifdef USE_SKINNING","			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","			vec4 skinned = vec4( 0.0 );","			skinned += boneMatX * skinVertex * skinWeight.x;","			skinned += boneMatY * skinVertex * skinWeight.y;","			skinned += boneMatZ * skinVertex * skinWeight.z;","			skinned += boneMatW * skinVertex * skinWeight.w;","			skinned  = bindMatrixInverse * skinned;","			displacedPosition = skinned.xyz;","		#else","			displacedPosition = position;","		#endif","	#endif","	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",r.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	#ifdef USE_SHADOWMAP","		for( int i = 0; i < MAX_SHADOWS; i ++ ) {","			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","		}","	#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",r.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",r.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",r.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[r.ShaderChunk.morphtarget_pars_vertex,r.ShaderChunk.skinning_pars_vertex,r.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",r.ShaderChunk.skinbase_vertex,r.ShaderChunk.morphtarget_vertex,r.ShaderChunk.skinning_vertex,r.ShaderChunk.default_vertex,r.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[r.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",r.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}},r.WebGLRenderer=function(e){function Et(e){e.__webglVertexBuffer=G.createBuffer(),e.__webglColorBuffer=G.createBuffer(),m.info.memory.geometries++}function St(e){e.__webglVertexBuffer=G.createBuffer(),e.__webglColorBuffer=G.createBuffer(),e.__webglLineDistanceBuffer=G.createBuffer(),m.info.memory.geometries++}function xt(e){e.__webglVertexBuffer=G.createBuffer(),e.__webglNormalBuffer=G.createBuffer(),e.__webglTangentBuffer=G.createBuffer(),e.__webglColorBuffer=G.createBuffer(),e.__webglUVBuffer=G.createBuffer(),e.__webglUV2Buffer=G.createBuffer(),e.__webglSkinIndicesBuffer=G.createBuffer(),e.__webglSkinWeightsBuffer=G.createBuffer(),e.__webglFaceBuffer=G.createBuffer(),e.__webglLineBuffer=G.createBuffer();var t,n;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,n=e.numMorphTargets;t<n;t++)e.__webglMorphTargetsBuffers.push(G.createBuffer())}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,n=e.numMorphNormals;t<n;t++)e.__webglMorphNormalsBuffers.push(G.createBuffer())}m.info.memory.geometries++}function Dt(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){e.__webglCustomAttributesList===undefined&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;s.type==="v2"?o=2:s.type==="v3"?o=3:s.type==="v4"?o=4:s.type==="c"&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=G.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function Pt(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3),e.__colorArray=new Float32Array(n*3),e.__sortArray=[],e.__webglParticleCount=n,Dt(e,t)}function Ht(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3),e.__colorArray=new Float32Array(n*3),e.__lineDistanceArray=new Float32Array(n*1),e.__webglLineCount=n,Dt(e,t)}function Bt(e,t){var n=t.geometry,r=e.faces3,i=r.length*3,s=r.length*1,o=r.length*3,u=jt(t,e),a=Rt(u),f=It(u),l=qt(u);e.__vertexArray=new Float32Array(i*3),f&&(e.__normalArray=new Float32Array(i*3)),n.hasTangents&&(e.__tangentArray=new Float32Array(i*4)),l&&(e.__colorArray=new Float32Array(i*3)),a&&(n.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(i*2)),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(i*2))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(i*4),e.__skinWeightArray=new Float32Array(i*4));var c=rt!==null&&s>21845?Uint32Array:Uint16Array;e.__typeArray=c,e.__faceArray=new c(s*3),e.__lineArray=new c(o*2);var h,p;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(h=0,p=e.numMorphTargets;h<p;h++)e.__morphTargetsArrays.push(new Float32Array(i*3))}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(h=0,p=e.numMorphNormals;h<p;h++)e.__morphNormalsArrays.push(new Float32Array(i*3))}e.__webglFaceCount=s*3,e.__webglLineCount=o*2;if(u.attributes){e.__webglCustomAttributesList===undefined&&(e.__webglCustomAttributesList=[]);for(var d in u.attributes){var v=u.attributes[d],m={};for(var g in v)m[g]=v[g];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var y=1;m.type==="v2"?y=2:m.type==="v3"?y=3:m.type==="v4"?y=4:m.type==="c"&&(y=3),m.size=y,m.array=new Float32Array(i*y),m.buffer=G.createBuffer(),m.buffer.belongsToAttribute=d,v.needsUpdate=!0,m.__original=v}e.__webglCustomAttributesList.push(m)}}e.__inittedArrays=!0}function jt(e,t){return e.material instanceof r.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Ft(e){return e&&e.shading!==undefined&&e.shading===r.SmoothShading}function It(e){return e instanceof r.MeshBasicMaterial&&!e.envMap||e instanceof r.MeshDepthMaterial?!1:Ft(e)?r.SmoothShading:r.FlatShading}function qt(e){return e.vertexColors?e.vertexColors:!1}function Rt(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e instanceof r.ShaderMaterial?!0:!1}function Ut(e){for(var t in e.attributes){var n=t==="index"?G.ELEMENT_ARRAY_BUFFER:G.ARRAY_BUFFER,r=e.attributes[t];r.buffer=G.createBuffer(),G.bindBuffer(n,r.buffer),G.bufferData(n,r.array,G.STATIC_DRAW)}}function zt(e,t,n){var r,i,s,o,u,a,f=e.vertices,l=f.length,c=e.colors,h=c.length,p=e.__vertexArray,d=e.__colorArray,v=e.__sortArray,m=e.verticesNeedUpdate,g=e.elementsNeedUpdate,y=e.colorsNeedUpdate,b=e.__webglCustomAttributesList,w,E,S,x,T,N,C;if(n.sortParticles){V.copy(X),V.multiply(n.matrixWorld);for(r=0;r<l;r++)s=f[r],$.copy(s),$.applyProjection(V),v[r]=[$.z,r];v.sort(en);for(r=0;r<l;r++)s=f[v[r][1]],o=r*3,p[o]=s.x,p[o+1]=s.y,p[o+2]=s.z;for(i=0;i<h;i++)o=i*3,a=c[v[i][1]],d[o]=a.r,d[o+1]=a.g,d[o+2]=a.b;if(b)for(w=0,E=b.length;w<E;w++){C=b[w];if(C.boundTo!==undefined&&C.boundTo!=="vertices")continue;o=0,T=C.value.length;if(C.size===1)for(x=0;x<T;x++)u=v[x][1],C.array[x]=C.value[u];else if(C.size===2)for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.x,C.array[o+1]=N.y,o+=2;else if(C.size===3)if(C.type==="c")for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.r,C.array[o+1]=N.g,C.array[o+2]=N.b,o+=3;else for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,o+=3;else if(C.size===4)for(x=0;x<T;x++)u=v[x][1],N=C.value[u],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,C.array[o+3]=N.w,o+=4}}else{if(m)for(r=0;r<l;r++)s=f[r],o=r*3,p[o]=s.x,p[o+1]=s.y,p[o+2]=s.z;if(y)for(i=0;i<h;i++)a=c[i],o=i*3,d[o]=a.r,d[o+1]=a.g,d[o+2]=a.b;if(b)for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate&&(C.boundTo===undefined||C.boundTo==="vertices")){T=C.value.length,o=0;if(C.size===1)for(x=0;x<T;x++)C.array[x]=C.value[x];else if(C.size===2)for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.x,C.array[o+1]=N.y,o+=2;else if(C.size===3)if(C.type==="c")for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.r,C.array[o+1]=N.g,C.array[o+2]=N.b,o+=3;else for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,o+=3;else if(C.size===4)for(x=0;x<T;x++)N=C.value[x],C.array[o]=N.x,C.array[o+1]=N.y,C.array[o+2]=N.z,C.array[o+3]=N.w,o+=4}}}if(m||n.sortParticles)G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer),G.bufferData(G.ARRAY_BUFFER,p,t);if(y||n.sortParticles)G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer),G.bufferData(G.ARRAY_BUFFER,d,t);if(b)for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate||n.sortParticles)G.bindBuffer(G.ARRAY_BUFFER,C.buffer),G.bufferData(G.ARRAY_BUFFER,C.array,t)}}function Wt(e,t){var n,r,i,s,o,u,a=e.vertices,f=e.colors,l=e.lineDistances,c=a.length,h=f.length,p=l.length,d=e.__vertexArray,v=e.__colorArray,m=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,b=e.lineDistancesNeedUpdate,w=e.__webglCustomAttributesList,E,S,x,T,N,C,k;if(g){for(n=0;n<c;n++)s=a[n],o=n*3,d[o]=s.x,d[o+1]=s.y,d[o+2]=s.z;G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer),G.bufferData(G.ARRAY_BUFFER,d,t)}if(y){for(r=0;r<h;r++)u=f[r],o=r*3,v[o]=u.r,v[o+1]=u.g,v[o+2]=u.b;G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer),G.bufferData(G.ARRAY_BUFFER,v,t)}if(b){for(i=0;i<p;i++)m[i]=l[i];G.bindBuffer(G.ARRAY_BUFFER,e.__webglLineDistanceBuffer),G.bufferData(G.ARRAY_BUFFER,m,t)}if(w)for(E=0,S=w.length;E<S;E++){k=w[E];if(k.needsUpdate&&(k.boundTo===undefined||k.boundTo==="vertices")){o=0,N=k.value.length;if(k.size===1)for(T=0;T<N;T++)k.array[T]=k.value[T];else if(k.size===2)for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.x,k.array[o+1]=C.y,o+=2;else if(k.size===3)if(k.type==="c")for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.r,k.array[o+1]=C.g,k.array[o+2]=C.b,o+=3;else for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.x,k.array[o+1]=C.y,k.array[o+2]=C.z,o+=3;else if(k.size===4)for(T=0;T<N;T++)C=k.value[T],k.array[o]=C.x,k.array[o+1]=C.y,k.array[o+2]=C.z,k.array[o+3]=C.w,o+=4;G.bindBuffer(G.ARRAY_BUFFER,k.buffer),G.bufferData(G.ARRAY_BUFFER,k.array,t)}}}function Xt(e,t,n,i,s){if(!e.__inittedArrays)return;var o=It(s),u=qt(s),a=Rt(s),f=o===r.SmoothShading,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt=0,vt=0,mt=0,gt=0,yt=0,bt=0,wt=0,Et=0,St=0,xt=0,Tt=0,Nt=0,Ct=0,kt,Lt=e.__vertexArray,At=e.__uvArray,Ot=e.__uv2Array,Mt=e.__normalArray,_t=e.__tangentArray,Dt=e.__colorArray,Pt=e.__skinIndexArray,Ht=e.__skinWeightArray,Bt=e.__morphTargetsArrays,jt=e.__morphNormalsArrays,Ft=e.__webglCustomAttributesList,Ut,zt=e.__faceArray,Wt=e.__lineArray,Xt=t.geometry,Vt=Xt.verticesNeedUpdate,$t=Xt.elementsNeedUpdate,Jt=Xt.uvsNeedUpdate,Kt=Xt.normalsNeedUpdate,Qt=Xt.tangentsNeedUpdate,Gt=Xt.colorsNeedUpdate,Yt=Xt.morphTargetsNeedUpdate,Zt=Xt.vertices,en=e.faces3,tn=Xt.faces,nn=Xt.faceVertexUvs[0],rn=Xt.faceVertexUvs[1],sn=Xt.colors,on=Xt.skinIndices,un=Xt.skinWeights,an=Xt.morphTargets,fn=Xt.morphNormals;if(Vt){for(l=0,c=en.length;l<c;l++)p=tn[en[l]],S=Zt[p.a],x=Zt[p.b],T=Zt[p.c],Lt[vt]=S.x,Lt[vt+1]=S.y,Lt[vt+2]=S.z,Lt[vt+3]=x.x,Lt[vt+4]=x.y,Lt[vt+5]=x.z,Lt[vt+6]=T.x,Lt[vt+7]=T.y,Lt[vt+8]=T.z,vt+=9;G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer),G.bufferData(G.ARRAY_BUFFER,Lt,n)}if(Yt)for(ut=0,at=an.length;ut<at;ut++){Tt=0;for(l=0,c=en.length;l<c;l++)ct=en[l],p=tn[ct],S=an[ut].vertices[p.a],x=an[ut].vertices[p.b],T=an[ut].vertices[p.c],ft=Bt[ut],ft[Tt]=S.x,ft[Tt+1]=S.y,ft[Tt+2]=S.z,ft[Tt+3]=x.x,ft[Tt+4]=x.y,ft[Tt+5]=x.z,ft[Tt+6]=T.x,ft[Tt+7]=T.y,ft[Tt+8]=T.z,s.morphNormals&&(f?(ht=fn[ut].vertexNormals[ct],O=ht.a,M=ht.b,_=ht.c):(O=fn[ut].faceNormals[ct],M=O,_=O),lt=jt[ut],lt[Tt]=O.x,lt[Tt+1]=O.y,lt[Tt+2]=O.z,lt[Tt+3]=M.x,lt[Tt+4]=M.y,lt[Tt+5]=M.z,lt[Tt+6]=_.x,lt[Tt+7]=_.y,lt[Tt+8]=_.z),Tt+=9;G.bindBuffer(G.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[ut]),G.bufferData(G.ARRAY_BUFFER,Bt[ut],n),s.morphNormals&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[ut]),G.bufferData(G.ARRAY_BUFFER,jt[ut],n))}if(un.length){for(l=0,c=en.length;l<c;l++)p=tn[en[l]],j=un[p.a],F=un[p.b],I=un[p.c],Ht[xt]=j.x,Ht[xt+1]=j.y,Ht[xt+2]=j.z,Ht[xt+3]=j.w,Ht[xt+4]=F.x,Ht[xt+5]=F.y,Ht[xt+6]=F.z,Ht[xt+7]=F.w,Ht[xt+8]=I.x,Ht[xt+9]=I.y,Ht[xt+10]=I.z,Ht[xt+11]=I.w,R=on[p.a],U=on[p.b],z=on[p.c],Pt[xt]=R.x,Pt[xt+1]=R.y,Pt[xt+2]=R.z,Pt[xt+3]=R.w,Pt[xt+4]=U.x,Pt[xt+5]=U.y,Pt[xt+6]=U.z,Pt[xt+7]=U.w,Pt[xt+8]=z.x,Pt[xt+9]=z.y,Pt[xt+10]=z.z,Pt[xt+11]=z.w,xt+=12;xt>0&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),G.bufferData(G.ARRAY_BUFFER,Pt,n),G.bindBuffer(G.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),G.bufferData(G.ARRAY_BUFFER,Ht,n))}if(Gt&&u){for(l=0,c=en.length;l<c;l++)p=tn[en[l]],g=p.vertexColors,y=p.color,g.length===3&&u===r.VertexColors?(P=g[0],H=g[1],B=g[2]):(P=y,H=y,B=y),Dt[St]=P.r,Dt[St+1]=P.g,Dt[St+2]=P.b,Dt[St+3]=H.r,Dt[St+4]=H.g,Dt[St+5]=H.b,Dt[St+6]=B.r,Dt[St+7]=B.g,Dt[St+8]=B.b,St+=9;St>0&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer),G.bufferData(G.ARRAY_BUFFER,Dt,n))}if(Qt&&Xt.hasTangents){for(l=0,c=en.length;l<c;l++)p=tn[en[l]],b=p.vertexTangents,C=b[0],k=b[1],L=b[2],_t[wt]=C.x,_t[wt+1]=C.y,_t[wt+2]=C.z,_t[wt+3]=C.w,_t[wt+4]=k.x,_t[wt+5]=k.y,_t[wt+6]=k.z,_t[wt+7]=k.w,_t[wt+8]=L.x,_t[wt+9]=L.y,_t[wt+10]=L.z,_t[wt+11]=L.w,wt+=12;G.bindBuffer(G.ARRAY_BUFFER,e.__webglTangentBuffer),G.bufferData(G.ARRAY_BUFFER,_t,n)}if(Kt&&o){for(l=0,c=en.length;l<c;l++){p=tn[en[l]],d=p.vertexNormals,v=p.normal;if(d.length===3&&f)for(nt=0;nt<3;nt++)it=d[nt],Mt[bt]=it.x,Mt[bt+1]=it.y,Mt[bt+2]=it.z,bt+=3;else for(nt=0;nt<3;nt++)Mt[bt]=v.x,Mt[bt+1]=v.y,Mt[bt+2]=v.z,bt+=3}G.bindBuffer(G.ARRAY_BUFFER,e.__webglNormalBuffer),G.bufferData(G.ARRAY_BUFFER,Mt,n)}if(Jt&&nn&&a){for(l=0,c=en.length;l<c;l++){h=en[l],w=nn[h];if(w===undefined)continue;for(nt=0;nt<3;nt++)st=w[nt],At[mt]=st.x,At[mt+1]=st.y,mt+=2}mt>0&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglUVBuffer),G.bufferData(G.ARRAY_BUFFER,At,n))}if(Jt&&rn&&a){for(l=0,c=en.length;l<c;l++){h=en[l],E=rn[h];if(E===undefined)continue;for(nt=0;nt<3;nt++)ot=E[nt],Ot[gt]=ot.x,Ot[gt+1]=ot.y,gt+=2}gt>0&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglUV2Buffer),G.bufferData(G.ARRAY_BUFFER,Ot,n))}if($t){for(l=0,c=en.length;l<c;l++)zt[yt]=dt,zt[yt+1]=dt+1,zt[yt+2]=dt+2,yt+=3,Wt[Et]=dt,Wt[Et+1]=dt+1,Wt[Et+2]=dt,Wt[Et+3]=dt+2,Wt[Et+4]=dt+1,Wt[Et+5]=dt+2,Et+=6,dt+=3;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),G.bufferData(G.ELEMENT_ARRAY_BUFFER,zt,n),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),G.bufferData(G.ELEMENT_ARRAY_BUFFER,Wt,n)}if(Ft)for(nt=0,rt=Ft.length;nt<rt;nt++){Ut=Ft[nt];if(!Ut.__original.needsUpdate)continue;Nt=0,Ct=0;if(Ut.size===1){if(Ut.boundTo===undefined||Ut.boundTo==="vertices")for(l=0,c=en.length;l<c;l++)p=tn[en[l]],Ut.array[Nt]=Ut.value[p.a],Ut.array[Nt+1]=Ut.value[p.b],Ut.array[Nt+2]=Ut.value[p.c],Nt+=3;else if(Ut.boundTo==="faces")for(l=0,c=en.length;l<c;l++)kt=Ut.value[en[l]],Ut.array[Nt]=kt,Ut.array[Nt+1]=kt,Ut.array[Nt+2]=kt,Nt+=3}else if(Ut.size===2){if(Ut.boundTo===undefined||Ut.boundTo==="vertices")for(l=0,c=en.length;l<c;l++)p=tn[en[l]],S=Ut.value[p.a],x=Ut.value[p.b],T=Ut.value[p.c],Ut.array[Nt]=S.x,Ut.array[Nt+1]=S.y,Ut.array[Nt+2]=x.x,Ut.array[Nt+3]=x.y,Ut.array[Nt+4]=T.x,Ut.array[Nt+5]=T.y,Nt+=6;else if(Ut.boundTo==="faces")for(l=0,c=en.length;l<c;l++)kt=Ut.value[en[l]],S=kt,x=kt,T=kt,Ut.array[Nt]=S.x,Ut.array[Nt+1]=S.y,Ut.array[Nt+2]=x.x,Ut.array[Nt+3]=x.y,Ut.array[Nt+4]=T.x,Ut.array[Nt+5]=T.y,Nt+=6}else if(Ut.size===3){var ln;Ut.type==="c"?ln=["r","g","b"]:ln=["x","y","z"];if(Ut.boundTo===undefined||Ut.boundTo==="vertices")for(l=0,c=en.length;l<c;l++)p=tn[en[l]],S=Ut.value[p.a],x=Ut.value[p.b],T=Ut.value[p.c],Ut.array[Nt]=S[ln[0]],Ut.array[Nt+1]=S[ln[1]],Ut.array[Nt+2]=S[ln[2]],Ut.array[Nt+3]=x[ln[0]],Ut.array[Nt+4]=x[ln[1]],Ut.array[Nt+5]=x[ln[2]],Ut.array[Nt+6]=T[ln[0]],Ut.array[Nt+7]=T[ln[1]],Ut.array[Nt+8]=T[ln[2]],Nt+=9;else if(Ut.boundTo==="faces")for(l=0,c=en.length;l<c;l++)kt=Ut.value[en[l]],S=kt,x=kt,T=kt,Ut.array[Nt]=S[ln[0]],Ut.array[Nt+1]=S[ln[1]],Ut.array[Nt+2]=S[ln[2]],Ut.array[Nt+3]=x[ln[0]],Ut.array[Nt+4]=x[ln[1]],Ut.array[Nt+5]=x[ln[2]],Ut.array[Nt+6]=T[ln[0]],Ut.array[Nt+7]=T[ln[1]],Ut.array[Nt+8]=T[ln[2]],Nt+=9;else if(Ut.boundTo==="faceVertices")for(l=0,c=en.length;l<c;l++)kt=Ut.value[en[l]],S=kt[0],x=kt[1],T=kt[2],Ut.array[Nt]=S[ln[0]],Ut.array[Nt+1]=S[ln[1]],Ut.array[Nt+2]=S[ln[2]],Ut.array[Nt+3]=x[ln[0]],Ut.array[Nt+4]=x[ln[1]],Ut.array[Nt+5]=x[ln[2]],Ut.array[Nt+6]=T[ln[0]],Ut.array[Nt+7]=T[ln[1]],Ut.array[Nt+8]=T[ln[2]],Nt+=9}else if(Ut.size===4)if(Ut.boundTo===undefined||Ut.boundTo==="vertices")for(l=0,c=en.length;l<c;l++)p=tn[en[l]],S=Ut.value[p.a],x=Ut.value[p.b],T=Ut.value[p.c],Ut.array[Nt]=S.x,Ut.array[Nt+1]=S.y,Ut.array[Nt+2]=S.z,Ut.array[Nt+3]=S.w,Ut.array[Nt+4]=x.x,Ut.array[Nt+5]=x.y,Ut.array[Nt+6]=x.z,Ut.array[Nt+7]=x.w,Ut.array[Nt+8]=T.x,Ut.array[Nt+9]=T.y,Ut.array[Nt+10]=T.z,Ut.array[Nt+11]=T.w,Nt+=12;else if(Ut.boundTo==="faces")for(l=0,c=en.length;l<c;l++)kt=Ut.value[en[l]],S=kt,x=kt,T=kt,Ut.array[Nt]=S.x,Ut.array[Nt+1]=S.y,Ut.array[Nt+2]=S.z,Ut.array[Nt+3]=S.w,Ut.array[Nt+4]=x.x,Ut.array[Nt+5]=x.y,Ut.array[Nt+6]=x.z,Ut.array[Nt+7]=x.w,Ut.array[Nt+8]=T.x,Ut.array[Nt+9]=T.y,Ut.array[Nt+10]=T.z,Ut.array[Nt+11]=T.w,Nt+=12;else if(Ut.boundTo==="faceVertices")for(l=0,c=en.length;l<c;l++)kt=Ut.value[en[l]],S=kt[0],x=kt[1],T=kt[2],Ut.array[Nt]=S.x,Ut.array[Nt+1]=S.y,Ut.array[Nt+2]=S.z,Ut.array[Nt+3]=S.w,Ut.array[Nt+4]=x.x,Ut.array[Nt+5]=x.y,Ut.array[Nt+6]=x.z,Ut.array[Nt+7]=x.w,Ut.array[Nt+8]=T.x,Ut.array[Nt+9]=T.y,Ut.array[Nt+10]=T.z,Ut.array[Nt+11]=T.w,Nt+=12;G.bindBuffer(G.ARRAY_BUFFER,Ut.buffer),G.bufferData(G.ARRAY_BUFFER,Ut.array,n)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}function Vt(e,t){var n=e.attributes,r,i;for(r in n)i=n[r],i.needsUpdate&&(r==="index"?(G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,i.buffer),G.bufferData(G.ELEMENT_ARRAY_BUFFER,i.array,t)):(G.bindBuffer(G.ARRAY_BUFFER,i.buffer),G.bufferData(G.ARRAY_BUFFER,i.array,t)),i.needsUpdate=!1)}function $t(e,t,n,r){for(var i in t){var s=t[i],o=n[i];if(s>=0)if(o){var u=o.itemSize;G.bindBuffer(G.ARRAY_BUFFER,o.buffer),Kt(s),G.vertexAttribPointer(s,u,G.FLOAT,!1,0,r*u*4)}else e.defaultAttributeValues&&(e.defaultAttributeValues[i].length===2?G.vertexAttrib2fv(s,e.defaultAttributeValues[i]):e.defaultAttributeValues[i].length===3&&G.vertexAttrib3fv(s,e.defaultAttributeValues[i]))}Qt()}function Jt(){for(var e=0,t=U.length;e<t;e++)U[e]=0}function Kt(e){U[e]=1,z[e]===0&&(G.enableVertexAttribArray(e),z[e]=1)}function Qt(){for(var e=0,t=z.length;e<t;e++)z[e]!==U[e]&&(G.disableVertexAttribArray(e),z[e]=0)}function Gt(e,t,n){var r=e.program.attributes;n.morphTargetBase!==-1&&r.position>=0?(G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]),Kt(r.position),G.vertexAttribPointer(r.position,3,G.FLOAT,!1,0,0)):r.position>=0&&(G.bindBuffer(G.ARRAY_BUFFER,t.__webglVertexBuffer),Kt(r.position),G.vertexAttribPointer(r.position,3,G.FLOAT,!1,0,0));if(n.morphTargetForcedOrder.length){var i=0,s=n.morphTargetForcedOrder,o=n.morphTargetInfluences;while(i<e.numSupportedMorphTargets&&i<s.length)r["morphTarget"+i]>=0&&(G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[s[i]]),Kt(r["morphTarget"+i]),G.vertexAttribPointer(r["morphTarget"+i],3,G.FLOAT,!1,0,0)),r["morphNormal"+i]>=0&&e.morphNormals&&(G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[s[i]]),Kt(r["morphNormal"+i]),G.vertexAttribPointer(r["morphNormal"+i],3,G.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=o[s[i]],i++}else{var u,a=[],o=n.morphTargetInfluences,f,l=o.length;for(f=0;f<l;f++)u=o[f],u>0&&a.push([u,f]);a.length>e.numSupportedMorphTargets?(a.sort(en),a.length=e.numSupportedMorphTargets):a.length>e.numSupportedMorphNormals?a.sort(en):a.length===0&&a.push([0,0]);var c,i=0;while(i<e.numSupportedMorphTargets)a[i]?(c=a[i][1],r["morphTarget"+i]>=0&&(G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[c]),Kt(r["morphTarget"+i]),G.vertexAttribPointer(r["morphTarget"+i],3,G.FLOAT,!1,0,0)),r["morphNormal"+i]>=0&&e.morphNormals&&(G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[c]),Kt(r["morphNormal"+i]),G.vertexAttribPointer(r["morphNormal"+i],3,G.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=o[c]):n.__webglMorphTargetInfluences[i]=0,i++}e.program.uniforms.morphTargetInfluences!==null&&G.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}function Yt(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function Zt(e,t){return e.z!==t.z?e.z-t.z:e.id-t.id}function en(e,t){return t[0]-e[0]}function tn(e,t,n){if(t.visible===!1)return;var r=e.__webglObjects[t.id];if(r&&(t.frustumCulled===!1||W.intersectsObject(t)===!0)){pn(e,t);for(var i=0,s=r.length;i<s;i++){var o=r[i];un(o),o.render=!0,m.sortObjects===!0&&(t.renderDepth!==null?o.z=t.renderDepth:($.setFromMatrixPosition(t.matrixWorld),$.applyProjection(X),o.z=$.z))}}for(var i=0,s=t.children.length;i<s;i++)tn(e,t.children[i],n)}function nn(e,t,n){if(e.length===0)return;for(var r=0,i=e.length;r<i;r++)y=null,S=null,C=-1,O=-1,M=-1,T=-1,N=-1,E=-1,w=-1,K=!0,e[r].render(t,n,q,R),y=null,S=null,C=-1,O=-1,M=-1,T=-1,N=-1,E=-1,w=-1,K=!0}function rn(e,t,n,i,s,o){var u,a,f,l;for(var c=e.length-1;c!==-1;c--){u=e[c],a=u.object,f=u.buffer,Dn(a,t);if(o)l=o;else{l=u.material;if(!l)continue;s&&m.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),m.setDepthTest(l.depthTest),m.setDepthWrite(l.depthWrite),Fn(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}m.setMaterialFaces(l),f instanceof r.BufferGeometry?m.renderBufferDirect(t,n,i,l,f,a):m.renderBuffer(t,n,i,l,f,a)}}function sn(e,t,n,r,i,s,o){var u,a,f,l;for(var c=0,h=e.length;c<h;c++){u=e[c],a=u.object;if(a.visible){if(o)f=o;else{f=u[t];if(!f)continue;s&&m.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),m.setDepthTest(f.depthTest),m.setDepthWrite(f.depthWrite),Fn(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}m.renderImmediateObject(n,r,i,f,a)}}}function on(e){var t=e.object,n=t.material;n.transparent?(e.transparent=n,e.opaque=null):(e.opaque=n,e.transparent=null)}function un(e){var t=e.object,n=e.buffer,i=t.geometry,s=t.material;if(s instanceof r.MeshFaceMaterial){var o=i instanceof r.BufferGeometry?0:n.materialIndex;s=s.materials[o],s.transparent?(e.material=s,v.push(e)):(e.material=s,d.push(e))}else s&&(s.transparent?(e.material=s,v.push(e)):(e.material=s,d.push(e)))}function fn(e,t){var n,i,s;e.__webglInit===undefined&&(e.__webglInit=!0,e._modelViewMatrix=new r.Matrix4,e._normalMatrix=new r.Matrix3),i=e.geometry,i!==undefined&&i.__webglInit===undefined&&(i.__webglInit=!0,i.addEventListener("dispose",Tt),i instanceof r.BufferGeometry?Ut(i):e instanceof r.Mesh?(e.__webglActive!==undefined&&mn(e,t),ln(t,e,i)):e instanceof r.Line?i.__webglVertexBuffer||(St(i),Ht(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0):e instanceof r.PointCloud&&(i.__webglVertexBuffer||(Et(i),Pt(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0)));if(e.__webglActive===undefined){if(e instanceof r.Mesh){i=e.geometry;if(i instanceof r.BufferGeometry)cn(t.__webglObjects,i,e);else if(i instanceof r.Geometry)for(var o=0,u=i.geometryGroupsList.length;o<u;o++)s=i.geometryGroupsList[o],cn(t.__webglObjects,s,e)}else e instanceof r.Line||e instanceof r.PointCloud?(i=e.geometry,cn(t.__webglObjects,i,e)):(e instanceof r.ImmediateRenderObject||e.immediateRenderCallback)&&hn(t.__webglObjectsImmediate,e);e.__webglActive=!0}}function ln(e,t,n){var i,s,o,u=!1;o=t.material;if(n.geometryGroups===undefined||n.groupsNeedUpdate)delete e.__webglObjects[t.id],n.makeGroups(o instanceof r.MeshFaceMaterial,rt?4294967296:65535),n.groupsNeedUpdate=!1;for(var a=0,f=n.geometryGroupsList.length;a<f;a++)s=n.geometryGroupsList[a],s.__webglVertexBuffer?u=!1:(xt(s),Bt(s,t),n.verticesNeedUpdate=!0,n.morphTargetsNeedUpdate=!0,n.elementsNeedUpdate=!0,n.uvsNeedUpdate=!0,n.normalsNeedUpdate=!0,n.tangentsNeedUpdate=!0,n.colorsNeedUpdate=!0,u=!0),(u||t.__webglActive===undefined)&&cn(e.__webglObjects,s,t);t.__webglActive=!0}function cn(e,t,n){var r=n.id;e[r]=e[r]||[],e[r].push({id:r,buffer:t,object:n,material:null,z:0})}function hn(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function pn(e,t){var n=t.geometry,i,s,o;if(n instanceof r.BufferGeometry)Vt(n,G.DYNAMIC_DRAW);else if(t instanceof r.Mesh){if(n.buffersNeedUpdate||n.groupsNeedUpdate)n instanceof r.BufferGeometry?Ut(n):t instanceof r.Mesh&&ln(e,t,n);for(var u=0,a=n.geometryGroupsList.length;u<a;u++)i=n.geometryGroupsList[u],o=jt(t,i),(n.buffersNeedUpdate||n.groupsNeedUpdate)&&Bt(i,t),s=o.attributes&&dn(o),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||s)&&Xt(i,t,G.DYNAMIC_DRAW,!n.dynamic,o);n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,n.buffersNeedUpdate=!1,o.attributes&&vn(o)}else t instanceof r.Line?(o=jt(t,n),s=o.attributes&&dn(o),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||s)&&Wt(n,G.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,o.attributes&&vn(o)):t instanceof r.PointCloud&&(o=jt(t,n),s=o.attributes&&dn(o),(n.verticesNeedUpdate||n.colorsNeedUpdate||t.sortParticles||s)&&zt(n,G.DYNAMIC_DRAW,t),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,o.attributes&&vn(o))}function dn(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function vn(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function mn(e,t){e instanceof r.Mesh||e instanceof r.PointCloud||e instanceof r.Line?gn(t.__webglObjects,e):(e instanceof r.ImmediateRenderObject||e.immediateRenderCallback)&&yn(t.__webglObjectsImmediate,e),delete e.__webglActive}function gn(e,t){delete e[t.id]}function yn(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function bn(e,t,n,i,s){x=0,i.needsUpdate&&(i.program&&_t(i),m.initMaterial(i,t,n,s),i.needsUpdate=!1),i.morphTargets&&(s.__webglMorphTargetInfluences||(s.__webglMorphTargetInfluences=new Float32Array(m.maxMorphTargets)));var o=!1,u=!1,a=!1,f=i.program,l=f.uniforms,h=i.__webglShader.uniforms;f.id!==y&&(G.useProgram(f.program),y=f.id,o=!0,u=!0,a=!0),i.id!==w&&(w===-1&&(a=!0),w=i.id,u=!0);if(o||e!==S)G.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),c&&G.uniform1f(l.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==S&&(S=e),(i instanceof r.ShaderMaterial||i instanceof r.MeshPhongMaterial||i.envMap)&&l.cameraPosition!==null&&($.setFromMatrixPosition(e.matrixWorld),G.uniform3f(l.cameraPosition,$.x,$.y,$.z)),(i instanceof r.MeshPhongMaterial||i instanceof r.MeshLambertMaterial||i instanceof r.ShaderMaterial||i.skinning)&&l.viewMatrix!==null&&G.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements);if(i.skinning){s.bindMatrix&&l.bindMatrix!==null&&G.uniformMatrix4fv(l.bindMatrix,!1,s.bindMatrix.elements),s.bindMatrixInverse&&l.bindMatrixInverse!==null&&G.uniformMatrix4fv(l.bindMatrixInverse,!1,s.bindMatrixInverse.elements);if(ct&&s.skeleton&&s.skeleton.useVertexTexture){if(l.boneTexture!==null){var p=Mn();G.uniform1i(l.boneTexture,p),m.setTexture(s.skeleton.boneTexture,p)}l.boneTextureWidth!==null&&G.uniform1i(l.boneTextureWidth,s.skeleton.boneTextureWidth),l.boneTextureHeight!==null&&G.uniform1i(l.boneTextureHeight,s.skeleton.boneTextureHeight)}else s.skeleton&&s.skeleton.boneMatrices&&l.boneGlobalMatrices!==null&&G.uniformMatrix4fv(l.boneGlobalMatrices,!1,s.skeleton.boneMatrices)}if(u){n&&i.fog&&Tn(h,n);if(i instanceof r.MeshPhongMaterial||i instanceof r.MeshLambertMaterial||i.lights)K&&(a=!0,Bn(t),K=!1),a?(kn(h,Q),Ln(h,!0)):Ln(h,!1);(i instanceof r.MeshBasicMaterial||i instanceof r.MeshLambertMaterial||i instanceof r.MeshPhongMaterial)&&wn(h,i),i instanceof r.LineBasicMaterial?En(h,i):i instanceof r.LineDashedMaterial?(En(h,i),Sn(h,i)):i instanceof r.PointCloudMaterial?xn(h,i):i instanceof r.MeshPhongMaterial?Nn(h,i):i instanceof r.MeshLambertMaterial?Cn(h,i):i instanceof r.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=i.opacity):i instanceof r.MeshNormalMaterial&&(h.opacity.value=i.opacity),s.receiveShadow&&!i._shadowPass&&An(h,t),_n(i.uniformsList)}return On(l,s),l.modelMatrix!==null&&G.uniformMatrix4fv(l.modelMatrix,!1,s.matrixWorld.elements),f}function wn(e,t){e.opacity.value=t.opacity,m.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var n;t.map?n=t.map:t.specularMap?n=t.specularMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.alphaMap&&(n=t.alphaMap);if(n!==undefined){var i=n.offset,s=n.repeat;e.offsetRepeat.value.set(i.x,i.y,s.x,s.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof r.WebGLRenderTargetCube?1:-1,m.gammaInput?e.reflectivity.value=t.reflectivity:e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof r.CubeRefractionMapping}function En(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Sn(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function xn(e,n){e.psColor.value=n.color,e.opacity.value=n.opacity,e.size.value=n.size,e.scale.value=t.height/2,e.map.value=n.map}function Tn(e,t){e.fogColor.value=t.color,t instanceof r.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof r.FogExp2&&(e.fogDensity.value=t.density)}function Nn(e,t){e.shininess.value=t.shininess,m.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Cn(e,t){m.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function kn(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function Ln(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function An(e,t){if(e.shadowMatrix){var n=0;for(var i=0,s=t.length;i<s;i++){var o=t[i];if(!o.castShadow)continue;if(o instanceof r.SpotLight||o instanceof r.DirectionalLight&&!o.shadowCascade)e.shadowMap.value[n]=o.shadowMap,e.shadowMapSize.value[n]=o.shadowMapSize,e.shadowMatrix.value[n]=o.shadowMatrix,e.shadowDarkness.value[n]=o.shadowDarkness,e.shadowBias.value[n]=o.shadowBias,n++}}}function On(e,t){G.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&G.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function Mn(){var e=x;return e>=st&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+st),x+=1,e}function _n(e){var t,n,i;for(var s=0,o=e.length;s<o;s++){var u=e[s][0];if(u.needsUpdate===!1)continue;var a=u.type,f=u.value,l=e[s][1];switch(a){case"1i":G.uniform1i(l,f);break;case"1f":G.uniform1f(l,f);break;case"2f":G.uniform2f(l,f[0],f[1]);break;case"3f":G.uniform3f(l,f[0],f[1],f[2]);break;case"4f":G.uniform4f(l,f[0],f[1],f[2],f[3]);break;case"1iv":G.uniform1iv(l,f);break;case"3iv":G.uniform3iv(l,f);break;case"1fv":G.uniform1fv(l,f);break;case"2fv":G.uniform2fv(l,f);break;case"3fv":G.uniform3fv(l,f);break;case"4fv":G.uniform4fv(l,f);break;case"Matrix3fv":G.uniformMatrix3fv(l,!1,f);break;case"Matrix4fv":G.uniformMatrix4fv(l,!1,f);break;case"i":G.uniform1i(l,f);break;case"f":G.uniform1f(l,f);break;case"v2":G.uniform2f(l,f.x,f.y);break;case"v3":G.uniform3f(l,f.x,f.y,f.z);break;case"v4":G.uniform4f(l,f.x,f.y,f.z,f.w);break;case"c":G.uniform3f(l,f.r,f.g,f.b);break;case"iv1":G.uniform1iv(l,f);break;case"iv":G.uniform3iv(l,f);break;case"fv1":G.uniform1fv(l,f);break;case"fv":G.uniform3fv(l,f);break;case"v2v":u._array===undefined&&(u._array=new Float32Array(2*f.length));for(var c=0,h=f.length;c<h;c++)i=c*2,u._array[i]=f[c].x,u._array[i+1]=f[c].y;G.uniform2fv(l,u._array);break;case"v3v":u._array===undefined&&(u._array=new Float32Array(3*f.length));for(var c=0,h=f.length;c<h;c++)i=c*3,u._array[i]=f[c].x,u._array[i+1]=f[c].y,u._array[i+2]=f[c].z;G.uniform3fv(l,u._array);break;case"v4v":u._array===undefined&&(u._array=new Float32Array(4*f.length));for(var c=0,h=f.length;c<h;c++)i=c*4,u._array[i]=f[c].x,u._array[i+1]=f[c].y,u._array[i+2]=f[c].z,u._array[i+3]=f[c].w;G.uniform4fv(l,u._array);break;case"m3":G.uniformMatrix3fv(l,!1,f.elements);break;case"m3v":u._array===undefined&&(u._array=new Float32Array(9*f.length));for(var c=0,h=f.length;c<h;c++)f[c].flattenToArrayOffset(u._array,c*9);G.uniformMatrix3fv(l,!1,u._array);break;case"m4":G.uniformMatrix4fv(l,!1,f.elements);break;case"m4v":u._array===undefined&&(u._array=new Float32Array(16*f.length));for(var c=0,h=f.length;c<h;c++)f[c].flattenToArrayOffset(u._array,c*16);G.uniformMatrix4fv(l,!1,u._array);break;case"t":t=f,n=Mn(),G.uniform1i(l,n);if(!t)continue;t instanceof r.CubeTexture||t.image instanceof Array&&t.image.length===6?Rn(t,n):t instanceof r.WebGLRenderTargetCube?Un(t,n):m.setTexture(t,n);break;case"tv":u._array===undefined&&(u._array=[]);for(var c=0,h=u.value.length;c<h;c++)u._array[c]=Mn();G.uniform1iv(l,u._array);for(var c=0,h=u.value.length;c<h;c++){t=u.value[c],n=u._array[c];if(!t)continue;m.setTexture(t,n)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}function Dn(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Pn(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function Hn(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function Bn(e){var t,n,i,s,o=0,u=0,a=0,f,l,c,h,p,d,v,g=Q,y=g.directional.colors,b=g.directional.positions,w=g.point.colors,E=g.point.positions,S=g.point.distances,x=g.spot.colors,T=g.spot.positions,N=g.spot.distances,C=g.spot.directions,k=g.spot.anglesCos,L=g.spot.exponents,A=g.hemi.skyColors,O=g.hemi.groundColors,M=g.hemi.positions,_=0,D=0,P=0,H=0,B=0,j=0,F=0,I=0,q=0,R=0,U=0,z=0;for(t=0,n=e.length;t<n;t++){i=e[t];if(i.onlyShadow)continue;f=i.color,h=i.intensity,v=i.distance;if(i instanceof r.AmbientLight){if(!i.visible)continue;m.gammaInput?(o+=f.r*f.r,u+=f.g*f.g,a+=f.b*f.b):(o+=f.r,u+=f.g,a+=f.b)}else if(i instanceof r.DirectionalLight){B+=1;if(!i.visible)continue;J.setFromMatrixPosition(i.matrixWorld),$.setFromMatrixPosition(i.target.matrixWorld),J.sub($),J.normalize(),q=_*3,b[q]=J.x,b[q+1]=J.y,b[q+2]=J.z,m.gammaInput?Pn(y,q,f,h*h):Hn(y,q,f,h),_+=1}else if(i instanceof r.PointLight){j+=1;if(!i.visible)continue;R=D*3,m.gammaInput?Pn(w,R,f,h*h):Hn(w,R,f,h),$.setFromMatrixPosition(i.matrixWorld),E[R]=$.x,E[R+1]=$.y,E[R+2]=$.z,S[D]=v,D+=1}else if(i instanceof r.SpotLight){F+=1;if(!i.visible)continue;U=P*3,m.gammaInput?Pn(x,U,f,h*h):Hn(x,U,f,h),$.setFromMatrixPosition(i.matrixWorld),T[U]=$.x,T[U+1]=$.y,T[U+2]=$.z,N[P]=v,J.copy($),$.setFromMatrixPosition(i.target.matrixWorld),J.sub($),J.normalize(),C[U]=J.x,C[U+1]=J.y,C[U+2]=J.z,k[P]=Math.cos(i.angle),L[P]=i.exponent,P+=1}else if(i instanceof r.HemisphereLight){I+=1;if(!i.visible)continue;J.setFromMatrixPosition(i.matrixWorld),J.normalize(),z=H*3,M[z]=J.x,M[z+1]=J.y,M[z+2]=J.z,l=i.color,c=i.groundColor,m.gammaInput?(p=h*h,Pn(A,z,l,p),Pn(O,z,c,p)):(Hn(A,z,l,h),Hn(O,z,c,h)),H+=1}}for(t=_*3,n=Math.max(y.length,B*3);t<n;t++)y[t]=0;for(t=D*3,n=Math.max(w.length,j*3);t<n;t++)w[t]=0;for(t=P*3,n=Math.max(x.length,F*3);t<n;t++)x[t]=0;for(t=H*3,n=Math.max(A.length,I*3);t<n;t++)A[t]=0;for(t=H*3,n=Math.max(O.length,I*3);t<n;t++)O[t]=0;g.directional.length=_,g.point.length=D,g.spot.length=P,g.hemi.length=H,g.ambient[0]=o,g.ambient[1]=u,g.ambient[2]=a}function jn(e){e!==H&&(G.lineWidth(e),H=e)}function Fn(e,t,n){_!==e&&(e?G.enable(G.POLYGON_OFFSET_FILL):G.disable(G.POLYGON_OFFSET_FILL),_=e),e&&(D!==t||P!==n)&&(G.polygonOffset(t,n),D=t,P=n)}function In(e,t,n){n?(G.texParameteri(e,G.TEXTURE_WRAP_S,$n(t.wrapS)),G.texParameteri(e,G.TEXTURE_WRAP_T,$n(t.wrapT)),G.texParameteri(e,G.TEXTURE_MAG_FILTER,$n(t.magFilter)),G.texParameteri(e,G.TEXTURE_MIN_FILTER,$n(t.minFilter))):(G.texParameteri(e,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(e,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(e,G.TEXTURE_MAG_FILTER,Vn(t.magFilter)),G.texParameteri(e,G.TEXTURE_MIN_FILTER,Vn(t.minFilter))),tt&&t.type!==r.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(G.texParameterf(e,tt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,ft)),t.__oldAnisotropy=t.anisotropy)}function qn(e,t){if(e.width<=t&&e.height<=t)return e;var n=Math.max(e.width,e.height),r=Math.floor(e.width*t/n),i=Math.floor(e.height*t/n),s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");return o.drawImage(e,0,0,e.width,e.height,0,0,r,i),s}function Rn(e,t){if(e.image.length===6)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Nt),e.image.__webglTextureCube=G.createTexture(),m.info.memory.textures++),G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,e.flipY);var n=e instanceof r.CompressedTexture,i=[];for(var s=0;s<6;s++)m.autoScaleCubemaps&&!n?i[s]=qn(e.image[s],at):i[s]=e.image[s];var o=i[0],u=r.Math.isPowerOfTwo(o.width)&&r.Math.isPowerOfTwo(o.height),a=$n(e.format),f=$n(e.type);In(G.TEXTURE_CUBE_MAP,e,u);for(var s=0;s<6;s++)if(!n)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a,a,f,i[s]);else{var l,c=i[s].mipmaps;for(var h=0,p=c.length;h<p;h++)l=c[h],e.format!==r.RGBAFormat?G.compressedTexImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,l.data):G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,a,f,l.data)}e.generateMipmaps&&u&&G.generateMipmap(G.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function Un(e,t){G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_CUBE_MAP,e.__webglTexture)}function zn(e,t,n){G.bindFramebuffer(G.FRAMEBUFFER,e),G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function Wn(e,t){G.bindRenderbuffer(G.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(G.renderbufferStorage(G.RENDERBUFFER,G.DEPTH_COMPONENT16,t.width,t.height),G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_ATTACHMENT,G.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(G.renderbufferStorage(G.RENDERBUFFER,G.DEPTH_STENCIL,t.width,t.height),G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_STENCIL_ATTACHMENT,G.RENDERBUFFER,e)):G.renderbufferStorage(G.RENDERBUFFER,G.RGBA4,t.width,t.height)}function Xn(e){e instanceof r.WebGLRenderTargetCube?(G.bindTexture(G.TEXTURE_CUBE_MAP,e.__webglTexture),G.generateMipmap(G.TEXTURE_CUBE_MAP),G.bindTexture(G.TEXTURE_CUBE_MAP,null)):(G.bindTexture(G.TEXTURE_2D,e.__webglTexture),G.generateMipmap(G.TEXTURE_2D),G.bindTexture(G.TEXTURE_2D,null))}function Vn(e){return e===r.NearestFilter||e===r.NearestMipMapNearestFilter||e===r.NearestMipMapLinearFilter?G.NEAREST:G.LINEAR}function $n(e){if(e===r.RepeatWrapping)return G.REPEAT;if(e===r.ClampToEdgeWrapping)return G.CLAMP_TO_EDGE;if(e===r.MirroredRepeatWrapping)return G.MIRRORED_REPEAT;if(e===r.NearestFilter)return G.NEAREST;if(e===r.NearestMipMapNearestFilter)return G.NEAREST_MIPMAP_NEAREST;if(e===r.NearestMipMapLinearFilter)return G.NEAREST_MIPMAP_LINEAR;if(e===r.LinearFilter)return G.LINEAR;if(e===r.LinearMipMapNearestFilter)return G.LINEAR_MIPMAP_NEAREST;if(e===r.LinearMipMapLinearFilter)return G.LINEAR_MIPMAP_LINEAR;if(e===r.UnsignedByteType)return G.UNSIGNED_BYTE;if(e===r.UnsignedShort4444Type)return G.UNSIGNED_SHORT_4_4_4_4;if(e===r.UnsignedShort5551Type)return G.UNSIGNED_SHORT_5_5_5_1;if(e===r.UnsignedShort565Type)return G.UNSIGNED_SHORT_5_6_5;if(e===r.ByteType)return G.BYTE;if(e===r.ShortType)return G.SHORT;if(e===r.UnsignedShortType)return G.UNSIGNED_SHORT;if(e===r.IntType)return G.INT;if(e===r.UnsignedIntType)return G.UNSIGNED_INT;if(e===r.FloatType)return G.FLOAT;if(e===r.AlphaFormat)return G.ALPHA;if(e===r.RGBFormat)return G.RGB;if(e===r.RGBAFormat)return G.RGBA;if(e===r.LuminanceFormat)return G.LUMINANCE;if(e===r.LuminanceAlphaFormat)return G.LUMINANCE_ALPHA;if(e===r.AddEquation)return G.FUNC_ADD;if(e===r.SubtractEquation)return G.FUNC_SUBTRACT;if(e===r.ReverseSubtractEquation)return G.FUNC_REVERSE_SUBTRACT;if(e===r.ZeroFactor)return G.ZERO;if(e===r.OneFactor)return G.ONE;if(e===r.SrcColorFactor)return G.SRC_COLOR;if(e===r.OneMinusSrcColorFactor)return G.ONE_MINUS_SRC_COLOR;if(e===r.SrcAlphaFactor)return G.SRC_ALPHA;if(e===r.OneMinusSrcAlphaFactor)return G.ONE_MINUS_SRC_ALPHA;if(e===r.DstAlphaFactor)return G.DST_ALPHA;if(e===r.OneMinusDstAlphaFactor)return G.ONE_MINUS_DST_ALPHA;if(e===r.DstColorFactor)return G.DST_COLOR;if(e===r.OneMinusDstColorFactor)return G.ONE_MINUS_DST_COLOR;if(e===r.SrcAlphaSaturateFactor)return G.SRC_ALPHA_SATURATE;if(nt!==undefined){if(e===r.RGB_S3TC_DXT1_Format)return nt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===r.RGBA_S3TC_DXT1_Format)return nt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===r.RGBA_S3TC_DXT3_Format)return nt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===r.RGBA_S3TC_DXT5_Format)return nt.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Jn(e){if(ct&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=G.getParameter(G.MAX_VERTEX_UNIFORM_VECTORS),n=Math.floor((t-20)/4),i=n;return e!==undefined&&e instanceof r.SkinnedMesh&&(i=Math.min(e.skeleton.bones.length,i),i<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),i}function Kn(e){var t=0,n=0,i=0,s=0;for(var o=0,u=e.length;o<u;o++){var a=e[o];if(a.onlyShadow||a.visible===!1)continue;a instanceof r.DirectionalLight&&t++,a instanceof r.PointLight&&n++,a instanceof r.SpotLight&&i++,a instanceof r.HemisphereLight&&s++}return{directional:t,point:n,spot:i,hemi:s}}function Qn(e){var t=0;for(var n=0,i=e.length;n<i;n++){var s=e[n];if(!s.castShadow)continue;s instanceof r.SpotLight&&t++,s instanceof r.DirectionalLight&&!s.shadowCascade&&t++}return t}function Gn(){try{var e={alpha:s,depth:o,stencil:u,antialias:a,premultipliedAlpha:f,preserveDrawingBuffer:l};G=n||t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(G===null)throw"Error creating WebGL context."}catch(r){console.error(r)}Y=G.getExtension("OES_texture_float"),Z=G.getExtension("OES_texture_float_linear"),et=G.getExtension("OES_standard_derivatives"),tt=G.getExtension("EXT_texture_filter_anisotropic")||G.getExtension("MOZ_EXT_texture_filter_anisotropic")||G.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),nt=G.getExtension("WEBGL_compressed_texture_s3tc")||G.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||G.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),rt=G.getExtension("OES_element_index_uint"),Y===null&&console.log("THREE.WebGLRenderer: Float textures not supported."),et===null&&console.log("THREE.WebGLRenderer: Standard derivatives not supported."),tt===null&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),nt===null&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),rt===null&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported."),G.getShaderPrecisionFormat===undefined&&(G.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),c&&(it=G.getExtension("EXT_frag_depth"))}function Yn(){G.clearColor(0,0,0,1),G.clearDepth(1),G.clearStencil(0),G.enable(G.DEPTH_TEST),G.depthFunc(G.LEQUAL),G.frontFace(G.CCW),G.cullFace(G.BACK),G.enable(G.CULL_FACE),G.enable(G.BLEND),G.blendEquation(G.FUNC_ADD),G.blendFunc(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),G.viewport(B,j,F,I),G.clearColor(h.r,h.g,h.b,p)}console.log("THREE.WebGLRenderer",r.REVISION),e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),n=e.context!==undefined?e.context:null,i=e.precision!==undefined?e.precision:"highp",s=e.alpha!==undefined?e.alpha:!1,o=e.depth!==undefined?e.depth:!0,u=e.stencil!==undefined?e.stencil:!0,a=e.antialias!==undefined?e.antialias:!1,f=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:!0,l=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:!1,c=e.logarithmicDepthBuffer!==undefined?e.logarithmicDepthBuffer:!1,h=new r.Color(0),p=0,d=[],v=[];this.domElement=t,this.context=null,this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=r.PCFShadowMap,this.shadowMapCullFace=r.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var m=this,g=[],y=null,b=null,w=-1,E=null,S=null,x=0,T=-1,N=-1,C=-1,k=-1,L=-1,A=-1,O=-1,M=-1,_=null,D=null,P=null,H=null,B=0,j=0,F=t.width,I=t.height,q=0,R=0,U=new Uint8Array(16),z=new Uint8Array(16),W=new r.Frustum,X=new r.Matrix4,V=new r.Matrix4,$=new r.Vector3,J=new r.Vector3,K=!0,Q={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},G,Y,Z,et,tt,nt,rt,it;Gn(),Yn(),this.context=G;var st=G.getParameter(G.MAX_TEXTURE_IMAGE_UNITS),ot=G.getParameter(G.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ut=G.getParameter(G.MAX_TEXTURE_SIZE),at=G.getParameter(G.MAX_CUBE_MAP_TEXTURE_SIZE),ft=tt?G.getParameter(tt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,lt=ot>0,ct=lt&&Y,ht=nt?G.getParameter(G.COMPRESSED_TEXTURE_FORMATS):[],pt=G.getShaderPrecisionFormat(G.VERTEX_SHADER,G.HIGH_FLOAT),dt=G.getShaderPrecisionFormat(G.VERTEX_SHADER,G.MEDIUM_FLOAT),vt=G.getShaderPrecisionFormat(G.VERTEX_SHADER,G.LOW_FLOAT),mt=G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.HIGH_FLOAT),gt=G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.MEDIUM_FLOAT),yt=G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.LOW_FLOAT),bt=pt.precision>0&&mt.precision>0,wt=dt.precision>0&&gt.precision>0;i==="highp"&&!bt&&(wt?(i="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(i="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),i==="mediump"&&!wt&&(i="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")),this.getContext=function(){return G},this.supportsVertexTextures=function(){return lt},this.supportsFloatTextures=function(){return Y},this.supportsStandardDerivatives=function(){return et},this.supportsCompressedTextureS3TC=function(){return nt},this.getMaxAnisotropy=function(){return ft},this.getPrecision=function(){return i},this.setSize=function(e,n,r){t.width=e*this.devicePixelRatio,t.height=n*this.devicePixelRatio,r!==!1&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n)},this.setViewport=function(e,t,n,r){B=e*this.devicePixelRatio,j=t*this.devicePixelRatio,F=n*this.devicePixelRatio,I=r*this.devicePixelRatio,G.viewport(B,j,F,I)},this.setScissor=function(e,t,n,r){G.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(e){e?G.enable(G.SCISSOR_TEST):G.disable(G.SCISSOR_TEST)},this.setClearColor=function(e,t){h.set(e),p=t!==undefined?t:1,G.clearColor(h.r,h.g,h.b,p)},this.setClearColorHex=function(e,t){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return h},this.getClearAlpha=function(){return p},this.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=G.COLOR_BUFFER_BIT;if(t===undefined||t)r|=G.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=G.STENCIL_BUFFER_BIT;G.clear(r)},this.clearColor=function(){G.clear(G.COLOR_BUFFER_BIT)},this.clearDepth=function(){G.clear(G.DEPTH_BUFFER_BIT)},this.clearStencil=function(){G.clear(G.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){y=null,C=-1,O=-1,M=-1,E=-1,w=-1,K=!0,T=-1,N=-1,an(e),this.shadowMapPlugin.update(e,t)};var Tt=function(e){var t=e.target;t.removeEventListener("dispose",Tt),At(t)},Nt=function(e){var t=e.target;t.removeEventListener("dispose",Nt),Ot(t),m.info.memory.textures--},Ct=function(e){var t=e.target;t.removeEventListener("dispose",Ct),Mt(t),m.info.memory.textures--},kt=function(e){var t=e.target;t.removeEventListener("dispose",kt),_t(t)},Lt=function(e){e.__webglVertexBuffer!==undefined&&G.deleteBuffer(e.__webglVertexBuffer),e.__webglNormalBuffer!==undefined&&G.deleteBuffer(e.__webglNormalBuffer),e.__webglTangentBuffer!==undefined&&G.deleteBuffer(e.__webglTangentBuffer),e.__webglColorBuffer!==undefined&&G.deleteBuffer(e.__webglColorBuffer),e.__webglUVBuffer!==undefined&&G.deleteBuffer(e.__webglUVBuffer),e.__webglUV2Buffer!==undefined&&G.deleteBuffer(e.__webglUV2Buffer),e.__webglSkinIndicesBuffer!==undefined&&G.deleteBuffer(e.__webglSkinIndicesBuffer),e.__webglSkinWeightsBuffer!==undefined&&G.deleteBuffer(e.__webglSkinWeightsBuffer),e.__webglFaceBuffer!==undefined&&G.deleteBuffer(e.__webglFaceBuffer),e.__webglLineBuffer!==undefined&&G.deleteBuffer(e.__webglLineBuffer),e.__webglLineDistanceBuffer!==undefined&&G.deleteBuffer(e.__webglLineDistanceBuffer);if(e.__webglCustomAttributesList!==undefined)for(var t in e.__webglCustomAttributesList)G.deleteBuffer(e.__webglCustomAttributesList[t].buffer);m.info.memory.geometries--},At=function(e){e.__webglInit=undefined;if(e instanceof r.BufferGeometry){var t=e.attributes;for(var n in t)t[n].buffer!==undefined&&G.deleteBuffer(t[n].buffer);m.info.memory.geometries--}else if(e.geometryGroups!==undefined)for(var i=0,s=e.geometryGroupsList.length;i<s;i++){var o=e.geometryGroupsList[i];if(o.numMorphTargets!==undefined)for(var u=0,a=o.numMorphTargets;u<a;u++)G.deleteBuffer(o.__webglMorphTargetsBuffers[u]);if(o.numMorphNormals!==undefined)for(var u=0,a=o.numMorphNormals;u<a;u++)G.deleteBuffer(o.__webglMorphNormalsBuffers[u]);Lt(o)}else Lt(e)},Ot=function(e){if(e.image&&e.image.__webglTextureCube)G.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,G.deleteTexture(e.__webglTexture)}},Mt=function(e){if(!e||!e.__webglTexture)return;G.deleteTexture(e.__webglTexture);if(e instanceof r.WebGLRenderTargetCube)for(var t=0;t<6;t++)G.deleteFramebuffer(e.__webglFramebuffer[t]),G.deleteRenderbuffer(e.__webglRenderbuffer[t]);else G.deleteFramebuffer(e.__webglFramebuffer),G.deleteRenderbuffer(e.__webglRenderbuffer)},_t=function(e){var t=e.program.program;if(t===undefined)return;e.program=undefined;var n,r,i,s=!1;for(n=0,r=g.length;n<r;n++){i=g[n];if(i.program===t){i.usedTimes--,i.usedTimes===0&&(s=!0);break}}if(s===!0){var o=[];for(n=0,r=g.length;n<r;n++)i=g[n],i.program!==t&&o.push(i);g=o,G.deleteProgram(t),m.info.memory.programs--}};this.renderBufferImmediate=function(e,t,n){Jt(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=G.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=G.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=G.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=G.createBuffer()),e.hasPositions&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer),G.bufferData(G.ARRAY_BUFFER,e.positionArray,G.DYNAMIC_DRAW),Kt(t.attributes.position),G.vertexAttribPointer(t.attributes.position,3,G.FLOAT,!1,0,0));if(e.hasNormals){G.bindBuffer(G.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===r.FlatShading){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=e.count*3;for(g=0;g<y;g+=9)m=e.normalArray,u=m[g],l=m[g+1],p=m[g+2],a=m[g+3],c=m[g+4],d=m[g+5],f=m[g+6],h=m[g+7],v=m[g+8],i=(u+a+f)/3,s=(l+c+h)/3,o=(p+d+v)/3,m[g]=i,m[g+1]=s,m[g+2]=o,m[g+3]=i,m[g+4]=s,m[g+5]=o,m[g+6]=i,m[g+7]=s,m[g+8]=o}G.bufferData(G.ARRAY_BUFFER,e.normalArray,G.DYNAMIC_DRAW),Kt(t.attributes.normal),G.vertexAttribPointer(t.attributes.normal,3,G.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglUvBuffer),G.bufferData(G.ARRAY_BUFFER,e.uvArray,G.DYNAMIC_DRAW),Kt(t.attributes.uv),G.vertexAttribPointer(t.attributes.uv,2,G.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==r.NoColors&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer),G.bufferData(G.ARRAY_BUFFER,e.colorArray,G.DYNAMIC_DRAW),Kt(t.attributes.color),G.vertexAttribPointer(t.attributes.color,3,G.FLOAT,!1,0,0)),Qt(),G.drawArrays(G.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,s,o){if(i.visible===!1)return;var u,a,f,l,c,h,p,d=bn(e,t,n,i,o),v=d.attributes,g=s.attributes,y=!1,b=i.wireframe?1:0,w=s.id*16777215+d.id*2+b;w!==E&&(E=w,y=!0),y&&Jt();if(o instanceof r.Mesh){var S=g.index;if(S){var x,T;S.array instanceof Uint32Array?(x=G.UNSIGNED_INT,T=4):(x=G.UNSIGNED_SHORT,T=2);var N=s.offsets;if(N.length===0)y&&($t(i,v,g,0),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,S.buffer)),G.drawElements(G.TRIANGLES,S.array.length,x,0),m.info.render.calls++,m.info.render.vertices+=S.array.length,m.info.render.faces+=S.array.length/3;else{y=!0;for(var C=0,k=N.length;C<k;C++){var L=N[C].index;y&&($t(i,v,g,L),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,S.buffer)),G.drawElements(G.TRIANGLES,N[C].count,x,N[C].start*T),m.info.render.calls++,m.info.render.vertices+=N[C].count,m.info.render.faces+=N[C].count/3}}}else{y&&$t(i,v,g,0);var A=s.attributes.position;G.drawArrays(G.TRIANGLES,0,A.array.length/3),m.info.render.calls++,m.info.render.vertices+=A.array.length/3,m.info.render.faces+=A.array.length/9}}else if(o instanceof r.PointCloud){y&&$t(i,v,g,0);var A=g.position;G.drawArrays(G.POINTS,0,A.array.length/3),m.info.render.calls++,m.info.render.points+=A.array.length/3}else if(o instanceof r.Line){var O=o.type===r.LineStrip?G.LINE_STRIP:G.LINES;jn(i.linewidth);var S=g.index;if(S){var x,T;S.array instanceof Uint32Array?(x=G.UNSIGNED_INT,T=4):(x=G.UNSIGNED_SHORT,T=2);var N=s.offsets;if(N.length===0)y&&($t(i,v,g,0),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,S.buffer)),G.drawElements(O,S.array.length,x,0),m.info.render.calls++,m.info.render.vertices+=S.array.length;else{N.length>1&&(y=!0);for(var C=0,k=N.length;C<k;C++){var L=N[C].index;y&&($t(i,v,g,L),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,S.buffer)),G.drawElements(O,N[C].count,x,N[C].start*T),m.info.render.calls++,m.info.render.vertices+=N[C].count}}}else{y&&$t(i,v,g,0);var A=g.position;G.drawArrays(O,0,A.array.length/3),m.info.render.calls++,m.info.render.points+=A.array.length/3}}},this.renderBuffer=function(e,t,n,i,s,o){if(i.visible===!1)return;var u,a,f,l,c,h=bn(e,t,n,i,o),p=h.attributes,d=!1,v=i.wireframe?1:0,g=s.id*16777215+h.id*2+v;g!==E&&(E=g,d=!0),d&&Jt(),!i.morphTargets&&p.position>=0?d&&(G.bindBuffer(G.ARRAY_BUFFER,s.__webglVertexBuffer),Kt(p.position),G.vertexAttribPointer(p.position,3,G.FLOAT,!1,0,0)):o.morphTargetBase&&Gt(i,s,o);if(d){if(s.__webglCustomAttributesList)for(l=0,c=s.__webglCustomAttributesList.length;l<c;l++)f=s.__webglCustomAttributesList[l],p[f.buffer.belongsToAttribute]>=0&&(G.bindBuffer(G.ARRAY_BUFFER,f.buffer),Kt(p[f.buffer.belongsToAttribute]),G.vertexAttribPointer(p[f.buffer.belongsToAttribute],f.size,G.FLOAT,!1,0,0));p.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(G.bindBuffer(G.ARRAY_BUFFER,s.__webglColorBuffer),Kt(p.color),G.vertexAttribPointer(p.color,3,G.FLOAT,!1,0,0)):i.defaultAttributeValues&&G.vertexAttrib3fv(p.color,i.defaultAttributeValues.color)),p.normal>=0&&(G.bindBuffer(G.ARRAY_BUFFER,s.__webglNormalBuffer),Kt(p.normal),G.vertexAttribPointer(p.normal,3,G.FLOAT,!1,0,0)),p.tangent>=0&&(G.bindBuffer(G.ARRAY_BUFFER,s.__webglTangentBuffer),Kt(p.tangent),G.vertexAttribPointer(p.tangent,4,G.FLOAT,!1,0,0)),p.uv>=0&&(o.geometry.faceVertexUvs[0]?(G.bindBuffer(G.ARRAY_BUFFER,s.__webglUVBuffer),Kt(p.uv),G.vertexAttribPointer(p.uv,2,G.FLOAT,!1,0,0)):i.defaultAttributeValues&&G.vertexAttrib2fv(p.uv,i.defaultAttributeValues.uv)),p.uv2>=0&&(o.geometry.faceVertexUvs[1]?(G.bindBuffer(G.ARRAY_BUFFER,s.__webglUV2Buffer),Kt(p.uv2),G.vertexAttribPointer(p.uv2,2,G.FLOAT,!1,0,0)):i.defaultAttributeValues&&G.vertexAttrib2fv(p.uv2,i.defaultAttributeValues.uv2)),i.skinning&&p.skinIndex>=0&&p.skinWeight>=0&&(G.bindBuffer(G.ARRAY_BUFFER,s.__webglSkinIndicesBuffer),Kt(p.skinIndex),G.vertexAttribPointer(p.skinIndex,4,G.FLOAT,!1,0,0),G.bindBuffer(G.ARRAY_BUFFER,s.__webglSkinWeightsBuffer),Kt(p.skinWeight),G.vertexAttribPointer(p.skinWeight,4,G.FLOAT,!1,0,0)),p.lineDistance>=0&&(G.bindBuffer(G.ARRAY_BUFFER,s.__webglLineDistanceBuffer),Kt(p.lineDistance),G.vertexAttribPointer(p.lineDistance,1,G.FLOAT,!1,0,0))}Qt();if(o instanceof r.Mesh){var y=s.__typeArray===Uint32Array?G.UNSIGNED_INT:G.UNSIGNED_SHORT;i.wireframe?(jn(i.wireframeLinewidth),d&&G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),G.drawElements(G.LINES,s.__webglLineCount,y,0)):(d&&G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),G.drawElements(G.TRIANGLES,s.__webglFaceCount,y,0)),m.info.render.calls++,m.info.render.vertices+=s.__webglFaceCount,m.info.render.faces+=s.__webglFaceCount/3}else if(o instanceof r.Line){var b=o.type===r.LineStrip?G.LINE_STRIP:G.LINES;jn(i.linewidth),G.drawArrays(b,0,s.__webglLineCount),m.info.render.calls++}else o instanceof r.PointCloud&&(G.drawArrays(G.POINTS,0,s.__webglParticleCount),m.info.render.calls++,m.info.render.points+=s.__webglParticleCount)},this.render=function(e,t,n,i){function h(e){e instanceof r.SkinnedMesh&&e.skeleton.update();for(var t=0,n=e.children.length;t<n;t++)h(e.children[t])}if(t instanceof r.Camera==0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var s,o,u,a,f,l=e.__lights,c=e.fog;w=-1,S=null,K=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),t.parent===undefined&&t.updateMatrixWorld(),h(e),t.matrixWorldInverse.getInverse(t.matrixWorld),X.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),W.setFromMatrix(X),an(e),d.length=0,v.length=0,tn(e,e,t),m.sortObjects===!0&&(d.sort(Yt),v.sort(Zt)),nn(this.renderPluginsPre,e,t),m.info.render.calls=0,m.info.render.vertices=0,m.info.render.faces=0,m.info.render.points=0,this.setRenderTarget(n),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),f=e.__webglObjectsImmediate;for(s=0,o=f.length;s<o;s++)u=f[s],a=u.object,a.visible&&(Dn(a,t),on(u));if(e.overrideMaterial){var p=e.overrideMaterial;this.setBlending(p.blending,p.blendEquation,p.blendSrc,p.blendDst),this.setDepthTest(p.depthTest),this.setDepthWrite(p.depthWrite),Fn(p.polygonOffset,p.polygonOffsetFactor,p.polygonOffsetUnits),rn(d,t,l,c,!0,p),rn(v,t,l,c,!0,p),sn(e.__webglObjectsImmediate,"",t,l,c,!1,p)}else{var p=null;this.setBlending(r.NoBlending),rn(d,t,l,c,!1,p),sn(e.__webglObjectsImmediate,"opaque",t,l,c,!1,p),rn(v,t,l,c,!0,p),sn(e.__webglObjectsImmediate,"transparent",t,l,c,!0,p)}nn(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==r.NearestFilter&&n.minFilter!==r.LinearFilter&&Xn(n),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,n,r,i){var s=bn(e,t,n,r,i);E=-1,m.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,G,W):i.render(function(e){m.renderBufferImmediate(e,s,r)})};var an=function(e){e.__webglObjects||(e.__webglObjects={},e.__webglObjectsImmediate=[]);while(e.__objectsAdded.length)fn(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);while(e.__objectsRemoved.length)mn(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1)};this.initMaterial=function(e,t,n,s){e.addEventListener("dispose",kt);var o,u,a,f,l,h,p,d,v;e instanceof r.MeshDepthMaterial?v="depth":e instanceof r.MeshNormalMaterial?v="normal":e instanceof r.MeshBasicMaterial?v="basic":e instanceof r.MeshLambertMaterial?v="lambert":e instanceof r.MeshPhongMaterial?v="phong":e instanceof r.LineBasicMaterial?v="basic":e instanceof r.LineDashedMaterial?v="dashed":e instanceof r.PointCloudMaterial&&(v="particle_basic");if(v){var y=r.ShaderLib[v];e.__webglShader={uniforms:r.UniformsUtils.clone(y.uniforms),vertexShader:y.vertexShader,fragmentShader:y.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};h=Kn(t),d=Qn(t),p=Jn(s),l={precision:i,supportsVertexTextures:lt,map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof r.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:c,skinning:e.skinning,maxBones:p,useVertexTexture:ct&&s&&s.skeleton&&s.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,maxShadows:d,shadowMapEnabled:this.shadowMapEnabled&&s.receiveShadow&&d>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===r.DoubleSide,flipSided:e.side===r.BackSide};var b=[];v?b.push(v):(b.push(e.fragmentShader),b.push(e.vertexShader));for(var w in e.defines)b.push(w),b.push(e.defines[w]);for(var E in l)b.push(E),b.push(l[E]);var S=b.join(),x;for(var E=0,T=g.length;E<T;E++){var N=g[E];if(N.code===S){x=N,x.usedTimes++;break}}x===undefined&&(x=new r.WebGLProgram(this,S,e,l),g.push(x),m.info.memory.programs=g.length),e.program=x;var C=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var k,L="morphTarget";for(f=0;f<this.maxMorphTargets;f++)k=L+f,C[k]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var k,L="morphNormal";for(f=0;f<this.maxMorphNormals;f++)k=L+f,C[k]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(o in e.__webglShader.uniforms){var A=e.program.uniforms[o];A&&e.uniformsList.push([e.__webglShader.uniforms[o],A])}},this.setFaceCulling=function(e,t){e===r.CullFaceNone?G.disable(G.CULL_FACE):(t===r.FrontFaceDirectionCW?G.frontFace(G.CW):G.frontFace(G.CCW),e===r.CullFaceBack?G.cullFace(G.BACK):e===r.CullFaceFront?G.cullFace(G.FRONT):G.cullFace(G.FRONT_AND_BACK),G.enable(G.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===r.DoubleSide,n=e.side===r.BackSide;T!==t&&(t?G.disable(G.CULL_FACE):G.enable(G.CULL_FACE),T=t),N!==n&&(n?G.frontFace(G.CW):G.frontFace(G.CCW),N=n)},this.setDepthTest=function(e){O!==e&&(e?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST),O=e)},this.setDepthWrite=function(e){M!==e&&(G.depthMask(e),M=e)},this.setBlending=function(e,t,n,i){e!==C&&(e===r.NoBlending?G.disable(G.BLEND):e===r.AdditiveBlending?(G.enable(G.BLEND),G.blendEquation(G.FUNC_ADD),G.blendFunc(G.SRC_ALPHA,G.ONE)):e===r.SubtractiveBlending?(G.enable(G.BLEND),G.blendEquation(G.FUNC_ADD),G.blendFunc(G.ZERO,G.ONE_MINUS_SRC_COLOR)):e===r.MultiplyBlending?(G.enable(G.BLEND),G.blendEquation(G.FUNC_ADD),G.blendFunc(G.ZERO,G.SRC_COLOR)):e===r.CustomBlending?G.enable(G.BLEND):(G.enable(G.BLEND),G.blendEquationSeparate(G.FUNC_ADD,G.FUNC_ADD),G.blendFuncSeparate(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA)),C=e);if(e===r.CustomBlending){t!==k&&(G.blendEquation($n(t)),k=t);if(n!==L||i!==A)G.blendFunc($n(n),$n(i)),L=n,A=i}else k=null,L=null,A=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Nt),e.__webglTexture=G.createTexture(),m.info.memory.textures++),G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_2D,e.__webglTexture),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,e.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,e.unpackAlignment);var n=e.image,i=r.Math.isPowerOfTwo(n.width)&&r.Math.isPowerOfTwo(n.height),s=$n(e.format),o=$n(e.type);In(G.TEXTURE_2D,e,i);var u,a=e.mipmaps;if(e instanceof r.DataTexture)if(a.length>0&&i){for(var f=0,l=a.length;f<l;f++)u=a[f],G.texImage2D(G.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data);e.generateMipmaps=!1}else G.texImage2D(G.TEXTURE_2D,0,s,n.width,n.height,0,s,o,n.data);else if(e instanceof r.CompressedTexture)for(var f=0,l=a.length;f<l;f++)u=a[f],e.format!==r.RGBAFormat?G.compressedTexImage2D(G.TEXTURE_2D,f,s,u.width,u.height,0,u.data):G.texImage2D(G.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data);else if(a.length>0&&i){for(var f=0,l=a.length;f<l;f++)u=a[f],G.texImage2D(G.TEXTURE_2D,f,s,s,o,u);e.generateMipmaps=!1}else G.texImage2D(G.TEXTURE_2D,0,s,s,o,e.image);e.generateMipmaps&&i&&G.generateMipmap(G.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof r.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){e.depthBuffer===undefined&&(e.depthBuffer=!0),e.stencilBuffer===undefined&&(e.stencilBuffer=!0),e.addEventListener("dispose",Ct),e.__webglTexture=G.createTexture(),m.info.memory.textures++;var n=r.Math.isPowerOfTwo(e.width)&&r.Math.isPowerOfTwo(e.height),i=$n(e.format),s=$n(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],G.bindTexture(G.TEXTURE_CUBE_MAP,e.__webglTexture),In(G.TEXTURE_CUBE_MAP,e,n);for(var o=0;o<6;o++)e.__webglFramebuffer[o]=G.createFramebuffer(),e.__webglRenderbuffer[o]=G.createRenderbuffer(),G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i,e.width,e.height,0,i,s,null),zn(e.__webglFramebuffer[o],e,G.TEXTURE_CUBE_MAP_POSITIVE_X+o),Wn(e.__webglRenderbuffer[o],e);n&&G.generateMipmap(G.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=G.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=G.createRenderbuffer(),G.bindTexture(G.TEXTURE_2D,e.__webglTexture),In(G.TEXTURE_2D,e,n),G.texImage2D(G.TEXTURE_2D,0,i,e.width,e.height,0,i,s,null),zn(e.__webglFramebuffer,e,G.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_ATTACHMENT,G.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_STENCIL_ATTACHMENT,G.RENDERBUFFER,e.__webglRenderbuffer):Wn(e.__webglRenderbuffer,e),n&&G.generateMipmap(G.TEXTURE_2D);t?G.bindTexture(G.TEXTURE_CUBE_MAP,null):G.bindTexture(G.TEXTURE_2D,null),G.bindRenderbuffer(G.RENDERBUFFER,null),G.bindFramebuffer(G.FRAMEBUFFER,null)}var u,a,f,l,c;e?(t?u=e.__webglFramebuffer[e.activeCubeFace]:u=e.__webglFramebuffer,a=e.width,f=e.height,l=0,c=0):(u=null,a=F,f=I,l=B,c=j),u!==b&&(G.bindFramebuffer(G.FRAMEBUFFER,u),G.viewport(l,c,a,f),b=u),q=a,R=f},this.shadowMapPlugin=new r.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new r.SpritePlugin),this.addPostPlugin(new r.LensFlarePlugin)},r.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=n.wrapS!==undefined?n.wrapS:r.ClampToEdgeWrapping,this.wrapT=n.wrapT!==undefined?n.wrapT:r.ClampToEdgeWrapping,this.magFilter=n.magFilter!==undefined?n.magFilter:r.LinearFilter,this.minFilter=n.minFilter!==undefined?n.minFilter:r.LinearMipMapLinearFilter,this.anisotropy=n.anisotropy!==undefined?n.anisotropy:1,this.offset=new r.Vector2(0,0),this.repeat=new r.Vector2(1,1),this.format=n.format!==undefined?n.format:r.RGBAFormat,this.type=n.type!==undefined?n.type:r.UnsignedByteType,this.depthBuffer=n.depthBuffer!==undefined?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==undefined?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},r.WebGLRenderTarget.prototype={constructor:r.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new r.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},r.EventDispatcher.prototype.apply(r.WebGLRenderTarget.prototype),r.WebGLRenderTargetCube=function(e,t,n){r.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},r.WebGLRenderTargetCube.prototype=Object.create(r.WebGLRenderTarget.prototype),r.WebGLProgram=function(){var e=0,t=function(e){var t,n,r=[];for(var i in e){t=e[i];if(t===!1)continue;n="#define "+i+" "+t,r.push(n)}return r.join("\n")},n=function(e,t,n){var r={};for(var i=0,s=n.length;i<s;i++){var o=n[i];r[o]=e.getUniformLocation(t,o)}return r},i=function(e,t,n){var r={};for(var i=0,s=n.length;i<s;i++){var o=n[i];r[o]=e.getAttribLocation(t,o)}return r};return function(s,o,u,a){var f=s,l=f.context,c=u.defines,h=u.__webglShader.uniforms,p=u.attributes,d=u.__webglShader.vertexShader,v=u.__webglShader.fragmentShader,m=u.index0AttributeName;m===undefined&&a.morphTargets===!0&&(m="position");var g="SHADOWMAP_TYPE_BASIC";a.shadowMapType===r.PCFShadowMap?g="SHADOWMAP_TYPE_PCF":a.shadowMapType===r.PCFSoftShadowMap&&(g="SHADOWMAP_TYPE_PCF_SOFT");var y=t(c),b=l.createProgram(),w,E;u instanceof r.RawShaderMaterial?(w="",E=""):(w=["precision "+a.precision+" float;","precision "+a.precision+" int;",y,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"",f.gammaInput?"#define GAMMA_INPUT":"",f.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+g:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n"),E=["precision "+a.precision+" float;","precision "+a.precision+" int;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",y,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",f.gammaInput?"#define GAMMA_INPUT":"",f.gammaOutput?"#define GAMMA_OUTPUT":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+g:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var S=new r.WebGLShader(l,l.VERTEX_SHADER,w+d),x=new r.WebGLShader(l,l.FRAGMENT_SHADER,E+v);l.attachShader(b,S),l.attachShader(b,x),m!==undefined&&l.bindAttribLocation(b,0,m),l.linkProgram(b),l.getProgramParameter(b,l.LINK_STATUS)===!1&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",l.getProgramParameter(b,l.VALIDATE_STATUS)),console.error("gl.getError()",l.getError())),l.getProgramInfoLog(b)!==""&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",l.getProgramInfoLog(b)),l.deleteShader(S),l.deleteShader(x);var T=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];a.useVertexTexture?(T.push("boneTexture"),T.push("boneTextureWidth"),T.push("boneTextureHeight")):T.push("boneGlobalMatrices"),a.logarithmicDepthBuffer&&T.push("logDepthBufFC");for(var N in h)T.push(N);this.uniforms=n(l,b,T),T=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var C=0;C<a.maxMorphTargets;C++)T.push("morphTarget"+C);for(var C=0;C<a.maxMorphNormals;C++)T.push("morphNormal"+C);for(var k in p)T.push(k);return this.attributes=i(l,b,T),this.id=e++,this.code=o,this.usedTimes=1,this.program=b,this.vertexShader=S,this.fragmentShader=x,this}}(),r.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")};return function(t,n,r){var i=t.createShader(n);return t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),t.getShaderInfoLog(i)!==""&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(i)),console.warn(e(r))),i}}(),r.RenderableVertex=function(){this.position=new r.Vector3,this.positionWorld=new r.Vector3,this.positionScreen=new r.Vector4,this.visible=!0},r.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},r.RenderableFace=function(){this.id=0,this.v1=new r.RenderableVertex,this.v2=new r.RenderableVertex,this.v3=new r.RenderableVertex,this.normalModel=new r.Vector3,this.vertexNormalsModel=[new r.Vector3,new r.Vector3,new r.Vector3],this.vertexNormalsLength=0,this.color=new r.Color,this.material=null,this.uvs=[new r.Vector2,new r.Vector2,new r.Vector2],this.z=0},r.RenderableObject=function(){this.id=0,this.object=null,this.z=0},r.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new r.Vector2,this.material=null},r.RenderableLine=function(){this.id=0,this.v1=new r.RenderableVertex,this.v2=new r.RenderableVertex,this.vertexColors=[new r.Color,new r.Color],this.material=null,this.z=0},r.GeometryUtils={merge:function(e,t,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;t instanceof r.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},r.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,n,i){var s=new r.ImageLoader;s.crossOrigin=this.crossOrigin;var o=new r.Texture(undefined,t);return s.load(e,function(e){o.image=e,o.needsUpdate=!0,n&&n(o)},undefined,function(e){i&&i(e)}),o.sourceFile=e,o},loadTextureCube:function(e,t,n,i){var s=[],o=new r.ImageLoader;o.crossOrigin=this.crossOrigin;var u=new r.CubeTexture(s,t);u.flipY=!1;var a=0,f=function(t){o.load(e[t],function(e){u.images[t]=e,a+=1,a===6&&(u.needsUpdate=!0,n&&n(u))})};for(var l=0,c=e.length;l<c;++l)f(l);return u},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var s=e.width,o=e.height,u=document.createElement("canvas");u.width=s,u.height=o;var a=u.getContext("2d");a.drawImage(e,0,0);var f=a.getImageData(0,0,s,o).data,l=a.createImageData(s,o),c=l.data;for(var h=0;h<s;h++)for(var p=0;p<o;p++){var d=p-1<0?0:p-1,v=p+1>o-1?o-1:p+1,m=h-1<0?0:h-1,g=h+1>s-1?s-1:h+1,y=[],b=[0,0,f[(p*s+h)*4]/255*t];y.push([-1,0,f[(p*s+m)*4]/255*t]),y.push([-1,-1,f[(d*s+m)*4]/255*t]),y.push([0,-1,f[(d*s+h)*4]/255*t]),y.push([1,-1,f[(d*s+g)*4]/255*t]),y.push([1,0,f[(p*s+g)*4]/255*t]),y.push([1,1,f[(v*s+g)*4]/255*t]),y.push([0,1,f[(v*s+h)*4]/255*t]),y.push([-1,1,f[(v*s+m)*4]/255*t]);var w=[],E=y.length;for(var S=0;S<E;S++){var x=y[S],T=y[(S+1)%E];x=r(x,b),T=r(T,b),w.push(i(n(x,T)))}var N=[0,0,0];for(var S=0;S<w.length;S++)N[0]+=w[S][0],N[1]+=w[S][1],N[2]+=w[S][2];N[0]/=w.length,N[1]/=w.length,N[2]/=w.length;var C=(p*s+h)*4;c[C]=(N[0]+1)/2*255|0,c[C+1]=(N[1]+1)/2*255|0,c[C+2]=N[2]*255|0,c[C+3]=255}return a.putImageData(l,0,0),u},generateDataTexture:function(e,t,n){var i=e*t,s=new Uint8Array(3*i),o=Math.floor(n.r*255),u=Math.floor(n.g*255),a=Math.floor(n.b*255);for(var f=0;f<i;f++)s[f*3]=o,s[f*3+1]=u,s[f*3+2]=a;var l=new r.DataTexture(s,e,t,r.RGBFormat);return l.needsUpdate=!0,l}},r.SceneUtils={createMultiMaterialObject:function(e,t){var n=new r.Object3D;for(var i=0,s=t.length;i<s;i++)n.add(new r.Mesh(e,t[i]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var i=new r.Matrix4;i.getInverse(n.matrixWorld),e.applyMatrix(i),t.remove(e),n.add(e)}},r.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),n=this;n.faces[t]=n.faces[t]||{},n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{},n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var r=n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],n=[],i,s,o=this.getFace(),u=this.size/o.resolution,a=0,f=String(e).split(""),l=f.length,c=[];for(i=0;i<l;i++){var h=new r.Path,p=this.extractGlyphPoints(f[i],o,u,a,h);a+=p.offset,c.push(p.path)}var d=a/2;return{paths:c,offset:d}},extractGlyphPoints:function(e,t,n,i,s){var o=[],u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=t.glyphs[e]||t.glyphs["?"];if(!C)return;if(C.o){l=C._cachedOutline||(C._cachedOutline=C.o.split(" ")),h=l.length,p=n,d=n;for(u=0;u<h;){c=l[u++];switch(c){case"m":v=l[u++]*p+i,m=l[u++]*d,s.moveTo(v,m);break;case"l":v=l[u++]*p+i,m=l[u++]*d,s.lineTo(v,m);break;case"q":g=l[u++]*p+i,y=l[u++]*d,E=l[u++]*p+i,S=l[u++]*d,s.quadraticCurveTo(E,S,g,y),N=o[o.length-1];if(N){b=N.x,w=N.y;for(a=1,f=this.divisions;a<=f;a++)var k=a/f,L=r.Shape.Utils.b2(k,b,E,g),A=r.Shape.Utils.b2(k,w,S,y)}break;case"b":g=l[u++]*p+i,y=l[u++]*d,E=l[u++]*p+i,S=l[u++]*d,x=l[u++]*p+i,T=l[u++]*d,s.bezierCurveTo(E,S,x,T,g,y),N=o[o.length-1];if(N){b=N.x,w=N.y;for(a=1,f=this.divisions;a<=f;a++)var k=a/f,L=r.Shape.Utils.b3(k,b,E,x,g),A=r.Shape.Utils.b3(k,w,S,T,y)}}}}return{offset:C.ha*n,path:s}}},r.FontUtils.generateShapes=function(e,t){t=t||{};var n=t.size!==undefined?t.size:100,i=t.curveSegments!==undefined?t.curveSegments:4,s=t.font!==undefined?t.font:"helvetiker",o=t.weight!==undefined?t.weight:"normal",u=t.style!==undefined?t.style:"normal";r.FontUtils.size=n,r.FontUtils.divisions=i,r.FontUtils.face=s,r.FontUtils.weight=o,r.FontUtils.style=u;var a=r.FontUtils.drawText(e),f=a.paths,l=[];for(var c=0,h=f.length;c<h;c++)Array.prototype.push.apply(l,f[c].toShapes());return l},function(e){var t=1e-10,n=function(e,t){var n=e.length;if(n<3)return null;var s=[],o=[],u=[],a,f,l;if(r(e)>0)for(f=0;f<n;f++)o[f]=f;else for(f=0;f<n;f++)o[f]=n-1-f;var c=n,h=2*c;for(f=c-1;c>2;){if(h--<=0)return console.log("Warning, unable to triangulate polygon!"),t?u:s;a=f,c<=a&&(a=0),f=a+1,c<=f&&(f=0),l=f+1,c<=l&&(l=0);if(i(e,a,f,l,c,o)){var p,d,v,m,g;p=o[a],d=o[f],v=o[l],s.push([e[p],e[d],e[v]]),u.push([o[a],o[f],o[l]]);for(m=f,g=f+1;g<c;m++,g++)o[m]=o[g];c--,h=2*c}}return t?u:s},r=function(e){var t=e.length,n=0;for(var r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5},i=function(e,n,r,i,s,o){var u,a,f,l,c,h,p,d,v;a=e[o[n]].x,f=e[o[n]].y,l=e[o[r]].x,c=e[o[r]].y,h=e[o[i]].x,p=e[o[i]].y;if(t>(l-a)*(p-f)-(c-f)*(h-a))return!1;var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;m=h-l,g=p-c,y=a-h,b=f-p,w=l-a,E=c-f;for(u=0;u<s;u++){d=e[o[u]].x,v=e[o[u]].y;if(d===a&&v===f||d===l&&v===c||d===h&&v===p)continue;S=d-a,x=v-f,T=d-l,N=v-c,C=d-h,k=v-p,O=m*N-g*T,L=w*x-E*S,A=y*k-b*C;if(O>=-t&&A>=-t&&L>=-t)return!1}return!0};return e.Triangulate=n,e.Triangulate.area=r,e}(r.FontUtils),self._typeface_js={faces:r.FontUtils.faces,loadFace:r.FontUtils.loadFace},r.typeface_js=self._typeface_js,r.Curve=function(){},r.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},r.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},r.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},r.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},r.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},r.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t},r.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},r.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;t?s=t:s=e*n[i-1];var o=0,u=i-1,a;while(o<=u){r=Math.floor(o+(u-o)/2),a=n[r]-s;if(a<0){o=r+1;continue}if(a>0){u=r-1;continue}u=r;break}r=u;if(n[r]==s){var f=r/(i-1);return f}var l=n[r],c=n[r+1],h=c-l,p=(s-l)/h,f=(r+p)/(i-1);return f},r.Curve.prototype.getTangent=function(e){var t=1e-4,n=e-t,r=e+t;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),s=this.getPoint(r),o=s.clone().sub(i);return o.normalize()},r.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},r.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){var s=6*e*e-6*e,o=3*e*e-4*e+1,u=-6*e*e+6*e,a=3*e*e-2*e;return s+o+u+a},interpolate:function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t}},r.Curve.create=function(e,t){return e.prototype=Object.create(r.Curve.prototype),e.prototype.getPoint=t,e},r.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},r.CurvePath.prototype=Object.create(r.Curve.prototype),r.CurvePath.prototype.add=function(e){this.curves.push(e)},r.CurvePath.prototype.checkConnection=function(){},r.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new r.LineCurve(t,e))},r.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength(),n=this.getCurveLengths(),r=0,i,s;while(r<n.length){if(n[r]>=t){i=n[r]-t,s=this.curves[r];var o=1-i/s.getLength();return s.getPointAt(o)}r++}return null},r.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},r.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},r.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,i,s,o,u;t=n=Number.NEGATIVE_INFINITY,s=o=Number.POSITIVE_INFINITY;var a,f,l,c,h=e[0]instanceof r.Vector3;c=h?new r.Vector3:new r.Vector2;for(f=0,l=e.length;f<l;f++)a=e[f],a.x>t?t=a.x:a.x<s&&(s=a.x),a.y>n?n=a.y:a.y<o&&(o=a.y),h&&(a.z>i?i=a.z:a.z<u&&(u=a.z)),c.add(a);var p={minX:s,minY:o,maxX:t,maxY:n};return h&&(p.maxZ=i,p.minZ=u),p},r.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},r.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},r.CurvePath.prototype.createGeometry=function(e){var t=new r.Geometry;for(var n=0;n<e.length;n++)t.vertices.push(new r.Vector3(e[n].x,e[n].y,e[n].z||0));return t},r.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},r.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends);for(r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},r.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends);for(r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},r.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;for(r=0,i=e.length;r<i;r++){s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o);var f=t.getPoint(a),l=t.getTangent(a);l.set(-l.y,l.x).multiplyScalar(u),s.x=f.x+l.x,s.y=f.y+l.y}return e},r.Gyroscope=function(){r.Object3D.call(this)},r.Gyroscope.prototype=Object.create(r.Object3D.prototype),r.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},r.Gyroscope.prototype.translationWorld=new r.Vector3,r.Gyroscope.prototype.translationObject=new r.Vector3,r.Gyroscope.prototype.quaternionWorld=new r.Quaternion,r.Gyroscope.prototype.quaternionObject=new r.Quaternion,r.Gyroscope.prototype.scaleWorld=new r.Vector3,r.Gyroscope.prototype.scaleObject=new r.Vector3,r.Path=function(e){r.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},r.Path.prototype=Object.create(r.CurvePath.prototype),r.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},r.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},r.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:r.PathActions.MOVE_TO,args:n})},r.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,s=i[i.length-2],o=i[i.length-1],u=new r.LineCurve(new r.Vector2(s,o),new r.Vector2(e,t));this.curves.push(u),this.actions.push({action:r.PathActions.LINE_TO,args:n})},r.Path.prototype.quadraticCurveTo=function(e,t,n,i){var s=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,u=o[o.length-2],a=o[o.length-1],f=new r.QuadraticBezierCurve(new r.Vector2(u,a),new r.Vector2(e,t),new r.Vector2(n,i));this.curves.push(f),this.actions.push({action:r.PathActions.QUADRATIC_CURVE_TO,args:s})},r.Path.prototype.bezierCurveTo=function(e,t,n,i,s,o){var u=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,f=a[a.length-2],l=a[a.length-1],c=new r.CubicBezierCurve(new r.Vector2(f,l),new r.Vector2(e,t),new r.Vector2(n,i),new r.Vector2(s,o));this.curves.push(c),this.actions.push({action:r.PathActions.BEZIER_CURVE_TO,args:u})},r.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,i=n[n.length-2],s=n[n.length-1],o=[new r.Vector2(i,s)];Array.prototype.push.apply(o,e);var u=new r.SplineCurve(o);this.curves.push(u),this.actions.push({action:r.PathActions.CSPLINE_THRU,args:t})},r.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args,u=o[o.length-2],a=o[o.length-1];this.absarc(e+u,t+a,n,r,i,s)},r.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},r.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args,a=u[u.length-2],f=u[u.length-1];this.absellipse(e+a,t+f,n,r,i,s,o)},r.Path.prototype.absellipse=function(e,t,n,i,s,o,u){var a=Array.prototype.slice.call(arguments),f=new r.EllipseCurve(e,t,n,i,s,o,u);this.curves.push(f);var l=f.getPoint(1);a.push(l.x),a.push(l.y),this.actions.push({action:r.PathActions.ELLIPSE,args:a})},r.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);var n=[];for(var r=0;r<e;r++)n.push(this.getPoint(r/e));return n},r.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n=[],i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;for(i=0,s=this.actions.length;i<s;i++){o=this.actions[i],u=o.action,a=o.args;switch(u){case r.PathActions.MOVE_TO:n.push(new r.Vector2(a[0],a[1]));break;case r.PathActions.LINE_TO:n.push(new r.Vector2(a[0],a[1]));break;case r.PathActions.QUADRATIC_CURVE_TO:f=a[2],l=a[3],p=a[0],d=a[1],n.length>0?(g=n[n.length-1],v=g.x,m=g.y):(g=this.actions[i-1].args,v=g[g.length-2],m=g[g.length-1]);for(y=1;y<=e;y++)b=y/e,w=r.Shape.Utils.b2(b,v,p,f),E=r.Shape.Utils.b2(b,m,d,l),n.push(new r.Vector2(w,E));break;case r.PathActions.BEZIER_CURVE_TO:f=a[4],l=a[5],p=a[0],d=a[1],c=a[2],h=a[3],n.length>0?(g=n[n.length-1],v=g.x,m=g.y):(g=this.actions[i-1].args,v=g[g.length-2],m=g[g.length-1]);for(y=1;y<=e;y++)b=y/e,w=r.Shape.Utils.b3(b,v,p,c,f),E=r.Shape.Utils.b3(b,m,d,h,l),n.push(new r.Vector2(w,E));break;case r.PathActions.CSPLINE_THRU:g=this.actions[i-1].args;var S=new r.Vector2(g[g.length-2],g[g.length-1]),x=[S],T=e*a[0].length;x=x.concat(a[0]);var N=new r.SplineCurve(x);for(y=1;y<=T;y++)n.push(N.getPointAt(y/T));break;case r.PathActions.ARC:var C=a[0],k=a[1],L=a[2],A=a[3],O=a[4],M=!!a[5],_=O-A,D,P=e*2;for(y=1;y<=P;y++)b=y/P,M||(b=1-b),D=A+b*_,w=C+L*Math.cos(D),E=k+L*Math.sin(D),n.push(new r.Vector2(w,E));break;case r.PathActions.ELLIPSE:var C=a[0],k=a[1],H=a[2],B=a[3],A=a[4],O=a[5],M=!!a[6],_=O-A,D,P=e*2;for(y=1;y<=P;y++)b=y/P,M||(b=1-b),D=A+b*_,w=C+H*Math.cos(D),E=k+B*Math.sin(D),n.push(new r.Vector2(w,E))}}var j=n[n.length-1],F=1e-10;return Math.abs(j.x-n[0].x)<F&&Math.abs(j.y-n[0].y)<F&&n.splice(n.length-1,1),t&&n.push(n[0]),n},r.Path.prototype.toShapes=function(e,t){function n(e){var t,n,i,s,o,u=[],a=new r.Path;for(t=0,n=e.length;t<n;t++)i=e[t],o=i.args,s=i.action,s==r.PathActions.MOVE_TO&&a.actions.length!=0&&(u.push(a),a=new r.Path),a[s].apply(a,o);return a.actions.length!=0&&u.push(a),u}function i(e){var t=[];for(var n=0,i=e.length;n<i;n++){var s=e[n],o=new r.Shape;o.actions=s.actions,o.curves=s.curves,t.push(o)}return t}function s(e,t){var n=1e-10,r=t.length,i=!1;for(var s=r-1,o=0;o<r;s=o++){var u=t[s],a=t[o],f=a.x-u.x,l=a.y-u.y;if(Math.abs(l)>n){l<0&&(u=t[o],f=-f,a=t[s],l=-l);if(e.y<u.y||e.y>a.y)continue;if(e.y==u.y){if(e.x==u.x)return!0}else{var c=l*(e.x-u.x)-f*(e.y-u.y);if(c==0)return!0;if(c<0)continue;i=!i}}else{if(e.y!=u.y)continue;if(a.x<=e.x&&e.x<=u.x||u.x<=e.x&&e.x<=a.x)return!0}}return i}var o=n(this.actions);if(o.length==0)return[];if(t===!0)return i(o);var u,a,f,l=[];if(o.length==1)return a=o[0],f=new r.Shape,f.actions=a.actions,f.curves=a.curves,l.push(f),l;var c=!r.Shape.Utils.isClockWise(o[0].getPoints());c=e?!c:c;var h=[],p=[],d=[],v=0,m;p[v]=undefined,d[v]=[];var g,y;for(g=0,y=o.length;g<y;g++)a=o[g],m=a.getPoints(),u=r.Shape.Utils.isClockWise(m),u=e?!u:u,u?(!c&&p[v]&&v++,p[v]={s:new r.Shape,p:m},p[v].s.actions=a.actions,p[v].s.curves=a.curves,c&&v++,d[v]=[]):d[v].push({h:a,p:m[0]});if(!p[0])return i(o);if(p.length>1){var b=!1,w=[];for(var E=0,S=p.length;E<S;E++)h[E]=[];for(var E=0,S=p.length;E<S;E++){var x=p[E],T=d[E];for(var N=0;N<T.length;N++){var C=T[N],k=!0;for(var L=0;L<p.length;L++)s(C.p,p[L].p)&&(E!=L&&w.push({froms:E,tos:L,hole:N}),k?(k=!1,h[L].push(C)):b=!0);k&&h[E].push(C)}}w.length>0&&(b||(d=h))}var A,O,M;for(g=0,y=p.length;g<y;g++){f=p[g].s,l.push(f),A=d[g];for(O=0,M=A.length;O<M;O++)f.holes.push(A[O].h)}return l},r.Shape=function(){r.Path.apply(this,arguments),this.holes=[]},r.Shape.prototype=Object.create(r.Path.prototype),r.Shape.prototype.extrude=function(e){var t=new r.ExtrudeGeometry(this,e);return t},r.Shape.prototype.makeGeometry=function(e){var t=new r.ShapeGeometry(this,e);return t},r.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},r.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},r.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},r.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},r.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},r.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function i(e,t,r,i,s){var o=1e-10,u=t.x-e.x,a=t.y-e.y,f=i.x-r.x,l=i.y-r.y,c=e.x-r.x,h=e.y-r.y,p=a*f-u*l,d=a*c-u*h;if(Math.abs(p)>o){var v;if(p>0){if(d<0||d>p)return[];v=l*c-f*h;if(v<0||v>p)return[]}else{if(d>0||d<p)return[];v=l*c-f*h;if(v>0||v<p)return[]}if(v==0)return!s||d!=0&&d!=p?[e]:[];if(v==p)return!s||d!=0&&d!=p?[t]:[];if(d==0)return[r];if(d==p)return[i];var m=v/p;return[{x:e.x+m*u,y:e.y+m*a}]}if(d!=0||l*c!=f*h)return[];var g=u==0&&a==0,y=f==0&&l==0;if(g&&y)return e.x!=r.x||e.y!=r.y?[]:[e];if(g)return n(r,i,e)?[e]:[];if(y)return n(e,t,r)?[r]:[];var b,w,E,S,x,T,N,C;u!=0?(e.x<t.x?(b=e,E=e.x,w=t,S=t.x):(b=t,E=t.x,w=e,S=e.x),r.x<i.x?(x=r,N=r.x,T=i,C=i.x):(x=i,N=i.x,T=r,C=r.x)):(e.y<t.y?(b=e,E=e.y,w=t,S=t.y):(b=t,E=t.y,w=e,S=e.y),r.y<i.y?(x=r,N=r.y,T=i,C=i.y):(x=i,N=i.y,T=r,C=r.y));if(E<=N)return S<N?[]:S==N?s?[]:[x]:S<=C?[x,w]:[x,T];return E>C?[]:E==C?s?[]:[b]:S<=C?[b,w]:[b,T]}function s(e,t,n,r){var i=1e-10,s=t.x-e.x,o=t.y-e.y,u=n.x-e.x,a=n.y-e.y,f=r.x-e.x,l=r.y-e.y,c=s*a-o*u,h=s*l-o*f;if(Math.abs(c)>i){var p=f*a-l*u;return c>0?h>=0&&p>=0:h>=0||p>=0}return h>0}function o(e,t){function o(e,t){var i=n.length-1,o=e-1;o<0&&(o=i);var u=e+1;u>i&&(u=0);var a=s(n[e],n[o],n[u],r[t]);if(!a)return!1;var f=r.length-1,l=t-1;l<0&&(l=f);var c=t+1;return c>f&&(c=0),a=s(r[t],r[l],r[c],n[e]),a?!0:!1}function u(e,t){var r,s,o;for(r=0;r<n.length;r++){s=r+1,s%=n.length,o=i(e,t,n[r],n[s],!0);if(o.length>0)return!0}return!1}function f(e,n){var r,s,o,u,f;for(r=0;r<a.length;r++){s=t[a[r]];for(o=0;o<s.length;o++){u=o+1,u%=s.length,f=i(e,n,s[o],s[u],!0);if(f.length>0)return!0}}return!1}var n=e.concat(),r,a=[],l,c,h,p,d,v,m=[],g,y,b,w;for(var E=0,S=t.length;E<S;E++)a.push(E);var x=0,T=a.length*2;while(a.length>0){T--;if(T<0){console.log("Infinite Loop! Holes left:"+a.length+", Probably Hole outside Shape!");break}for(c=x;c<n.length;c++){h=n[c],l=-1;for(var E=0;E<a.length;E++){d=a[E],v=h.x+":"+h.y+":"+d;if(m[v]!==undefined)continue;r=t[d];for(var N=0;N<r.length;N++){p=r[N];if(!o(c,N))continue;if(u(h,p))continue;if(f(h,p))continue;l=N,a.splice(E,1),g=n.slice(0,c+1),y=n.slice(c),b=r.slice(l),w=r.slice(0,l+1),n=g.concat(b).concat(w).concat(y),x=c;break}if(l>=0)break;m[v]=!0}if(l>=0)break}}return n}var u,a,f,l,c,h,p={},d=e.concat();for(var v=0,m=t.length;v<m;v++)Array.prototype.push.apply(d,t[v]);for(u=0,a=d.length;u<a;u++)c=d[u].x+":"+d[u].y,p[c]!==undefined&&console.log("Duplicate point",c),p[c]=u;var g=o(e,t),y=r.FontUtils.Triangulate(g,!1);for(u=0,a=y.length;u<a;u++){l=y[u];for(f=0;f<3;f++)c=l[f].x+":"+l[f].y,h=p[c],h!==undefined&&(l[f]=h)}return y.concat()},isClockWise:function(e){return r.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){var n=1-e;return 3*n*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},r.LineCurve=function(e,t){this.v1=e,this.v2=t},r.LineCurve.prototype=Object.create(r.Curve.prototype),r.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},r.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},r.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},r.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},r.QuadraticBezierCurve.prototype=Object.create(r.Curve.prototype),r.QuadraticBezierCurve.prototype.getPoint=function(e){var t,n;return t=r.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=r.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new r.Vector2(t,n)},r.QuadraticBezierCurve.prototype.getTangent=function(e){var t,n;t=r.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),n=r.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var i=new r.Vector2(t,n);return i.normalize(),i},r.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},r.CubicBezierCurve.prototype=Object.create(r.Curve.prototype),r.CubicBezierCurve.prototype.getPoint=function(e){var t,n;return t=r.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=r.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new r.Vector2(t,n)},r.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=r.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=r.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new r.Vector2(t,n);return i.normalize(),i},r.SplineCurve=function(e){this.points=e==undefined?[]:e},r.SplineCurve.prototype=Object.create(r.Curve.prototype),r.SplineCurve.prototype.getPoint=function(e){var t=new r.Vector2,n=[],i=this.points,s,o,u;return s=(i.length-1)*e,o=Math.floor(s),u=s-o,n[0]=o==0?o:o-1,n[1]=o,n[2]=o>i.length-2?i.length-1:o+1,n[3]=o>i.length-3?i.length-1:o+2,t.x=r.Curve.Utils.interpolate(i[n[0]].x,i[n[1]].x,i[n[2]].x,i[n[3]].x,u),t.y=r.Curve.Utils.interpolate(i[n[0]].y,i[n[1]].y,i[n[2]].y,i[n[3]].y,u),t},r.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},r.EllipseCurve.prototype=Object.create(r.Curve.prototype),r.EllipseCurve.prototype.getPoint=function(e){var t,n=this.aEndAngle-this.aStartAngle;n<0&&(n+=Math.PI*2),n>Math.PI*2&&(n-=Math.PI*2),this.aClockwise===!0?t=this.aEndAngle+(1-e)*(Math.PI*2-n):t=this.aStartAngle+e*n;var i=this.aX+this.xRadius*Math.cos(t),s=this.aY+this.yRadius*Math.sin(t);return new r.Vector2(i,s)},r.ArcCurve=function(e,t,n,i,s,o){r.EllipseCurve.call(this,e,t,n,n,i,s,o)},r.ArcCurve.prototype=Object.create(r.EllipseCurve.prototype),r.LineCurve3=r.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new r.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),r.QuadraticBezierCurve3=r.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n,i;return t=r.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=r.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=r.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new r.Vector3(t,n,i)}),r.CubicBezierCurve3=r.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n,i;return t=r.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=r.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=r.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new r.Vector3(t,n,i)}),r.SplineCurve3=r.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=new r.Vector3,n=[],i=this.points,s,o,u;s=(i.length-1)*e,o=Math.floor(s),u=s-o,n[0]=o==0?o:o-1,n[1]=o,n[2]=o>i.length-2?i.length-1:o+1,n[3]=o>i.length-3?i.length-1:o+2;var a=i[n[0]],f=i[n[1]],l=i[n[2]],c=i[n[3]];return t.x=r.Curve.Utils.interpolate(a.x,f.x,l.x,c.x,u),t.y=r.Curve.Utils.interpolate(a.y,f.y,l.y,c.y,u),t.z=r.Curve.Utils.interpolate(a.z,f.z,l.z,c.z,u),t}),r.ClosedSplineCurve3=r.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=new r.Vector3,n=[],i=this.points,s,o,u;return s=(i.length-0)*e,o=Math.floor(s),u=s-o,o+=o>0?0:(Math.floor(Math.abs(o)/i.length)+1)*i.length,n[0]=(o-1)%i.length,n[1]=o%i.length,n[2]=(o+1)%i.length,n[3]=(o+2)%i.length,t.x=r.Curve.Utils.interpolate(i[n[0]].x,i[n[1]].x,i[n[2]].x,i[n[3]].x,u),t.y=r.Curve.Utils.interpolate(i[n[0]].y,i[n[1]].y,i[n[2]].y,i[n[3]].y,u),t.z=r.Curve.Utils.interpolate(i[n[0]].z,i[n[1]].z,i[n[2]].z,i[n[3]].z,u),t}),r.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===!0)return;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++){e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0);if(e.hierarchy[t].keys[n].rot!==undefined&&!(e.hierarchy[t].keys[n].rot instanceof r.Quaternion)){var i=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=(new r.Quaternion).fromArray(i)}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var s={};for(var n=0;n<e.hierarchy[t].keys.length;n++)for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++){var u=e.hierarchy[t].keys[n].morphTargets[o];s[u]=-1}e.hierarchy[t].usedMorphTargets=s;for(var n=0;n<e.hierarchy[t].keys.length;n++){var a={};for(var u in s){for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++)if(e.hierarchy[t].keys[n].morphTargets[o]===u){a[u]=e.hierarchy[t].keys[n].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[n].morphTargets.length&&(a[u]=0)}e.hierarchy[t].keys[n].morphTargetsInfluences=a}}for(var n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(var n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},parse:function(e){var t=function(e,n){n.push(e);for(var r=0;r<e.children.length;r++)t(e.children[r],n)},n=[];if(e instanceof r.SkinnedMesh)for(var i=0;i<e.skeleton.bones.length;i++)n.push(e.skeleton.bones[i]);else t(e,n);return n},play:function(e){this.animations.indexOf(e)===-1&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);t!==-1&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},r.Animation=function(e,t){this.root=e,this.data=r.AnimationHandler.init(t),this.hierarchy=r.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=r.AnimationHandler.LINEAR},r.Animation.prototype.keyTypes=["pos","rot","scl"],r.Animation.prototype.play=function(e,t){this.currentTime=e!==undefined?e:0,this.weight=t!==undefined?t:1,this.isPlaying=!0,this.reset(),r.AnimationHandler.play(this)},r.Animation.prototype.stop=function(){this.isPlaying=!1,r.AnimationHandler.stop(this)},r.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];n.matrixAutoUpdate=!0,n.animationCache===undefined&&(n.animationCache={}),n.animationCache[this.data.name]===undefined&&(n.animationCache[this.data.name]={},n.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},n.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},n.animationCache[this.data.name].originalMatrix=n.matrix);var r=n.animationCache[this.data.name];for(var i=0;i<3;i++){var s=this.keyTypes[i],o=this.data.hierarchy[e].keys[0],u=this.getNextKeyWith(s,e,1);while(u.time<this.currentTime&&u.index>o.index)o=u,u=this.getNextKeyWith(s,e,u.index+1);r.prevKey[s]=o,r.nextKey[s]=u}}},r.Animation.prototype.update=function(){var e=[],t=new r.Vector3,n=new r.Vector3,i=new r.Quaternion,s=function(e,t){var n=[],r=[],i,s,u,a,f,l,c,h,p;return i=(e.length-1)*t,s=Math.floor(i),u=i-s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,l=e[n[0]],c=e[n[1]],h=e[n[2]],p=e[n[3]],a=u*u,f=u*a,r[0]=o(l[0],c[0],h[0],p[0],u,a,f),r[1]=o(l[1],c[1],h[1],p[1],u,a,f),r[2]=o(l[2],c[2],h[2],p[2],u,a,f),r},o=function(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t};return function(o){if(this.isPlaying===!1)return;this.currentTime+=o*this.timeScale;if(this.weight===0)return;var u=this.data.length;if(this.loop===!0&&this.currentTime>u)this.currentTime%=u,this.reset();else if(this.loop===!1&&this.currentTime>u){this.stop();return}for(var a=0,f=this.hierarchy.length;a<f;a++){var l=this.hierarchy[a],c=l.animationCache[this.data.name];for(var h=0;h<3;h++){var p=this.keyTypes[h],d=c.prevKey[p],v=c.nextKey[p];if(v.time<=this.currentTime){d=this.data.hierarchy[a].keys[0],v=this.getNextKeyWith(p,a,1);while(v.time<this.currentTime&&v.index>d.index)d=v,v=this.getNextKeyWith(p,a,v.index+1);c.prevKey[p]=d,c.nextKey[p]=v}l.matrixAutoUpdate=!0,l.matrixWorldNeedsUpdate=!0;var m=(this.currentTime-d.time)/(v.time-d.time),g=d[p],y=v[p];m<0&&(m=0),m>1&&(m=1);if(p==="pos"){if(this.interpolationType===r.AnimationHandler.LINEAR){n.x=g[0]+(y[0]-g[0])*m,n.y=g[1]+(y[1]-g[1])*m,n.z=g[2]+(y[2]-g[2])*m;if(l instanceof r.Bone){var b=this.weight/(this.weight+l.accumulatedPosWeight);l.position.lerp(n,b),l.accumulatedPosWeight+=this.weight}else l.position.copy(n)}else if(this.interpolationType===r.AnimationHandler.CATMULLROM||this.interpolationType===r.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",a,d.index-1).pos,e[1]=g,e[2]=y,e[3]=this.getNextKeyWith("pos",a,v.index+1).pos,m=m*.33+.33;var w=s(e,m),b=1;l instanceof r.Bone&&(b=this.weight/(this.weight+l.accumulatedPosWeight),l.accumulatedPosWeight+=this.weight);var E=l.position;E.x=E.x+(w[0]-E.x)*b,E.y=E.y+(w[1]-E.y)*b,E.z=E.z+(w[2]-E.z)*b;if(this.interpolationType===r.AnimationHandler.CATMULLROM_FORWARD){var S=s(e,m*1.01);t.set(S[0],S[1],S[2]),t.sub(E),t.y=0,t.normalize();var x=Math.atan2(t.x,t.z);l.rotation.set(0,x,0)}}}else if(p==="rot"){r.Quaternion.slerp(g,y,i,m);if(l instanceof r.Bone)if(l.accumulatedRotWeight===0)l.quaternion.copy(i),l.accumulatedRotWeight=this.weight;else{var b=this.weight/(this.weight+l.accumulatedRotWeight);r.Quaternion.slerp(l.quaternion,i,l.quaternion,b),l.accumulatedRotWeight+=this.weight}else l.quaternion.copy(i)}else if(p==="scl"){n.x=g[0]+(y[0]-g[0])*m,n.y=g[1]+(y[1]-g[1])*m,n.z=g[2]+(y[2]-g[2])*m;if(l instanceof r.Bone){var b=this.weight/(this.weight+l.accumulatedSclWeight);l.scale.lerp(n,b),l.accumulatedSclWeight+=this.weight}else l.scale.copy(n)}}}return!0}}(),r.Animation.prototype.getNextKeyWith=function(e,t,n){var i=this.data.hierarchy[t].keys;this.interpolationType===r.AnimationHandler.CATMULLROM||this.interpolationType===r.AnimationHandler.CATMULLROM_FORWARD?n=n<i.length-1?n:i.length-1:n%=i.length;for(;n<i.length;n++)if(i[n][e]!==undefined)return i[n];return this.data.hierarchy[t].keys[0]},r.Animation.prototype.getPrevKeyWith=function(e,t,n){var i=this.data.hierarchy[t].keys;this.interpolationType===r.AnimationHandler.CATMULLROM||this.interpolationType===r.AnimationHandler.CATMULLROM_FORWARD?n=n>0?n:0:n=n>=0?n:n+i.length;for(;n>=0;n--)if(i[n][e]!==undefined)return i[n];return this.data.hierarchy[t].keys[i.length-1]},r.KeyFrameAnimation=function(e){this.root=e.node,this.data=r.AnimationHandler.init(e),this.hierarchy=r.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,n=this.hierarchy.length;t<n;t++){var i=this.data.hierarchy[t].keys,s=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(i.length&&s){for(var u=0;u<s.length;u++){var a=s[u],f=this.getNextKeyWith(a,t,0);f&&f.apply(a)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},r.KeyFrameAnimation.prototype.play=function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===!1){this.isPlaying=!0;var t,n=this.hierarchy.length,i,s;for(t=0;t<n;t++){i=this.hierarchy[t],s=this.data.hierarchy[t],s.animationCache===undefined&&(s.animationCache={},s.animationCache.prevKey=null,s.animationCache.nextKey=null,s.animationCache.originalMatrix=i.matrix);var o=this.data.hierarchy[t].keys;o.length&&(s.animationCache.prevKey=o[0],s.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,r.AnimationHandler.play(this)},r.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,r.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(n.animationCache!==undefined){var i=n.animationCache.originalMatrix;i.copy(t.matrix),t.matrix=i,delete n.animationCache}}},r.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying===!1)return;this.currentTime+=e*this.timeScale;var t=this.data.length;this.loop===!0&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.hierarchy[n],s=this.data.hierarchy[n],o=s.keys,u=s.animationCache;if(o.length){var a=u.prevKey,f=u.nextKey;if(f.time<=this.currentTime){while(f.time<this.currentTime&&f.index>a.index)a=f,f=o[a.index+1];u.prevKey=a,u.nextKey=f}f.time>=this.currentTime?a.interpolate(f,this.currentTime):a.interpolate(f,f.time),this.data.hierarchy[n].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}},r.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;n%=r.length;for(;n<r.length;n++)if(r[n].hasTarget(e))return r[n];return r[0]},r.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;n=n>=0?n:n+r.length;for(;n>=0;n--)if(r[n].hasTarget(e))return r[n];return r[r.length-1]},r.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},r.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,t=0;return function(n){if(this.isPlaying===!1)return;this.currentTime+=n,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var r=this.duration/this.frames,i=Math.floor(this.currentTime/r);i!=t&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[t]=1,this.mesh.morphTargetInfluences[i]=0,e=t,t=i),this.mesh.morphTargetInfluences[i]=this.currentTime%r/r,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[i]}}()},r.BoxGeometry=function(e,t,n,i,s,o){function c(e,t,n,i,s,o,a,f){var l,c,h,p=u.widthSegments,d=u.heightSegments,v=s/2,m=o/2,g=u.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x")l="z";else if(e==="x"&&t==="z"||e==="z"&&t==="x")l="y",d=u.depthSegments;else if(e==="z"&&t==="y"||e==="y"&&t==="z")l="x",p=u.depthSegments;var y=p+1,b=d+1,w=s/p,E=o/d,S=new r.Vector3;S[l]=a>0?1:-1;for(h=0;h<b;h++)for(c=0;c<y;c++){var x=new r.Vector3;x[e]=(c*w-v)*n,x[t]=(h*E-m)*i,x[l]=a,u.vertices.push(x)}for(h=0;h<d;h++)for(c=0;c<p;c++){var T=c+y*h,N=c+y*(h+1),C=c+1+y*(h+1),k=c+1+y*h,L=new r.Vector2(c/p,1-h/d),A=new r.Vector2(c/p,1-(h+1)/d),O=new r.Vector2((c+1)/p,1-(h+1)/d),M=new r.Vector2((c+1)/p,1-h/d),_=new r.Face3(T+g,N+g,k+g);_.normal.copy(S),_.vertexNormals.push(S.clone(),S.clone(),S.clone()),_.materialIndex=f,u.faces.push(_),u.faceVertexUvs[0].push([L,A,M]),_=new r.Face3(N+g,C+g,k+g),_.normal.copy(S),_.vertexNormals.push(S.clone(),S.clone(),S.clone()),_.materialIndex=f,u.faces.push(_),u.faceVertexUvs[0].push([A.clone(),O,M.clone()])}}r.Geometry.call(this),this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:o},this.widthSegments=i||1,this.heightSegments=s||1,this.depthSegments=o||1;var u=this,a=e/2,f=t/2,l=n/2;c("z","y",-1,-1,n,t,a,0),c("z","y",1,-1,n,t,-a,1),c("x","z",1,1,e,n,f,2),c("x","z",1,-1,e,n,-f,3),c("x","y",1,-1,e,t,l,4),c("x","y",-1,-1,e,t,-l,5),this.mergeVertices()},r.BoxGeometry.prototype=Object.create(r.Geometry.prototype),r.CircleGeometry=function(e,t,n,i){r.Geometry.call(this),this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||50,t=t!==undefined?Math.max(3,t):8,n=n!==undefined?n:0,i=i!==undefined?i:Math.PI*2;var s,o=[],u=new r.Vector3,a=new r.Vector2(.5,.5);this.vertices.push(u),o.push(a);for(s=0;s<=t;s++){var f=new r.Vector3,l=n+s/t*i;f.x=e*Math.cos(l),f.y=e*Math.sin(l),this.vertices.push(f),o.push(new r.Vector2((f.x/e+1)/2,(f.y/e+1)/2))}var c=new r.Vector3(0,0,1);for(s=1;s<=t;s++)this.faces.push(new r.Face3(s,s+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([o[s].clone(),o[s+1].clone(),a.clone()]);this.computeFaceNormals(),this.boundingSphere=new r.Sphere(new r.Vector3,e)},r.CircleGeometry.prototype=Object.create(r.Geometry.prototype),r.CubeGeometry=function(e,t,n,i,s,o){return console.warn("THEE.CubeGeometry has been renamed to THREE.BoxGeometry."),new r.BoxGeometry(e,t,n,i,s,o)},r.CylinderGeometry=function(e,t,n,i,s,o){r.Geometry.call(this),this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:o},e=e!==undefined?e:20,t=t!==undefined?t:20,n=n!==undefined?n:100,i=i||8,s=s||1,o=o!==undefined?o:!1;var u=n/2,a,f,l=[],c=[];for(f=0;f<=s;f++){var h=[],p=[],d=f/s,v=d*(t-e)+e;for(a=0;a<=i;a++){var m=a/i,g=new r.Vector3;g.x=v*Math.sin(m*Math.PI*2),g.y=-d*n+u,g.z=v*Math.cos(m*Math.PI*2),this.vertices.push(g),h.push(this.vertices.length-1),p.push(new r.Vector2(m,1-d))}l.push(h),c.push(p)}var y=(t-e)/n,b,w;for(a=0;a<i;a++){e!==0?(b=this.vertices[l[0][a]].clone(),w=this.vertices[l[0][a+1]].clone()):(b=this.vertices[l[1][a]].clone(),w=this.vertices[l[1][a+1]].clone()),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*y).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*y).normalize();for(f=0;f<s;f++){var E=l[f][a],S=l[f+1][a],x=l[f+1][a+1],T=l[f][a+1],N=b.clone(),C=b.clone(),k=w.clone(),L=w.clone(),A=c[f][a].clone(),O=c[f+1][a].clone(),M=c[f+1][a+1].clone(),_=c[f][a+1].clone();this.faces.push(new r.Face3(E,S,T,[N,C,L])),this.faceVertexUvs[0].push([A,O,_]),this.faces.push(new r.Face3(S,x,T,[C.clone(),k,L.clone()])),this.faceVertexUvs[0].push([O.clone(),M,_.clone()])}}if(o===!1&&e>0){this.vertices.push(new r.Vector3(0,u,0));for(a=0;a<i;a++){var E=l[0][a],S=l[0][a+1],x=this.vertices.length-1,N=new r.Vector3(0,1,0),C=new r.Vector3(0,1,0),k=new r.Vector3(0,1,0),A=c[0][a].clone(),O=c[0][a+1].clone(),M=new r.Vector2(O.x,0);this.faces.push(new r.Face3(E,S,x,[N,C,k])),this.faceVertexUvs[0].push([A,O,M])}}if(o===!1&&t>0){this.vertices.push(new r.Vector3(0,-u,0));for(a=0;a<i;a++){var E=l[f][a+1],S=l[f][a],x=this.vertices.length-1,N=new r.Vector3(0,-1,0),C=new r.Vector3(0,-1,0),k=new r.Vector3(0,-1,0),A=c[f][a+1].clone(),O=c[f][a].clone(),M=new r.Vector2(O.x,1);this.faces.push(new r.Face3(E,S,x,[N,C,k])),this.faceVertexUvs[0].push([A,O,M])}}this.computeFaceNormals()},r.CylinderGeometry.prototype=Object.create(r.Geometry.prototype),r.ExtrudeGeometry=function(e,t){if(typeof e=="undefined"){e=[];return}r.Geometry.call(this),e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()},r.ExtrudeGeometry.prototype=Object.create(r.Geometry.prototype),r.ExtrudeGeometry.prototype.addShapeList=function(e,t){var n=e.length;for(var r=0;r<n;r++){var i=e[r];this.addShape(i,t)}},r.ExtrudeGeometry.prototype.addShape=function(e,t){function _(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function W(e,t,n){var i=1e-10,s=r.Math.sign,o,u,a=1,f=e.x-t.x,l=e.y-t.y,c=n.x-e.x,h=n.y-e.y,p=f*f+l*l,d=f*h-l*c;if(Math.abs(d)>i){var v=Math.sqrt(p),m=Math.sqrt(c*c+h*h),g=t.x-l/v,y=t.y+f/v,b=n.x-h/m,w=n.y+c/m,E=((b-g)*h-(w-y)*c)/(f*h-l*c);o=g+f*E-e.x,u=y+l*E-e.y;var S=o*o+u*u;if(S<=2)return new r.Vector2(o,u);a=Math.sqrt(S/2)}else{var x=!1;f>i?c>i&&(x=!0):f<-i?c<-i&&(x=!0):s(l)==s(h)&&(x=!0),x?(o=-l,u=f,a=Math.sqrt(p)):(o=f,u=l,a=Math.sqrt(p/2))}return new r.Vector2(o/a,u/a)}function rt(){if(u){var e=0,t=F*e;for(V=0;V<q;V++)I=O[V],ut(I[2]+t,I[1]+t,I[0]+t,!0);e=f+o*2,t=F*e;for(V=0;V<q;V++)I=O[V],ut(I[0]+t,I[1]+t,I[2]+t,!1)}else{for(V=0;V<q;V++)I=O[V],ut(I[2],I[1],I[0],!0);for(V=0;V<q;V++)I=O[V],ut(I[0]+F*f,I[1]+F*f,I[2]+F*f,!1)}}function it(){var e=0;st(M,e),e+=M.length;for(E=0,S=L.length;E<S;E++)w=L[E],st(w,e),e+=w.length}function st(e,t){var n,r;V=e.length;while(--V>=0){n=V,r=V-1,r<0&&(r=e.length-1);var i=0,s=f+o*2;for(i=0;i<s;i++){var u=F*i,a=F*(i+1),l=t+n+u,c=t+r+u,h=t+r+a,p=t+n+a;at(l,c,h,p,e,i,s,n,r)}}}function ot(e,t,n){x.vertices.push(new r.Vector3(e,t,n))}function ut(n,i,s,o){n+=N,i+=N,s+=N,x.faces.push(new r.Face3(n,i,s,null,null,p));var u=o?v.generateBottomUV(x,e,t,n,i,s):v.generateTopUV(x,e,t,n,i,s);x.faceVertexUvs[0].push(u)}function at(n,i,s,o,u,a,f,l,c){n+=N,i+=N,s+=N,o+=N,x.faces.push(new r.Face3(n,i,o,null,null,d)),x.faces.push(new r.Face3(i,s,o,null,null,d));var h=v.generateSideWallUV(x,e,u,t,n,i,s,o,a,f,l,c);x.faceVertexUvs[0].push([h[0],h[1],h[3]]),x.faceVertexUvs[0].push([h[1],h[2],h[3]])}var n=t.amount!==undefined?t.amount:100,i=t.bevelThickness!==undefined?t.bevelThickness:6,s=t.bevelSize!==undefined?t.bevelSize:i-2,o=t.bevelSegments!==undefined?t.bevelSegments:3,u=t.bevelEnabled!==undefined?t.bevelEnabled:!0,a=t.curveSegments!==undefined?t.curveSegments:12,f=t.steps!==undefined?t.steps:1,l=t.extrudePath,c,h=!1,p=t.material,d=t.extrudeMaterial,v=t.UVGenerator!==undefined?t.UVGenerator:r.ExtrudeGeometry.WorldUVGenerator,m,g,y,b;l&&(c=l.getSpacedPoints(f),h=!0,u=!1,m=t.frames!==undefined?t.frames:new r.TubeGeometry.FrenetFrames(l,f,!1),g=new r.Vector3,y=new r.Vector3,b=new r.Vector3),u||(o=0,i=0,s=0);var w,E,S,x=this,T=[],N=this.vertices.length,C=e.extractPoints(a),k=C.shape,L=C.holes,A=!r.Shape.Utils.isClockWise(k);if(A){k=k.reverse();for(E=0,S=L.length;E<S;E++)w=L[E],r.Shape.Utils.isClockWise(w)&&(L[E]=w.reverse());A=!1}var O=r.Shape.Utils.triangulateShape(k,L),M=k;for(E=0,S=L.length;E<S;E++)w=L[E],k=k.concat(w);var D,P,H,B,j,F=k.length,I,q=O.length,R,U=M.length,z=180/Math.PI,X=[];for(var V=0,$=M.length,J=$-1,K=V+1;V<$;V++,J++,K++){J===$&&(J=0),K===$&&(K=0);var Q=M[V],G=M[J],Y=M[K];X[V]=W(M[V],M[J],M[K])}var Z=[],et,tt=X.concat();for(E=0,S=L.length;E<S;E++){w=L[E],et=[];for(V=0,$=w.length,J=$-1,K=V+1;V<$;V++,J++,K++)J===$&&(J=0),K===$&&(K=0),et[V]=W(w[V],w[J],w[K]);Z.push(et),tt=tt.concat(et)}for(D=0;D<o;D++){H=D/o,B=i*(1-H),P=s*Math.sin(H*Math.PI/2);for(V=0,$=M.length;V<$;V++)j=_(M[V],X[V],P),ot(j.x,j.y,-B);for(E=0,S=L.length;E<S;E++){w=L[E],et=Z[E];for(V=0,$=w.length;V<$;V++)j=_(w[V],et[V],P),ot(j.x,j.y,-B)}}P=s;for(V=0;V<F;V++)j=u?_(k[V],tt[V],P):k[V],h?(y.copy(m.normals[0]).multiplyScalar(j.x),g.copy(m.binormals[0]).multiplyScalar(j.y),b.copy(c[0]).add(y).add(g),ot(b.x,b.y,b.z)):ot(j.x,j.y,0);var nt;for(nt=1;nt<=f;nt++)for(V=0;V<F;V++)j=u?_(k[V],tt[V],P):k[V],h?(y.copy(m.normals[nt]).multiplyScalar(j.x),g.copy(m.binormals[nt]).multiplyScalar(j.y),b.copy(c[nt]).add(y).add(g),ot(b.x,b.y,b.z)):ot(j.x,j.y,n/f*nt);for(D=o-1;D>=0;D--){H=D/o,B=i*(1-H),P=s*Math.sin(H*Math.PI/2);for(V=0,$=M.length;V<$;V++)j=_(M[V],X[V],P),ot(j.x,j.y,n+B);for(E=0,S=L.length;E<S;E++){w=L[E],et=Z[E];for(V=0,$=w.length;V<$;V++)j=_(w[V],et[V],P),h?ot(j.x,j.y+c[f-1].y,c[f-1].x+B):ot(j.x,j.y,n+B)}}rt(),it()},r.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,i,s,o){var u=e.vertices[i].x,a=e.vertices[i].y,f=e.vertices[s].x,l=e.vertices[s].y,c=e.vertices[o].x,h=e.vertices[o].y;return[new r.Vector2(u,a),new r.Vector2(f,l),new r.Vector2(c,h)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,i,s,o,u,a,f,l,c,h){var p=e.vertices[s].x,d=e.vertices[s].y,v=e.vertices[s].z,m=e.vertices[o].x,g=e.vertices[o].y,y=e.vertices[o].z,b=e.vertices[u].x,w=e.vertices[u].y,E=e.vertices[u].z,S=e.vertices[a].x,x=e.vertices[a].y,T=e.vertices[a].z;return Math.abs(d-g)<.01?[new r.Vector2(p,1-v),new r.Vector2(m,1-y),new r.Vector2(b,1-E),new r.Vector2(S,1-T)]:[new r.Vector2(d,1-v),new r.Vector2(g,1-y),new r.Vector2(w,1-E),new r.Vector2(x,1-T)]}},r.ExtrudeGeometry.__v1=new r.Vector2,r.ExtrudeGeometry.__v2=new r.Vector2,r.ExtrudeGeometry.__v3=new r.Vector2,r.ExtrudeGeometry.__v4=new r.Vector2,r.ExtrudeGeometry.__v5=new r.Vector2,r.ExtrudeGeometry.__v6=new r.Vector2,r.ShapeGeometry=function(e,t){r.Geometry.call(this),e instanceof Array==0&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},r.ShapeGeometry.prototype=Object.create(r.Geometry.prototype),r.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},r.ShapeGeometry.prototype.addShape=function(e,t){t===undefined&&(t={});var n=t.curveSegments!==undefined?t.curveSegments:12,i=t.material,s=t.UVGenerator===undefined?r.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,o,u,a,f,l=this.vertices.length,c=e.extractPoints(n),h=c.shape,p=c.holes,d=!r.Shape.Utils.isClockWise(h);if(d){h=h.reverse();for(o=0,u=p.length;o<u;o++)a=p[o],r.Shape.Utils.isClockWise(a)&&(p[o]=a.reverse());d=!1}var v=r.Shape.Utils.triangulateShape(h,p),m=h;for(o=0,u=p.length;o<u;o++)a=p[o],h=h.concat(a);var g,y=h.length,b,w=v.length,E,S=m.length;for(o=0;o<y;o++)g=h[o],this.vertices.push(new r.Vector3(g.x,g.y,0));for(o=0;o<w;o++){b=v[o];var x=b[0]+l,T=b[1]+l,N=b[2]+l;this.faces.push(new r.Face3(x,T,N,null,null,i)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,x,T,N))}},r.LatheGeometry=function(e,t,n,i){r.Geometry.call(this),t=t||12,n=n||0,i=i||2*Math.PI;var s=1/(e.length-1),o=1/t;for(var u=0,a=t;u<=a;u++){var f=n+u*o*i,l=Math.cos(f),c=Math.sin(f);for(var h=0,p=e.length;h<p;h++){var d=e[h],v=new r.Vector3;v.x=l*d.x-c*d.y,v.y=c*d.x+l*d.y,v.z=d.z,this.vertices.push(v)}}var m=e.length;for(var u=0,a=t;u<a;u++)for(var h=0,p=e.length-1;h<p;h++){var g=h+m*u,y=g,b=g+m,l=g+1+m,w=g+1,E=u*o,S=h*s,x=E+o,T=S+s;this.faces.push(new r.Face3(y,b,w)),this.faceVertexUvs[0].push([new r.Vector2(E,S),new r.Vector2(x,S),new r.Vector2(E,T)]),this.faces.push(new r.Face3(b,l,w)),this.faceVertexUvs[0].push([new r.Vector2(x,S),new r.Vector2(x,T),new r.Vector2(E,T)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},r.LatheGeometry.prototype=Object.create(r.Geometry.prototype),r.PlaneGeometry=function(e,t,n,i){r.Geometry.call(this),this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var s,o,u=e/2,a=t/2,f=n||1,l=i||1,c=f+1,h=l+1,p=e/f,d=t/l,v=new r.Vector3(0,0,1);for(o=0;o<h;o++){var m=o*d-a;for(s=0;s<c;s++){var g=s*p-u;this.vertices.push(new r.Vector3(g,-m,0))}}for(o=0;o<l;o++)for(s=0;s<f;s++){var y=s+c*o,b=s+c*(o+1),w=s+1+c*(o+1),E=s+1+c*o,S=new r.Vector2(s/f,1-o/l),x=new r.Vector2(s/f,1-(o+1)/l),T=new r.Vector2((s+1)/f,1-(o+1)/l),N=new r.Vector2((s+1)/f,1-o/l),C=new r.Face3(y,b,E);C.normal.copy(v),C.vertexNormals.push(v.clone(),v.clone(),v.clone()),this.faces.push(C),this.faceVertexUvs[0].push([S,x,N]),C=new r.Face3(b,w,E),C.normal.copy(v),C.vertexNormals.push(v.clone(),v.clone(),v.clone()),this.faces.push(C),this.faceVertexUvs[0].push([x.clone(),T,N.clone()])}},r.PlaneGeometry.prototype=Object.create(r.Geometry.prototype),r.RingGeometry=function(e,t,n,i,s,o){r.Geometry.call(this),e=e||0,t=t||50,s=s!==undefined?s:0,o=o!==undefined?o:Math.PI*2,n=n!==undefined?Math.max(3,n):8,i=i!==undefined?Math.max(1,i):8;var u,a,f=[],l=e,c=(t-e)/i;for(u=0;u<i+1;u++){for(a=0;a<n+1;a++){var h=new r.Vector3,p=s+a/n*o;h.x=l*Math.cos(p),h.y=l*Math.sin(p),this.vertices.push(h),f.push(new r.Vector2((h.x/t+1)/2,(h.y/t+1)/2))}l+=c}var d=new r.Vector3(0,0,1);for(u=0;u<i;u++){var v=u*(n+1);for(a=0;a<n;a++){var p=a+v,m=p,g=p+n+1,y=p+n+2;this.faces.push(new r.Face3(m,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([f[m].clone(),f[g].clone(),f[y].clone()]),m=p,g=p+n+2,y=p+1,this.faces.push(new r.Face3(m,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([f[m].clone(),f[g].clone(),f[y].clone()])}}this.computeFaceNormals(),this.boundingSphere=new r.Sphere(new r.Vector3,l)},r.RingGeometry.prototype=Object.create(r.Geometry.prototype),r.SphereGeometry=function(e,t,n,i,s,o,u){r.Geometry.call(this),this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:o,thetaLength:u},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=i!==undefined?i:0,s=s!==undefined?s:Math.PI*2,o=o!==undefined?o:0,u=u!==undefined?u:Math.PI;var a,f,l=[],c=[];for(f=0;f<=n;f++){var h=[],p=[];for(a=0;a<=t;a++){var d=a/t,v=f/n,m=new r.Vector3;m.x=-e*Math.cos(i+d*s)*Math.sin(o+v*u),m.y=e*Math.cos(o+v*u),m.z=e*Math.sin(i+d*s)*Math.sin(o+v*u),this.vertices.push(m),h.push(this.vertices.length-1),p.push(new r.Vector2(d,1-v))}l.push(h),c.push(p)}for(f=0;f<n;f++)for(a=0;a<t;a++){var g=l[f][a+1],y=l[f][a],b=l[f+1][a],w=l[f+1][a+1],E=this.vertices[g].clone().normalize(),S=this.vertices[y].clone().normalize(),x=this.vertices[b].clone().normalize(),T=this.vertices[w].clone().normalize(),N=c[f][a+1].clone(),C=c[f][a].clone(),k=c[f+1][a].clone(),L=c[f+1][a+1].clone();Math.abs(this.vertices[g].y)===e?(N.x=(N.x+C.x)/2,this.faces.push(new r.Face3(g,b,w,[E,x,T])),this.faceVertexUvs[0].push([N,k,L])):Math.abs(this.vertices[b].y)===e?(k.x=(k.x+L.x)/2,this.faces.push(new r.Face3(g,y,b,[E,S,x])),this.faceVertexUvs[0].push([N,C,k])):(this.faces.push(new r.Face3(g,y,w,[E,S,T])),this.faceVertexUvs[0].push([N,C,L]),this.faces.push(new r.Face3(y,b,w,[S.clone(),x,T.clone()])),this.faceVertexUvs[0].push([C.clone(),k,L.clone()]))}this.computeFaceNormals(),this.boundingSphere=new r.Sphere(new r.Vector3,e)},r.SphereGeometry.prototype=Object.create(r.Geometry.prototype),r.TextGeometry=function(e,t){t=t||{};var n=r.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50,t.bevelThickness===undefined&&(t.bevelThickness=10),t.bevelSize===undefined&&(t.bevelSize=8),t.bevelEnabled===undefined&&(t.bevelEnabled=!1),r.ExtrudeGeometry.call(this,n,t)},r.TextGeometry.prototype=Object.create(r.ExtrudeGeometry.prototype),r.TorusGeometry=function(e,t,n,i,s){r.Geometry.call(this),this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},e=e||100,t=t||40,n=n||8,i=i||6,s=s||Math.PI*2;var o=new r.Vector3,u=[],a=[];for(var f=0;f<=n;f++)for(var l=0;l<=i;l++){var c=l/i*s,h=f/n*Math.PI*2;o.x=e*Math.cos(c),o.y=e*Math.sin(c);var p=new r.Vector3;p.x=(e+t*Math.cos(h))*Math.cos(c),p.y=(e+t*Math.cos(h))*Math.sin(c),p.z=t*Math.sin(h),this.vertices.push(p),u.push(new r.Vector2(l/i,f/n)),a.push(p.clone().sub(o).normalize())}for(var f=1;f<=n;f++)for(var l=1;l<=i;l++){var d=(i+1)*f+l-1,v=(i+1)*(f-1)+l-1,m=(i+1)*(f-1)+l,g=(i+1)*f+l,y=new r.Face3(d,v,g,[a[d].clone(),a[v].clone(),a[g].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([u[d].clone(),u[v].clone(),u[g].clone()]),y=new r.Face3(v,m,g,[a[v].clone(),a[m].clone(),a[g].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([u[v].clone(),u[m].clone(),u[g].clone()])}this.computeFaceNormals()},r.TorusGeometry.prototype=Object.create(r.Geometry.prototype),r.TorusKnotGeometry=function(e,t,n,i,s,o,u){function M(e,t,n,i,s){var o=Math.cos(e),u=Math.sin(e),a=t/n*e,f=Math.cos(a),l=i*(2+f)*.5*o,c=i*(2+f)*u*.5,h=s*i*Math.sin(a)*.5;return new r.Vector3(l,c,h)}r.Geometry.call(this),this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,p:s,q:o,heightScale:u},e=e||100,t=t||40,n=n||64,i=i||8,s=s||2,o=o||3,u=u||1;var a=new Array(n),f=new r.Vector3,l=new r.Vector3,c=new r.Vector3;for(var h=0;h<n;++h){a[h]=new Array(i);var p=h/n*2*s*Math.PI,d=M(p,o,s,e,u),v=M(p+.01,o,s,e,u);f.subVectors(v,d),l.addVectors(v,d),c.crossVectors(f,l),l.crossVectors(c,f),c.normalize(),l.normalize();for(var m=0;m<i;++m){var g=m/i*2*Math.PI,y=-t*Math.cos(g),b=t*Math.sin(g),w=new r.Vector3;w.x=d.x+y*l.x+b*c.x,w.y=d.y+y*l.y+b*c.y,w.z=d.z+y*l.z+b*c.z,a[h][m]=this.vertices.push(w)-1}}for(var h=0;h<n;++h)for(var m=0;m<i;++m){var E=(h+1)%n,S=(m+1)%i,x=a[h][m],T=a[E][m],N=a[E][S],C=a[h][S],k=new r.Vector2(h/n,m/i),L=new r.Vector2((h+1)/n,m/i),A=new r.Vector2((h+1)/n,(m+1)/i),O=new r.Vector2(h/n,(m+1)/i);this.faces.push(new r.Face3(x,T,C)),this.faceVertexUvs[0].push([k,L,O]),this.faces.push(new r.Face3(T,N,C)),this.faceVertexUvs[0].push([L.clone(),A,O.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},r.TorusKnotGeometry.prototype=Object.create(r.Geometry.prototype),r.TubeGeometry=function(e,t,n,i,s){function q(e,t,n){return u.vertices.push(new r.Vector3(e,t,n))-1}r.Geometry.call(this),this.parameters={path:e,segments:t,radius:n,radialSegments:i,closed:s},t=t||64,n=n||1,i=i||8,s=s||!1;var o=[],u=this,a,f,l,c=t+1,h,p,d,v,m,g,y,b,w,E,S,x=new r.Vector3,T,N,C,k,L,A,O,M,_,D,P,H,B=new r.TubeGeometry.FrenetFrames(e,t,s),j=B.tangents,F=B.normals,I=B.binormals;this.tangents=j,this.normals=F,this.binormals=I;for(T=0;T<c;T++){o[T]=[],y=T/(c-1),S=e.getPointAt(y),a=j[T],f=F[T],l=I[T];for(N=0;N<i;N++)b=N/i*2*Math.PI,w=-n*Math.cos(b),E=n*Math.sin(b),x.copy(S),x.x+=w*f.x+E*l.x,x.y+=w*f.y+E*l.y,x.z+=w*f.z+E*l.z,o[T][N]=q(x.x,x.y,x.z)}for(T=0;T<t;T++)for(N=0;N<i;N++)C=s?(T+1)%t:T+1,k=(N+1)%i,L=o[T][N],A=o[C][N],O=o[C][k],M=o[T][k],_=new r.Vector2(T/t,N/i),D=new r.Vector2((T+1)/t,N/i),P=new r.Vector2((T+1)/t,(N+1)/i),H=new r.Vector2(T/t,(N+1)/i),this.faces.push(new r.Face3(L,A,M)),this.faceVertexUvs[0].push([_,D,H]),this.faces.push(new r.Face3(A,O,M)),this.faceVertexUvs[0].push([D.clone(),P,H.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},r.TubeGeometry.prototype=Object.create(r.Geometry.prototype),r.TubeGeometry.FrenetFrames=function(e,t,n){function S(){a[0]=new r.Vector3,f[0]=new r.Vector3,v=Number.MAX_VALUE,m=Math.abs(u[0].x),g=Math.abs(u[0].y),y=Math.abs(u[0].z),m<=v&&(v=m,s.set(1,0,0)),g<=v&&(v=g,s.set(0,1,0)),y<=v&&s.set(0,0,1),l.crossVectors(u[0],s).normalize(),a[0].crossVectors(u[0],l),f[0].crossVectors(u[0],a[0])}var i=new r.Vector3,s=new r.Vector3,o=new r.Vector3,u=[],a=[],f=[],l=new r.Vector3,c=new r.Matrix4,h=t+1,p,d=1e-4,v,m,g,y,b,w,E;this.tangents=u,this.normals=a,this.binormals=f;for(b=0;b<h;b++)w=b/(h-1),u[b]=e.getTangentAt(w),u[b].normalize();S();for(b=1;b<h;b++)a[b]=a[b-1].clone(),f[b]=f[b-1].clone(),l.crossVectors(u[b-1],u[b]),l.length()>d&&(l.normalize(),p=Math.acos(r.Math.clamp(u[b-1].dot(u[b]),-1,1)),a[b].applyMatrix4(c.makeRotationAxis(l,p))),f[b].crossVectors(u[b],a[b]);if(n){p=Math.acos(r.Math.clamp(a[0].dot(a[h-1]),-1,1)),p/=h-1,u[0].dot(l.crossVectors(a[0],a[h-1]))>0&&(p=-p);for(b=1;b<h;b++)a[b].applyMatrix4(c.makeRotationAxis(u[b],p*b)),f[b].crossVectors(u[b],a[b])}},r.PolyhedronGeometry=function(e,t,n,i){function S(e){var t=e.normalize().clone();t.index=s.vertices.push(t)-1;var n=N(e)/2/Math.PI+.5,i=C(e)/Math.PI+.5;return t.uv=new r.Vector2(n,1-i),t}function x(e,t,n){var i=new r.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);s.faces.push(i),v.copy(e).add(t).add(n).divideScalar(3);var o=N(v);s.faceVertexUvs[0].push([k(e.uv,e,o),k(t.uv,t,o),k(n.uv,n,o)])}function T(e,t){var n=Math.pow(2,t),r=Math.pow(4,t),i=S(s.vertices[e.a]),o=S(s.vertices[e.b]),u=S(s.vertices[e.c]),a=[];for(var f=0;f<=n;f++){a[f]=[];var l=S(i.clone().lerp(u,f/n)),c=S(o.clone().lerp(u,f/n)),h=n-f;for(var p=0;p<=h;p++)p==0&&f==n?a[f][p]=l:a[f][p]=S(l.clone().lerp(c,p/h))}for(var f=0;f<n;f++)for(var p=0;p<2*(n-f)-1;p++){var d=Math.floor(p/2);p%2==0?x(a[f][d+1],a[f+1][d],a[f][d]):x(a[f][d+1],a[f+1][d+1],a[f+1][d])}}function N(e){return Math.atan2(e.z,-e.x)}function C(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function k(e,t,n){return n<0&&e.x===1&&(e=new r.Vector2(e.x-1,e.y)),t.x===0&&t.z===0&&(e=new r.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}r.Geometry.call(this),n=n||1,i=i||0;var s=this;for(var o=0,u=e.length;o<u;o+=3)S(new r.Vector3(e[o],e[o+1],e[o+2]));var a=[],f=this.vertices,l=[];for(var o=0,c=0,u=t.length;o<u;o+=3,c++){var h=f[t[o]],p=f[t[o+1]],d=f[t[o+2]];l[c]=new r.Face3(h.index,p.index,d.index,[h.clone(),p.clone(),d.clone()])}var v=new r.Vector3;for(var o=0,u=l.length;o<u;o++)T(l[o],i);for(var o=0,u=this.faceVertexUvs[0].length;o<u;o++){var m=this.faceVertexUvs[0][o],g=m[0].x,y=m[1].x,b=m[2].x,w=Math.max(g,Math.max(y,b)),E=Math.min(g,Math.min(y,b));w>.9&&E<.1&&(g<.2&&(m[0].x+=1),y<.2&&(m[1].x+=1),b<.2&&(m[2].x+=1))}for(var o=0,u=this.vertices.length;o<u;o++)this.vertices[o].multiplyScalar(n);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new r.Sphere(new r.Vector3,n)},r.PolyhedronGeometry.prototype=Object.create(r.Geometry.prototype),r.IcosahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];r.PolyhedronGeometry.call(this,i,s,e,t)},r.IcosahedronGeometry.prototype=Object.create(r.Geometry.prototype),r.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];r.PolyhedronGeometry.call(this,n,i,e,t)},r.OctahedronGeometry.prototype=Object.create(r.Geometry.prototype),r.TetrahedronGeometry=function(e,t){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];r.PolyhedronGeometry.call(this,n,i,e,t)},r.TetrahedronGeometry.prototype=Object.create(r.Geometry.prototype),r.ParametricGeometry=function(e,t,n){r.Geometry.call(this);var i=this.vertices,s=this.faces,o=this.faceVertexUvs[0],u,a,f,l,c,h,p=n+1,d=t+1;for(u=0;u<=n;u++){h=u/n;for(f=0;f<=t;f++)c=f/t,l=e(c,h),i.push(l)}var v,m,g,y,b,w,E,S;for(u=0;u<n;u++)for(f=0;f<t;f++)v=u*d+f,m=u*d+f+1,g=(u+1)*d+f+1,y=(u+1)*d+f,b=new r.Vector2(f/t,u/n),w=new r.Vector2((f+1)/t,u/n),E=new r.Vector2((f+1)/t,(u+1)/n),S=new r.Vector2(f/t,(u+1)/n),s.push(new r.Face3(v,m,y)),o.push([b,w,S]),s.push(new r.Face3(m,g,y)),o.push([w.clone(),E,S.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},r.ParametricGeometry.prototype=Object.create(r.Geometry.prototype),r.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new r.BufferGeometry;i.addAttribute("position",new r.BufferAttribute(t,3)),i.addAttribute("color",new r.BufferAttribute(n,3));var s=new r.LineBasicMaterial({vertexColors:r.VertexColors});r.Line.call(this,i,s,r.LinePieces)},r.AxisHelper.prototype=Object.create(r.Line.prototype),r.ArrowHelper=function(){var e=new r.Geometry;e.vertices.push(new r.Vector3(0,0,0),new r.Vector3(0,1,0));var t=new r.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new r.Matrix4).makeTranslation(0,-0.5,0)),function(n,i,s,o,u,a){r.Object3D.call(this),o===undefined&&(o=16776960),s===undefined&&(s=1),u===undefined&&(u=.2*s),a===undefined&&(a=.2*u),this.position.copy(i),this.line=new r.Line(e,new r.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new r.Mesh(t,new r.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(s,u,a)}}(),r.ArrowHelper.prototype=Object.create(r.Object3D.prototype),r.ArrowHelper.prototype.setDirection=function(){var e=new r.Vector3,t;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-0.99999?this.quaternion.set(1,0,0,0):(e.set(n.z,0,-n.x).normalize(),t=Math.acos(n.y),this.quaternion.setFromAxisAngle(e,t))}}(),r.ArrowHelper.prototype.setLength=function(e,t,n){t===undefined&&(t=.2*e),n===undefined&&(n=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},r.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},r.BoxHelper=function(e){var t=new r.BufferGeometry;t.addAttribute("position",new r.BufferAttribute(new Float32Array(72),3)),r.Line.call(this,t,new r.LineBasicMaterial({color:16776960}),r.LinePieces),e!==undefined&&this.update(e)},r.BoxHelper.prototype=Object.create(r.Line.prototype),r.BoxHelper.prototype.update=function(e){var t=e.geometry;t.boundingBox===null&&t.computeBoundingBox();var n=t.boundingBox.min,r=t.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=n.x,i[4]=r.y,i[5]=r.z,i[6]=n.x,i[7]=r.y,i[8]=r.z,i[9]=n.x,i[10]=n.y,i[11]=r.z,i[12]=n.x,i[13]=n.y,i[14]=r.z,i[15]=r.x,i[16]=n.y,i[17]=r.z,i[18]=r.x,i[19]=n.y,i[20]=r.z,i[21]=r.x,i[22]=r.y,i[23]=r.z,i[24]=r.x,i[25]=r.y,i[26]=n.z,i[27]=n.x,i[28]=r.y,i[29]=n.z,i[30]=n.x,i[31]=r.y,i[32]=n.z,i[33]=n.x,i[34]=n.y,i[35]=n.z,i[36]=n.x,i[37]=n.y,i[38]=n.z,i[39]=r.x,i[40]=n.y,i[41]=n.z,i[42]=r.x,i[43]=n.y,i[44]=n.z,i[45]=r.x,i[46]=r.y,i[47]=n.z,i[48]=r.x,i[49]=r.y,i[50]=r.z,i[51]=r.x,i[52]=r.y,i[53]=n.z,i[54]=n.x,i[55]=r.y,i[56]=r.z,i[57]=n.x,i[58]=r.y,i[59]=n.z,i[60]=n.x,i[61]=n.y,i[62]=r.z,i[63]=n.x,i[64]=n.y,i[65]=n.z,i[66]=r.x,i[67]=n.y,i[68]=r.z,i[69]=r.x,i[70]=n.y,i[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},r.BoundingBoxHelper=function(e,t){var n=t!==undefined?t:8947848;this.object=e,this.box=new r.Box3,r.Mesh.call(this,new r.BoxGeometry(1,1,1),new r.MeshBasicMaterial({color:n,wireframe:!0}))},r.BoundingBoxHelper.prototype=Object.create(r.Mesh.prototype),r.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},r.CameraHelper=function(e){function l(e,t,n){c(e,n),c(t,n)}function c(e,n){t.vertices.push(new r.Vector3),t.colors.push(new r.Color(n)),i[e]===undefined&&(i[e]=[]),i[e].push(t.vertices.length-1)}var t=new r.Geometry,n=new r.LineBasicMaterial({color:16777215,vertexColors:r.FaceColors}),i={},s=16755200,o=16711680,u=43775,a=16777215,f=3355443;l("n1","n2",s),l("n2","n4",s),l("n4","n3",s),l("n3","n1",s),l("f1","f2",s),l("f2","f4",s),l("f4","f3",s),l("f3","f1",s),l("n1","f1",s),l("n2","f2",s),l("n3","f3",s),l("n4","f4",s),l("p","n1",o),l("p","n2",o),l("p","n3",o),l("p","n4",o),l("u1","u2",u),l("u2","u3",u),l("u3","u1",u),l("c","t",a),l("p","c",f),l("cn1","cn2",f),l("cn3","cn4",f),l("cf1","cf2",f),l("cf3","cf4",f),r.Line.call(this,t,n,r.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},r.CameraHelper.prototype=Object.create(r.Line.prototype),r.CameraHelper.prototype.update=function(){var e=new r.Vector3,t=new r.Camera,n=new r.Projector;return function(){function o(i,s,o,u){e.set(s,o,u),n.unprojectVector(e,t);var a=r.pointMap[i];if(a!==undefined)for(var f=0,l=a.length;f<l;f++)r.geometry.vertices[a[f]].copy(e)}var r=this,i=1,s=1;t.projectionMatrix.copy(this.camera.projectionMatrix),o("c",0,0,-1),o("t",0,0,1),o("n1",-i,-s,-1),o("n2",i,-s,-1),o("n3",-i,s,-1),o("n4",i,s,-1),o("f1",-i,-s,1),o("f2",i,-s,1),o("f3",-i,s,1),o("f4",i,s,1),o("u1",i*.7,s*1.1,-1),o("u2",-i*.7,s*1.1,-1),o("u3",0,s*2,-1),o("cf1",-i,0,1),o("cf2",i,0,1),o("cf3",0,-s,1),o("cf4",0,s,1),o("cn1",-i,0,-1),o("cn2",i,0,-1),o("cn3",0,-s,-1),o("cn4",0,s,-1),this.geometry.verticesNeedUpdate=!0}}(),r.DirectionalLightHelper=function(e,t){r.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new r.Geometry;n.vertices.push(new r.Vector3(-t,t,0),new r.Vector3(t,t,0),new r.Vector3(t,-t,0),new r.Vector3(-t,-t,0),new r.Vector3(-t,t,0));var i=new r.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new r.Line(n,i),this.add(this.lightPlane),n=new r.Geometry,n.vertices.push(new r.Vector3,new r.Vector3),i=new r.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new r.Line(n,i),this.add(this.targetLine),this.update()},r.DirectionalLightHelper.prototype=Object.create(r.Object3D.prototype),r.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},r.DirectionalLightHelper.prototype.update=function(){var e=new r.Vector3,t=new r.Vector3,n=new r.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),r.EdgesHelper=function(e,t){var n=t!==undefined?t:16777215,i=[0,0],s={},o=function(e,t){return e-t},u=["a","b","c"],a=new r.BufferGeometry,f=e.geometry.clone();f.mergeVertices(),f.computeFaceNormals();var l=f.vertices,c=f.faces,h=0;for(var p=0,d=c.length;p<d;p++){var v=c[p];for(var m=0;m<3;m++){i[0]=v[u[m]],i[1]=v[u[(m+1)%3]],i.sort(o);var g=i.toString();s[g]===undefined?(s[g]={vert1:i[0],vert2:i[1],face1:p,face2:undefined},h++):s[g].face2=p}}a.addAttribute("position",new r.Float32Attribute(h*2*3,3));var y=a.attributes.position.array,b=0;for(var g in s){var w=s[g];if(w.face2===undefined||c[w.face1].normal.dot(c[w.face2].normal)<.9999){var E=l[w.vert1];y[b++]=E.x,y[b++]=E.y,y[b++]=E.z,E=l[w.vert2],y[b++]=E.x,y[b++]=E.y,y[b++]=E.z}}r.Line.call(this,a,new r.LineBasicMaterial({color:n}),r.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},r.EdgesHelper.prototype=Object.create(r.Line.prototype),r.FaceNormalsHelper=function(e,t,n,i){this.object=e,this.size=t!==undefined?t:1;var s=n!==undefined?n:16776960,o=i!==undefined?i:1,u=new r.Geometry,a=this.object.geometry.faces;for(var f=0,l=a.length;f<l;f++)u.vertices.push(new r.Vector3,new r.Vector3);r.Line.call(this,u,new r.LineBasicMaterial({color:s,linewidth:o}),r.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new r.Matrix3,this.update()},r.FaceNormalsHelper.prototype=Object.create(r.Line.prototype),r.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,r=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var s=0,o=0,u=r.length;s<u;s++,o+=2){var a=r[s];e[o].copy(n[a.a]).add(n[a.b]).add(n[a.c]).divideScalar(3).applyMatrix4(i),e[o+1].copy(a.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[o])}return this.geometry.verticesNeedUpdate=!0,this},r.GridHelper=function(e,t){var n=new r.Geometry,i=new r.LineBasicMaterial({vertexColors:r.VertexColors});this.color1=new r.Color(4473924),this.color2=new r.Color(8947848);for(var s=-e;s<=e;s+=t){n.vertices.push(new r.Vector3(-e,0,s),new r.Vector3(e,0,s),new r.Vector3(s,0,-e),new r.Vector3(s,0,e));var o=s===0?this.color1:this.color2;n.colors.push(o,o,o,o)}r.Line.call(this,n,i,r.LinePieces)},r.GridHelper.prototype=Object.create(r.Line.prototype),r.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},r.HemisphereLightHelper=function(e,t,n,i){r.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new r.Color,new r.Color];var s=new r.SphereGeometry(t,4,2);s.applyMatrix((new r.Matrix4).makeRotationX(-Math.PI/2));for(var o=0,u=8;o<u;o++)s.faces[o].color=this.colors[o<4?0:1];var a=new r.MeshBasicMaterial({vertexColors:r.FaceColors,wireframe:!0});this.lightSphere=new r.Mesh(s,a),this.add(this.lightSphere),this.update()},r.HemisphereLightHelper.prototype=Object.create(r.Object3D.prototype),r.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},r.HemisphereLightHelper.prototype.update=function(){var e=new r.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),r.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new r.SphereGeometry(t,4,2),i=new r.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),r.Mesh.call(this,n,i),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},r.PointLightHelper.prototype=Object.create(r.Mesh.prototype),r.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},r.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},r.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new r.Geometry;for(var n=0;n<this.bones.length;n++){var i=this.bones[n];i.parent instanceof r.Bone&&(t.vertices.push(new r.Vector3),t.vertices.push(new r.Vector3),t.colors.push(new r.Color(0,0,1)),t.colors.push(new r.Color(0,1,0)))}var s=new r.LineBasicMaterial({vertexColors:r.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});r.Line.call(this,t,s,r.LinePieces),this.root=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},r.SkeletonHelper.prototype=Object.create(r.Line.prototype),r.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof r.Bone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,this.getBoneList(e.children[n]));return t},r.SkeletonHelper.prototype.update=function(){var e=this.geometry,t=(new r.Matrix4).getInverse(this.root.matrixWorld),n=new r.Matrix4,i=0;for(var s=0;s<this.bones.length;s++){var o=this.bones[s];o.parent instanceof r.Bone&&(n.multiplyMatrices(t,o.matrixWorld),e.vertices[i].setFromMatrixPosition(n),n.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(n),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},r.SpotLightHelper=function(e){r.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new r.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new r.Matrix4).makeTranslation(0,-0.5,0)),t.applyMatrix((new r.Matrix4).makeRotationX(-Math.PI/2));var n=new r.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new r.Mesh(t,n),this.add(this.cone),this.update()},r.SpotLightHelper.prototype=Object.create(r.Object3D.prototype),r.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},r.SpotLightHelper.prototype.update=function(){var e=new r.Vector3,t=new r.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),r.VertexNormalsHelper=function(e,t,n,i){this.object=e,this.size=t!==undefined?t:1;var s=n!==undefined?n:16711680,o=i!==undefined?i:1,u=new r.Geometry,a=e.geometry.vertices,f=e.geometry.faces;for(var l=0,c=f.length;l<c;l++){var h=f[l];for(var p=0,d=h.vertexNormals.length;p<d;p++)u.vertices.push(new r.Vector3,new r.Vector3)}r.Line.call(this,u,new r.LineBasicMaterial({color:s,linewidth:o}),r.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new r.Matrix3,this.update()},r.VertexNormalsHelper.prototype=Object.create(r.Line.prototype),r.VertexNormalsHelper.prototype.update=function(e){var t=new r.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var r=this.geometry.vertices,i=this.object.geometry.vertices,s=this.object.geometry.faces,o=this.object.matrixWorld,u=0;for(var a=0,f=s.length;a<f;a++){var l=s[a];for(var c=0,h=l.vertexNormals.length;c<h;c++){var p=l[n[c]],d=i[p],v=l.vertexNormals[c];r[u].copy(d).applyMatrix4(o),t.copy(v).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(r[u]),u+=1,r[u].copy(t),u+=1}}return this.geometry.verticesNeedUpdate=!0,this}}(),r.VertexTangentsHelper=function(e,t,n,i){this.object=e,this.size=t!==undefined?t:1;var s=n!==undefined?n:255,o=i!==undefined?i:1,u=new r.Geometry,a=e.geometry.vertices,f=e.geometry.faces;for(var l=0,c=f.length;l<c;l++){var h=f[l];for(var p=0,d=h.vertexTangents.length;p<d;p++)u.vertices.push(new r.Vector3),u.vertices.push(new r.Vector3)}r.Line.call(this,u,new r.LineBasicMaterial({color:s,linewidth:o}),r.LinePieces),this.matrixAutoUpdate=!1,this.update()},r.VertexTangentsHelper.prototype=Object.create(r.Line.prototype),r.VertexTangentsHelper.prototype.update=function(e){var t=new r.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0);var r=this.geometry.vertices,i=this.object.geometry.vertices,s=this.object.geometry.faces,o=this.object.matrixWorld,u=0;for(var a=0,f=s.length;a<f;a++){var l=s[a];for(var c=0,h=l.vertexTangents.length;c<h;c++){var p=l[n[c]],d=i[p],v=l.vertexTangents[c];r[u].copy(d).applyMatrix4(o),t.copy(v).transformDirection(o).multiplyScalar(this.size),t.add(r[u]),u+=1,r[u].copy(t),u+=1}}return this.geometry.verticesNeedUpdate=!0,this}}(),r.WireframeHelper=function(e,t){var n=t!==undefined?t:16777215,i=[0,0],s={},o=function(e,t){return e-t},u=["a","b","c"],a=new r.BufferGeometry;if(e.geometry instanceof r.Geometry){var f=e.geometry.vertices,l=e.geometry.faces,c=0,h=new Uint32Array(6*l.length);for(var p=0,d=l.length;p<d;p++){var v=l[p];for(var m=0;m<3;m++){i[0]=v[u[m]],i[1]=v[u[(m+1)%3]],i.sort(o);var g=i.toString();s[g]===undefined&&(h[2*c]=i[0],h[2*c+1]=i[1],s[g]=!0,c++)}}var y=new Float32Array(c*2*3);for(var p=0,d=c;p<d;p++)for(var m=0;m<2;m++){var b=f[h[2*p+m]],w=6*p+3*m;y[w+0]=b.x,y[w+1]=b.y,y[w+2]=b.z}a.addAttribute("position",new r.BufferAttribute(y,3))}else if(e.geometry instanceof r.BufferGeometry)if(e.geometry.attributes.index!==undefined){var f=e.geometry.attributes.position.array,E=e.geometry.attributes.index.array,S=e.geometry.offsets,c=0,h=new Uint32Array(2*E.length);for(var x=0,T=S.length;x<T;++x){var N=S[x].start,C=S[x].count,w=S[x].index;for(var p=N,k=N+C;p<k;p+=3)for(var m=0;m<3;m++){i[0]=w+E[p+m],i[1]=w+E[p+(m+1)%3],i.sort(o);var g=i.toString();s[g]===undefined&&(h[2*c]=i[0],h[2*c+1]=i[1],s[g]=!0,c++)}}var y=new Float32Array(c*2*3);for(var p=0,d=c;p<d;p++)for(var m=0;m<2;m++){var w=6*p+3*m,L=3*h[2*p+m];y[w+0]=f[L],y[w+1]=f[L+1],y[w+2]=f[L+2]}a.addAttribute("position",new r.BufferAttribute(y,3))}else{var f=e.geometry.attributes.position.array,c=f.length/3,A=c/3,y=new Float32Array(c*2*3);for(var p=0,d=A;p<d;p++)for(var m=0;m<3;m++){var w=18*p+6*m,O=9*p+3*m;y[w+0]=f[O],y[w+1]=f[O+1],y[w+2]=f[O+2];var L=9*p+3*((m+1)%3);y[w+3]=f[L],y[w+4]=f[L+1],y[w+5]=f[L+2]}a.addAttribute("position",new r.BufferAttribute(y,3))}r.Line.call(this,a,new r.LineBasicMaterial({color:n}),r.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},r.WireframeHelper.prototype=Object.create(r.Line.prototype),r.ImmediateRenderObject=function(){r.Object3D.call(this),this.render=function(e){}},r.ImmediateRenderObject.prototype=Object.create(r.Object3D.prototype),r.LensFlare=function(e,t,n,i,s){r.Object3D.call(this),this.lensFlares=[],this.positionScreen=new r.Vector3,this.customUpdateCallback=undefined,e!==undefined&&this.add(e,t,n,i,s)},r.LensFlare.prototype=Object.create(r.Object3D.prototype),r.LensFlare.prototype.add=function(e,t,n,i,s,o){t===undefined&&(t=-1),n===undefined&&(n=0),o===undefined&&(o=1),s===undefined&&(s=new r.Color(16777215)),i===undefined&&(i=r.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:s,blending:i})},r.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=-this.positionScreen.x*2,i=-this.positionScreen.y*2;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=(n.wantedRotation-n.rotation)*.25},r.MorphBlendMesh=function(e,t){r.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,i="__default",s=0,o=n-1,u=n/1;this.createAnimation(i,s,o,u),this.setAnimationWeight(i,1)},r.MorphBlendMesh.prototype=Object.create(r.Mesh.prototype),r.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){var i={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},r.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/,n,r={},i=this.geometry;for(var s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s],a=u.name.match(t);if(a&&a.length>1){var f=a[1],l=a[2];r[f]||(r[f]={start:Infinity,end:-Infinity});var c=r[f];s<c.start&&(c.start=s),s>c.end&&(c.end=s),n||(n=f)}}for(var f in r){var c=r[f];this.createAnimation(f,c.start,c.end,e)}this.firstAnimation=n},r.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},r.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},r.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},r.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},r.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},r.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},r.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},r.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},r.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},r.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},r.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var i=this.animationsList[t];if(!i.active)continue;var s=i.duration/i.length;i.time+=i.direction*e;if(i.mirroredLoop){if(i.time>i.duration||i.time<0)i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)}else i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration);var o=i.startFrame+r.Math.clamp(Math.floor(i.time/s),0,i.length-1),u=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*u,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var a=i.time%s/s;i.directionBackwards&&(a=1-a),this.morphTargetInfluences[i.currentFrame]=a*u,this.morphTargetInfluences[i.lastFrame]=(1-a)*u}},r.LensFlarePlugin=function(){function o(e,n){var r=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),s=t.createShader(t.VERTEX_SHADER),o="precision "+n+" float;\n";return t.shaderSource(i,o+e.fragmentShader),t.shaderSource(s,o+e.vertexShader),t.compileShader(i),t.compileShader(s),t.attachShader(r,i),t.attachShader(r,s),t.linkProgram(r),r}var e=[],t,n,i,s={};this.init=function(e){t=e.context,n=e,i=e.getPrecision(),s.vertices=new Float32Array(16),s.faces=new Uint16Array(6);var u=0;s.vertices[u++]=-1,s.vertices[u++]=-1,s.vertices[u++]=0,s.vertices[u++]=0,s.vertices[u++]=1,s.vertices[u++]=-1,s.vertices[u++]=1,s.vertices[u++]=0,s.vertices[u++]=1,s.vertices[u++]=1,s.vertices[u++]=1,s.vertices[u++]=1,s.vertices[u++]=-1,s.vertices[u++]=1,s.vertices[u++]=0,s.vertices[u++]=1,u=0,s.faces[u++]=0,s.faces[u++]=1,s.faces[u++]=2,s.faces[u++]=0,s.faces[u++]=2,s.faces[u++]=3,s.vertexBuffer=t.createBuffer(),s.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,s.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s.faces,t.STATIC_DRAW),s.tempTexture=t.createTexture(),s.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,s.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,s.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(s.hasVertexTexture=!1,s.program=o(r.ShaderFlares.lensFlare,i)):(s.hasVertexTexture=!0,s.program=o(r.ShaderFlares.lensFlareVertexTexture,i)),s.attributes={},s.uniforms={},s.attributes.vertex=t.getAttribLocation(s.program,"position"),s.attributes.uv=t.getAttribLocation(s.program,"uv"),s.uniforms.renderType=t.getUniformLocation(s.program,"renderType"),s.uniforms.map=t.getUniformLocation(s.program,"map"),s.uniforms.occlusionMap=t.getUniformLocation(s.program,"occlusionMap"),s.uniforms.opacity=t.getUniformLocation(s.program,"opacity"),s.uniforms.color=t.getUniformLocation(s.program,"color"),s.uniforms.scale=t.getUniformLocation(s.program,"scale"),s.uniforms.rotation=t.getUniformLocation(s.program,"rotation"),s.uniforms.screenPosition=t.getUniformLocation(s.program,"screenPosition")},this.render=function(i,o,u,a){e.length=0,i.traverseVisible(function(t){t instanceof r.LensFlare&&e.push(t)});if(e.length===0)return;var f=new r.Vector3,l=a/u,c=u*.5,h=a*.5,p=16/a,d=new r.Vector2(p*l,p),v=new r.Vector3(1,1,0),m=new r.Vector2(1,1),g=s.uniforms,y=s.attributes;t.useProgram(s.program),t.enableVertexAttribArray(s.attributes.vertex),t.enableVertexAttribArray(s.attributes.uv),t.uniform1i(g.occlusionMap,0),t.uniform1i(g.map,1),t.bindBuffer(t.ARRAY_BUFFER,s.vertexBuffer),t.vertexAttribPointer(y.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(y.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);for(var b=0,w=e.length;b<w;b++){p=16/a,d.set(p*l,p);var E=e[b];f.set(E.matrixWorld.elements[12],E.matrixWorld.elements[13],E.matrixWorld.elements[14]),f.applyMatrix4(o.matrixWorldInverse),f.applyProjection(o.projectionMatrix),v.copy(f),m.x=v.x*c+c,m.y=v.y*h+h;if(s.hasVertexTexture||m.x>0&&m.x<u&&m.y>0&&m.y<a){t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,m.x-8,m.y-8,16,16,0),t.uniform1i(g.renderType,0),t.uniform2f(g.scale,d.x,d.y),t.uniform3f(g.screenPosition,v.x,v.y,v.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,m.x-8,m.y-8,16,16,0),t.uniform1i(g.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),E.positionScreen.copy(v),E.customUpdateCallback?E.customUpdateCallback(E):E.updateLensFlares(),t.uniform1i(g.renderType,2),t.enable(t.BLEND);for(var S=0,x=E.lensFlares.length;S<x;S++){var T=E.lensFlares[S];T.opacity>.001&&T.scale>.001&&(v.x=T.x,v.y=T.y,v.z=T.z,p=T.size*T.scale/a,d.x=p*l,d.y=p,t.uniform3f(g.screenPosition,v.x,v.y,v.z),t.uniform2f(g.scale,d.x,d.y),t.uniform1f(g.rotation,T.rotation),t.uniform1f(g.opacity,T.opacity),t.uniform3f(g.color,T.color.r,T.color.g,T.color.b),n.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),n.setTexture(T.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}}t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}},r.ShadowMapPlugin=function(){function p(e,t,n){if(t.visible){var r=e.__webglObjects[t.id];if(r&&t.castShadow&&(t.frustumCulled===!1||u.intersectsObject(t)===!0))for(var i=0,s=r.length;i<s;i++){var o=r[i];t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),h.push(o)}for(var i=0,s=t.children.length;i<s;i++)p(e,t.children[i],n)}}function d(e,t){var n=new r.DirectionalLight;n.isVirtual=!0,n.onlyShadow=!0,n.castShadow=!0,n.shadowCameraNear=e.shadowCameraNear,n.shadowCameraFar=e.shadowCameraFar,n.shadowCameraLeft=e.shadowCameraLeft,n.shadowCameraRight=e.shadowCameraRight,n.shadowCameraBottom=e.shadowCameraBottom,n.shadowCameraTop=e.shadowCameraTop,n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t],n.shadowMapWidth=e.shadowCascadeWidth[t],n.shadowMapHeight=e.shadowCascadeHeight[t],n.pointsWorld=[],n.pointsFrustum=[];var i=n.pointsWorld,s=n.pointsFrustum;for(var o=0;o<8;o++)i[o]=new r.Vector3,s[o]=new r.Vector3;var u=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t];return s[0].set(-1,-1,u),s[1].set(1,-1,u),s[2].set(-1,1,u),s[3].set(1,1,u),s[4].set(-1,-1,a),s[5].set(1,-1,a),s[6].set(-1,1,a),s[7].set(1,1,a),n}function v(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],s=n.pointsFrustum;s[0].z=r,s[1].z=r,s[2].z=r,s[3].z=r,s[4].z=i,s[5].z=i,s[6].z=i,s[7].z=i}function m(e,t){var n=t.shadowCamera,i=t.pointsFrustum,s=t.pointsWorld;f.set(Infinity,Infinity,Infinity),l.set(-Infinity,-Infinity,-Infinity);for(var o=0;o<8;o++){var u=s[o];u.copy(i[o]),r.ShadowMapPlugin.__projector.unprojectVector(u,e),u.applyMatrix4(n.matrixWorldInverse),u.x<f.x&&(f.x=u.x),u.x>l.x&&(l.x=u.x),u.y<f.y&&(f.y=u.y),u.y>l.y&&(l.y=u.y),u.z<f.z&&(f.z=u.z),u.z>l.z&&(l.z=u.z)}n.left=f.x,n.right=l.x,n.top=l.y,n.bottom=f.y,n.updateProjectionMatrix()}function g(e){return e.material instanceof r.MeshFaceMaterial?e.material.materials[0]:e.material}var e,t,n,i,s,o,u=new r.Frustum,a=new r.Matrix4,f=new r.Vector3,l=new r.Vector3,c=new r.Vector3,h=[];this.init=function(u){e=u.context,t=u;var a=r.ShaderLib.depthRGBA,f=r.UniformsUtils.clone(a.uniforms);n=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f}),i=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:!0}),s=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,skinning:!0}),o=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:!0,skinning:!0}),n._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,n){if(!t.shadowMapEnabled||!t.shadowMapAutoUpdate)return;this.update(e,n)},this.update=function(f,l){var y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=[],D=0,P=null;e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===r.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0);for(y=0,b=f.__lights.length;y<b;y++){M=f.__lights[y];if(!M.castShadow)continue;if(M instanceof r.DirectionalLight&&M.shadowCascade)for(S=0;S<M.shadowCascadeCount;S++){var H;if(!M.shadowCascadeArray[S]){H=d(M,S),H.originalCamera=l;var B=new r.Gyroscope;B.position.copy(M.shadowCascadeOffset),B.add(H),B.add(H.target),l.add(B),M.shadowCascadeArray[S]=H,console.log("Created virtualLight",H)}else H=M.shadowCascadeArray[S];v(M,S),_[D]=H,D++}else _[D]=M,D++}for(y=0,b=_.length;y<b;y++){M=_[y];if(!M.shadowMap){var j=r.LinearFilter;t.shadowMapType===r.PCFSoftShadowMap&&(j=r.NearestFilter);var F={minFilter:j,magFilter:j,format:r.RGBAFormat};M.shadowMap=new r.WebGLRenderTarget(M.shadowMapWidth,M.shadowMapHeight,F),M.shadowMapSize=new r.Vector2(M.shadowMapWidth,M.shadowMapHeight),M.shadowMatrix=new r.Matrix4}if(!M.shadowCamera){if(M instanceof r.SpotLight)M.shadowCamera=new r.PerspectiveCamera(M.shadowCameraFov,M.shadowMapWidth/M.shadowMapHeight,M.shadowCameraNear,M.shadowCameraFar);else{if(!(M instanceof r.DirectionalLight)){console.error("Unsupported light type for shadow");continue}M.shadowCamera=new r.OrthographicCamera(M.shadowCameraLeft,M.shadowCameraRight,M.shadowCameraTop,M.shadowCameraBottom,M.shadowCameraNear,M.shadowCameraFar)}f.add(M.shadowCamera),f.autoUpdate===!0&&f.updateMatrixWorld()}M.shadowCameraVisible&&!M.cameraHelper&&(M.cameraHelper=new r.CameraHelper(M.shadowCamera),M.shadowCamera.add(M.cameraHelper)),M.isVirtual&&H.originalCamera==l&&m(l,M),x=M.shadowMap,T=M.shadowMatrix,N=M.shadowCamera,N.position.setFromMatrixPosition(M.matrixWorld),c.setFromMatrixPosition(M.target.matrixWorld),N.lookAt(c),N.updateMatrixWorld(),N.matrixWorldInverse.getInverse(N.matrixWorld),M.cameraHelper&&(M.cameraHelper.visible=M.shadowCameraVisible),M.shadowCameraVisible&&M.cameraHelper.update(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(N.projectionMatrix),T.multiply(N.matrixWorldInverse),a.multiplyMatrices(N.projectionMatrix,N.matrixWorldInverse),u.setFromMatrix(a),t.setRenderTarget(x),t.clear(),h.length=0,p(f,f,N);var I,q,R;for(w=0,E=h.length;w<E;w++)A=h[w],O=A.object,k=A.buffer,I=g(O),q=O.geometry.morphTargets!==undefined&&O.geometry.morphTargets.length>0&&I.morphTargets,R=O instanceof r.SkinnedMesh&&I.skinning,O.customDepthMaterial?L=O.customDepthMaterial:R?L=q?o:s:q?L=i:L=n,t.setMaterialFaces(I),k instanceof r.BufferGeometry?t.renderBufferDirect(N,f.__lights,P,L,k,O):t.renderBuffer(N,f.__lights,P,L,k,O);var U=f.__webglObjectsImmediate;for(w=0,E=U.length;w<E;w++)A=U[w],O=A.object,O.visible&&O.castShadow&&(O._modelViewMatrix.multiplyMatrices(N.matrixWorldInverse,O.matrixWorld),t.renderImmediateObject(N,f.__lights,P,n,O))}var z=t.getClearColor(),W=t.getClearAlpha();e.clearColor(z.r,z.g,z.b,W),e.enable(e.BLEND),t.shadowMapCullFace===r.CullFaceFront&&e.cullFace(e.BACK)}},r.ShadowMapPlugin.__projector=new r.Projector,r.SpritePlugin=function(){function h(){var n=e.createProgram(),r=e.createShader(e.VERTEX_SHADER),i=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(r,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),e.shaderSource(i,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),e.compileShader(r),e.compileShader(i),e.attachShader(n,r),e.attachShader(n,i),e.linkProgram(n),n}function p(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var e,t,n,i=[],s,o,u,a,f,l,c;this.init=function(i){e=i.context,t=i,s=new Float32Array([-0.5,-0.5,0,0,.5,-0.5,1,0,.5,.5,1,1,-0.5,.5,0,1]),o=new Uint16Array([0,1,2,0,2,3]),u=e.createBuffer(),a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW),f=h(),l={position:e.getAttribLocation(f,"position"),uv:e.getAttribLocation(f,"uv")},c={uvOffset:e.getUniformLocation(f,"uvOffset"),uvScale:e.getUniformLocation(f,"uvScale"),rotation:e.getUniformLocation(f,"rotation"),scale:e.getUniformLocation(f,"scale"),color:e.getUniformLocation(f,"color"),map:e.getUniformLocation(f,"map"),opacity:e.getUniformLocation(f,"opacity"),modelViewMatrix:e.getUniformLocation(f,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(f,"projectionMatrix"),fogType:e.getUniformLocation(f,"fogType"),fogDensity:e.getUniformLocation(f,"fogDensity"),fogNear:e.getUniformLocation(f,"fogNear"),fogFar:e.getUniformLocation(f,"fogFar"),fogColor:e.getUniformLocation(f,"fogColor"),alphaTest:e.getUniformLocation(f,"alphaTest")};var p=document.createElement("canvas");p.width=8,p.height=8;var d=p.getContext("2d");d.fillStyle="white",d.fillRect(0,0,8,8),n=new r.Texture(p),n.needsUpdate=!0},this.render=function(s,o,h,d){i.length=0,s.traverseVisible(function(e){e instanceof r.Sprite&&i.push(e)});if(i.length===0)return;e.useProgram(f),e.enableVertexAttribArray(l.position),e.enableVertexAttribArray(l.uv),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,u),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.uniformMatrix4fv(c.projectionMatrix,!1,o.projectionMatrix.elements),e.activeTexture(e.TEXTURE0),e.uniform1i(c.map,0);var v=0,m=0,g=s.fog;g?(e.uniform3f(c.fogColor,g.color.r,g.color.g,g.color.b),g instanceof r.Fog?(e.uniform1f(c.fogNear,g.near),e.uniform1f(c.fogFar,g.far),e.uniform1i(c.fogType,1),v=1,m=1):g instanceof r.FogExp2&&(e.uniform1f(c.fogDensity,g.density),e.uniform1i(c.fogType,2),v=2,m=2)):(e.uniform1i(c.fogType,0),v=0,m=0);for(var y=0,b=i.length;y<b;y++){var w=i[y],E=w.material;w._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]}i.sort(p);var S=[];for(var y=0,b=i.length;y<b;y++){var w=i[y],E=w.material;e.uniform1f(c.alphaTest,E.alphaTest),e.uniformMatrix4fv(c.modelViewMatrix,!1,w._modelViewMatrix.elements),S[0]=w.scale.x,S[1]=w.scale.y;var x=0;s.fog&&E.fog&&(x=m),v!==x&&(e.uniform1i(c.fogType,x),v=x),E.map!==null?(e.uniform2f(c.uvOffset,E.map.offset.x,E.map.offset.y),e.uniform2f(c.uvScale,E.map.repeat.x,E.map.repeat.y)):(e.uniform2f(c.uvOffset,0,0),e.uniform2f(c.uvScale,1,1)),e.uniform1f(c.opacity,E.opacity),e.uniform3f(c.color,E.color.r,E.color.g,E.color.b),e.uniform1f(c.rotation,E.rotation),e.uniform2fv(c.scale,S),t.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),t.setDepthTest(E.depthTest),t.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?t.setTexture(E.map,0):t.setTexture(n,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}e.enable(e.CULL_FACE)}},r.DepthPassPlugin=function(){function l(e,t,n){if(t.visible){var r=e.__webglObjects[t.id];if(r&&(t.frustumCulled===!1||u.intersectsObject(t)===!0))for(var i=0,s=r.length;i<s;i++){var o=r[i];t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),f.push(o)}for(var i=0,s=t.children.length;i<s;i++)l(e,t.children[i],n)}}function c(e){return e.material instanceof r.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var e,t,n,i,s,o,u=new r.Frustum,a=new r.Matrix4,f=[];this.init=function(u){e=u.context,t=u;var a=r.ShaderLib.depthRGBA,f=r.UniformsUtils.clone(a.uniforms);n=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f}),i=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:!0}),s=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,skinning:!0}),o=new r.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:!0,skinning:!0}),n._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){if(!this.enabled)return;this.update(e,t)},this.update=function(h,p){var d,v,m,g,y,b,w,E,S,x,T,N,C=null;e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),h.autoUpdate===!0&&h.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),a.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),u.setFromMatrix(a),t.setRenderTarget(this.renderTarget),t.clear(),f.length=0,l(h,h,p);var k,L,A;for(m=0,g=f.length;m<g;m++){S=f[m],x=S.object,w=S.buffer;if(x instanceof r.PointCloud&&!x.customDepthMaterial)continue;k=c(x),k&&t.setMaterialFaces(x.material),L=x.geometry.morphTargets!==undefined&&x.geometry.morphTargets.length>0&&k.morphTargets,A=x instanceof r.SkinnedMesh&&k.skinning,x.customDepthMaterial?E=x.customDepthMaterial:A?E=L?o:s:L?E=i:E=n,w instanceof r.BufferGeometry?t.renderBufferDirect(p,h.__lights,C,E,w,x):t.renderBuffer(p,h.__lights,C,E,w,x)}N=h.__webglObjectsImmediate;for(m=0,g=N.length;m<g;m++)S=N[m],x=S.object,x.visible&&(x._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,x.matrixWorld),t.renderImmediateObject(p,h.__lights,C,n,x));var O=t.getClearColor(),M=t.getClearAlpha();e.clearColor(O.r,O.g,O.b,M),e.enable(e.BLEND)}},r.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},r}),define("../extension/Object3DFactory",["require","exports","module","../extension/THREE"],function(e,t,n){var r=e("../extension/THREE"),i=function(){};return i.create=function(e,t){},i.objects={light:function(e){},plane:function(e){},cube:function(e){},sprite:function(e){},model:function(e){}},i}),define("../extension/GLCanvas",["require","exports","module","DisplayObject","../extension/THREE"],function(e,t,n){var r=e("DisplayObject"),i=e("../extension/THREE"),s=r.extend({renderMode:0,useElemSize:!0,_tagName:"canvas",init:function(e){this._super(e),this._initScene(e)},update:function(e){var t=this._renderer,n=this._scene,r=this._camera;i.AnimationHandler.update(e/1e3),t.render(n,r)},getCamera:function(){return this._camera},addChild:function(e,t){t||(t={});var n=this._scene,r;switch(e){case"light":r=this.createLight(t);break;case"plane":r=this.createPlane(t);break;case"cube":r=this.createCube(t);break;case"sphere":r=this.createSphere(t);break;case"sprite":r=this.createSprite(t);break;case"model":r=this.createModel(t,function(e){n.add(e),t.onload&&t.onload(e)})}return r&&n.add(r),r},createLight:function(e){var t=new i.DirectionalLight(16777215,e.strong||1);return t.add(new i.Mesh(new i.SphereGeometry(3,9,9),new i.MeshBasicMaterial({color:16711680}))),t},createPlane:function(e){var t=new i.PlaneGeometry(e.width||500,e.height||500),n=e.texture?i.ImageUtils.loadTexture(e.texture):null,r=new i.MeshLambertMaterial({color:8421504,map:n});return new i.Mesh(t,r)},createCube:function(e){var t=new i.BoxGeometry(100,100,100);for(var n=0;n<t.faces.length;n+=2){var r=e.color||Math.random()*16777215;t.faces[n].color.setHex(r),t.faces[n+1].color.setHex(r)}var s=new i.MeshLambertMaterial({vertexColors:i.FaceColors});return new i.Mesh(t,s)},createSphere:function(e){var t=new i.SphereGeometry(e.radius||50,16,16),n=new i.MeshLambertMaterial({color:e.color||65280});return new i.Mesh(t,n)},createSprite:function(e){var t=function(e){e.beginPath(),e.arc(0,0,.5,0,Math.PI*2,!0),e.fill()},n=new i.SpriteCanvasMaterial({color:16711744,program:t});return new i.Sprite(n)},createModel:function(e,t){var n=new i.JSONLoader,r;e.type?e.type==="morphAnim"?r=function(e,n){var r=n[0];r.morphTargets=!0,r.shading=i.NoShading;var s=new i.MorphAnimMesh(e,new i.MeshFaceMaterial(n));s.setFrameRange(0,290),s.duration=6.96,t(s);var o=new i.MorphAnimation(s);o.play()}:e.type==="skinned"&&(r=function(e,n){var r=0,s=0,o=0,u=15,a=e.animation;for(var f=0;f<a.hierarchy.length;f++){var l=a.hierarchy[f],c=l.keys[0],h=l.keys[l.keys.length-1];h.pos=c.pos,h.rot=c.rot,h.scl=c.scl}e.computeBoundingBox();var p=e.boundingBox;for(var f=0;f<n.length;f++){var d=n[f];d.skinning=!0,d.morphTargets=!0,d.specular.setHSL(0,0,.1),d.color.setHSL(.6,0,.6),d.ambient.copy(d.color),d.wrapAround=!0}var v=new i.SkinnedMesh(e,new i.MeshFaceMaterial(n));v.position.set(r,s-p.min.y*u,o),v.scale.set(u,u,u),v.castShadow=!0,v.receiveShadow=!0,t(v);var a=new i.Animation(v,e.animation);a.play()}):r=function(e,n){var r=new i.MeshFaceMaterial(n),s=new i.SkinnedMesh(e,r);t(s)},n.load(e.url,r)},_initScene:function(e){var t=new i.Scene;t.fog=e.sceneFog?new i.Fog(11184878,800):null;var n=new i.PerspectiveCamera(70,this.width/this.height,.1,1e3),r=new i.WebGLRenderer({canvas:this.elem,antialias:!0,alpha:e.clearColor==="alpha"});r.setSize(this.width,this.height),e.clearColor&&e.clearColor!=="alpha"?r.setClearColor(e.clearColor,1):e.sceneFog&&r.setClearColor(t.fog.color,1),this._scene=t,this._camera=n,this._renderer=r}});return s}),define("cartoon.three",["require","exports","module","cartoon","../extension/THREE","../extension/Object3DFactory","../extension/GLCanvas"],function(e,t,n){var r=e("cartoon");return r.THREE=e("../extension/THREE"),r.Object3DFactory=e("../extension/Object3DFactory"),r.GLCanvas=e("../extension/GLCanvas"),r});